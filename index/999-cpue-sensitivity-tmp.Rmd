---
title: "Pacific Cod. Sensitivity of model results to inclusion of year-location interaction term in historical and post-1996 commercial CPUE"
author: "Robyn Forrest (CPUE analyses by Sean Anderson)"
date: "August 21, 2018"
geometry: "left=3cm,right=3cm,top=2cm,bottom=2cm"
output: 
   pdf_document:
     fig_caption: yes
     fig_width: 5
     fig_height: 3.5
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```

# DRAFT - DO NOT CIRCULATE

This is a summary of delay difference model sensitivity to inclusion of a year-locality interaction term (as random effect) in Tweedie GLMM used to model commercial CPUE series for BC Pacific Cod. Please see separate full documentation of the GLMM model by Sean Anderson (to come).

Summary of scenario codes

```{r}

df <- data.frame(Scenario = c("0_1a_5ABCD_BASE_loc-yr-interact_rsoleq_06_019",
                     "0_1b_5ABCD_NO_loc-yr-interact_rsoleq_06_019",
                     "0_1c_5ABCD_NO_loc-yr-interact_rsoleq_06_019_doubleCV",
                     "1_1a_3CD_BASE_loc-yr-interact_rsoleq_06_019",
                     "1_1b_3CD_NO_loc-yr-interact_rsoleq_06_019",
                     "1_1c_3CD_NO_loc-yr-interact_rsoleq_06_019_doubleCV"),
                 Area = c(rep("5ABCD",3),rep("3CD",3)),
                 Description = c("Yr-loc. interaction as random effect",
                        "No yr-loc. interaction",
                        "No yr-loc. interaction, double CV",
                        "Yr-loc. interaction as random effect",
                        "No yr-loc. interaction",
                        "No yr-loc. interaction, double CV"))
knitr::kable(df)

```

Summary of prior probability distributions common to all models. Note Beta parameters for steepness give distribution with mean ~ 0.7 and sd ~ 0.15.


### 5ABCD


```{r}

df <- data.frame(Parameter = c("ln M",
                     "Steepness",
                     "ln R0",
                     "Tau",
                     "Sig",
                     "q HSMSAS",
                     "ln q QCSS",
                     "ln q HSSS",
                     "q CPUE Hist",
                     "q CPUE 1996+"),
                 Distribution = c("Norm", "Beta", "Unif","Fixed","Fixed","Unif","Norm","Norm","Unif","Unif"),
                 p1 = c("ln(0.5)",
                        "5.83",
                        "1",
                        "0.8",
                        "0.2",
                        "0",
                        "ln(0.628 x 0.65)",
                        "ln(0.1869 x 0.35)",
                        "0",
                        "0"),
                 p2 = c("0.1",
                        "2.5",
                        "12",
                        "NA",
                        "NA",
                        "1",
                        "0.3",
                        "0.3",
                        "1",
                        "1"))
knitr::kable(df)

```

\clearpage


### 3CD


```{r}

df <- data.frame(Parameter = c("ln M",
                     "Steepness",
                     "ln R0",
                     "Tau",
                     "Sig",
                     "ln q WCVISS",
                     "q CPUE Hist",
                     "q CPUE 1996+",
                     "q Triennial"),
                 Distribution = c("Norm", "Beta", "Unif","Fixed","Fixed","Norm","Unif","Unif","Unif"),
                 p1 = c("ln(0.5)",
                        "5.83",
                        "1",
                        "0.8",
                        "0.2",
                        "ln(0.228)",
                        "0",
                        "0",
                        "0"),
                 p2 = c("0.1",
                        "2.5",
                        "12",
                        "NA",
                        "NA",
                        "0.3",
                        "1",
                        "1",
                        "1"))
knitr::kable(df)

```

\clearpage

## Results

### Posterior estimates of Biomass and Recruits

Posterior samples were drawn systematically every 2,000 iterations from a chain length of five million, resulting in 2,000 posterior samples (with first 1,000 dropped to allow for burn-in). Longer chains will be run for the base cases in the final working paper.

\begin{figure}[h!]
\includegraphics[width=0.7\textwidth]{C:/GitHub/pcod-scenarios-2018/models/SensitivityFigures/SensitivityGroup_1_SB-mcmc.png}
\caption{Posterior estimates of biomass for Area 5ABCD.}
\end{figure}

\begin{figure}[h!]
\includegraphics[width=0.7\textwidth]{C:/GitHub/pcod-scenarios-2018/models/SensitivityFigures/SensitivityGroup_1_Recr.png}
\caption{Posterior estimates of recruits for Area 5ABCD.}
\end{figure}


\begin{figure}[h!]
\includegraphics[width=0.7\textwidth]{C:/GitHub/pcod-scenarios-2018/models/SensitivityFigures/SensitivityGroup_8_SB-mcmc.png}
\caption{Posterior estimates of biomass for Area 3CD.}
\end{figure}


\begin{figure}[h!]
\includegraphics[width=0.7\textwidth]{C:/GitHub/pcod-scenarios-2018/models/SensitivityFigures/SensitivityGroup_8_Recr.png}
\caption{Posterior estimates of recruits for Area 3CD.}
\end{figure}

\clearpage

### MPD estimates of Biomass

\begin{figure}[h!]
\includegraphics[width=0.7\textwidth]{C:/GitHub/pcod-scenarios-2018/models/SensitivityFigures/SensitivityGroup_1_SB-mpd.png}
\caption{MPD estimates of biomass for Area 5ABCD.}
\end{figure}

\begin{figure}[h!]
\includegraphics[width=0.7\textwidth]{C:/GitHub/pcod-scenarios-2018/models/SensitivityFigures/SensitivityGroup_8_SB-mpd.png}
\caption{MPD estimates of biomass for Area 3CD.}
\end{figure}

\clearpage

### Parameter estimates
### 5ABCD

1. Lower (2.5th percentile), Median and Upper (97.5th percentile) posterior parameter estimates and MPD parameter estimates for **scenario 0_1a_5ABCD_BASE_loc-yr-interact_rsoleq_06_019**.
```{r, echo=FALSE}
pars <- read.csv("C:/GitHub/pcod-scenarios-2018/models/0_1a_5ABCD_BASE_loc-yr-interact_rsoleq_06_019/Tables/0_1a_5ABCD_BASE_loc-yr-interact_rsoleq_06_019_ParamEst.csv", header=T)
knitr::kable(pars, digits=3)

```

2. Lower (2.5th percentile), Median and Upper (97.5th percentile) posterior parameter estimates and MPD parameter estimates for **scenario 0_1b_5ABCD_NO_loc-yr-interact_rsoleq_06_019**.
```{r, echo=FALSE}
pars <- read.csv("C:/GitHub/pcod-scenarios-2018/models/0_1b_5ABCD_NO_loc-yr-interact_rsoleq_06_019/Tables/0_1b_5ABCD_NO_loc-yr-interact_rsoleq_06_019_ParamEst.csv", header=T)
knitr::kable(pars, digits=3)

```

3. Lower (2.5th percentile), Median and Upper (97.5th percentile) posterior parameter estimates and MPD parameter estimates for **scenario 0_1c_5ABCD_NO_loc-yr-interact_rsoleq_06_019_doubleCV**.
```{r, echo=FALSE}
pars <- read.csv("C:/GitHub/pcod-scenarios-2018/models/0_1c_5ABCD_NO_loc-yr-interact_rsoleq_06_019_doubleCV/Tables/0_1c_5ABCD_NO_loc-yr-interact_rsoleq_06_019_doubleCV_ParamEst.csv", header=T)
knitr::kable(pars, digits=3)

```

\clearpage

### 3CD

1. Lower (2.5th percentile), Median and Upper (97.5th percentile) posterior parameter estimates and MPD parameter estimates for **scenario 1_1a_3CD_BASE_loc-yr-interact_rsoleq_0228sd03**.
```{r, echo=FALSE}
pars <- read.csv("C:/GitHub/pcod-scenarios-2018/models/1_1a_3CD_BASE_loc-yr-interact_rsoleq_0228sd03/Tables/1_1a_3CD_BASE_loc-yr-interact_rsoleq_0228sd03_ParamEst.csv", header=T)
knitr::kable(pars, digits=3)

```

2. Lower (2.5th percentile), Median and Upper (97.5th percentile) posterior parameter estimates and MPD parameter estimates for **scenario 1_1b_3CD_NO_loc-yr-interact_rsoleq_0228sd03**.
```{r, echo=FALSE}
pars <- read.csv("C:/GitHub/pcod-scenarios-2018/models/1_1b_3CD_NO_loc-yr-interact_rsoleq_0228sd03/Tables/1_1b_3CD_NO_loc-yr-interact_rsoleq_0228sd03_ParamEst.csv", header=T)
knitr::kable(pars, digits=3)

```

3. Lower (2.5th percentile), Median and Upper (97.5th percentile) posterior parameter estimates and MPD parameter estimates for **scenario 1_1c_3CD_NO_loc-yr-interact_rsoleq_0228sd03_doubleCV**.
```{r, echo=FALSE}
pars <- read.csv("C:/GitHub/pcod-scenarios-2018/models/1_1c_3CD_NO_loc-yr-interact_rsoleq_0228sd03_doubleCV/Tables/1_1c_3CD_NO_loc-yr-interact_rsoleq_0228sd03_doubleCV_ParamEst.csv", header=T)
knitr::kable(pars, digits=3)

```

\clearpage

### Stock Status
### 5ABCD History-based reference points

\begin{figure}[h!]
\includegraphics[width=0.7\textwidth]{"C:/GitHub/pcod-scenarios-2018/models/0_1a_5ABCD_BASE_loc-yr-interact_rsoleq_06_019/Figures/0_1a_5ABCD_BASE_loc-yr-interact_rsoleq_06_019_SB_hist.png}
\caption{Posterior stock status for scenario shown in legend. Dashed lines indicate posterior median reference points. Bmin = B1971. USR = average biomass between 1956 and 2004. }
\end{figure}

\begin{figure}[h!]
\includegraphics[width=0.7\textwidth]{"C:/GitHub/pcod-scenarios-2018/models/0_1c_5ABCD_NO_loc-yr-interact_rsoleq_06_019_doubleCV/Figures/0_1c_5ABCD_NO_loc-yr-interact_rsoleq_06_019_doubleCV_SB_hist.png}
\caption{Posterior stock status for scenario shown in legend. Dashed lines indicate posterior median reference points. Bmin = B1971. USR = average biomass between 1956 and 2004. }
\end{figure}

\clearpage

### 5ABCD B0-based reference points (for comparison)


\begin{figure}[h!]
\includegraphics[width=0.7\textwidth]{"C:/GitHub/pcod-scenarios-2018/models/0_1a_5ABCD_BASE_loc-yr-interact_rsoleq_06_019/Figures/0_1a_5ABCD_BASE_loc-yr-interact_rsoleq_06_019_SB_B0.png}
\caption{Posterior stock status for scenario shown in legend. Dashed lines indicate posterior median reference points.  }
\end{figure}

\begin{figure}[h!]
\includegraphics[width=0.7\textwidth]{"C:/GitHub/pcod-scenarios-2018/models/0_1c_5ABCD_NO_loc-yr-interact_rsoleq_06_019_doubleCV/Figures/0_1c_5ABCD_NO_loc-yr-interact_rsoleq_06_019_doubleCV_SB_B0.png}
\caption{Posterior stock status for scenario shown in legend. Dashed lines indicate posterior median reference points.  }
\end{figure}

\clearpage

### 3CD History-based reference points


\begin{figure}[h!]
\includegraphics[width=0.7\textwidth]{"C:/GitHub/pcod-scenarios-2018/models/1_1a_3CD_BASE_loc-yr-interact_rsoleq_0228sd03/Figures/1_1a_3CD_BASE_loc-yr-interact_rsoleq_0228sd03_SB-hist.png}
\caption{Posterior stock status for scenario shown in legend. Dashed lines indicate posterior median reference points. Bmin = B1986. USR = average biomass between 1956 and 2004. }
\end{figure}

\begin{figure}[h!]
\includegraphics[width=0.7\textwidth]{"C:/GitHub/pcod-scenarios-2018/models/1_1c_3CD_NO_loc-yr-interact_rsoleq_0228sd03_doubleCV/Figures/1_1c_3CD_NO_loc-yr-interact_rsoleq_0228sd03_doubleCV_SB-hist.png}
\caption{Posterior stock status for scenario shown in legend. Dashed lines indicate posterior median reference points. Bmin = B1986. USR = average biomass between 1956 and 2004. }
\end{figure}

\clearpage

### 3CD B0-based reference points (for comparison)


\begin{figure}[h!]
\includegraphics[width=0.7\textwidth]{"C:/GitHub/pcod-scenarios-2018/models/1_1a_3CD_BASE_loc-yr-interact_rsoleq_0228sd03/Figures/1_1a_3CD_BASE_loc-yr-interact_rsoleq_0228sd03_SB-B0.png}
\caption{Posterior stock status for scenario shown in legend. Dashed lines indicate posterior median reference points.  }
\end{figure}

\begin{figure}[h!]
\includegraphics[width=0.7\textwidth]{"C:/GitHub/pcod-scenarios-2018/models/1_1c_3CD_NO_loc-yr-interact_rsoleq_0228sd03_doubleCV/Figures/1_1c_3CD_NO_loc-yr-interact_rsoleq_0228sd03_doubleCV_SB-B0.png}
\caption{Posterior stock status for scenario shown in legend. Dashed lines indicate posterior median reference points.  }
\end{figure}

