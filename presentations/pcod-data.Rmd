---
title: |
  2018 Pacific cod stock assessment for Hecate Strait, Queen Charlotte Sound (5ABCD) and West Cost Vancouver Island (3CD)
author: |
  Robyn E. Forrest, Sean Anderson, Chris Grandin, Paul Starr
date: "`r Sys.Date()`"
output:
  xaringan::moon_reader:
    lib_dir: libs
    nature:
      ratio: "16:9"
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
css: pcod.css
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE,
                      warning = FALSE)
options(htmltools.dir.version = FALSE)
source(file.path(here::here(), "R", "all.R"))
build(ovwrt.base = FALSE,
      ovwrt.sens = FALSE,
      ovwrt.retro = FALSE,
      burnin = 1000,
      thin = 1)
load.models.into.parent.env()
source(file.path(rootd.R, "custom-knitr-variables.R"))
```
.pull-left[
# Assessment Areas
- Hecate Strait and Queen Charlotte Sound, Areas **5ABCD**

- West Coast Vancouver Island, Areas **3CD**

![](Pcod_Profile_Picture.jpg)
]

.pull-right[
![](Pcod_3CD5ABCDE_Pic.png)
]

---

# Species overview
- Pacific Cod are distributed from California, through waters of BC, Gulf of Alaska and the Bering Sea to Russia, Korea, Japan and China.

- May be genetically distinct from other areas.

- In BC the maximum age is 10-11 yr and maximum size is 100 cm.

- Pacific Cod are demersal spawners; spawning most likely occurs during February to March.

---
# Commercial Fishery

- Pacific Cod are caught almost entirely by bottom trawl.

- Mainly captured at depths less than 150 m.

- Annual reported catches have shown considerable variability since the beginning of the time series in 1956.

---
# Commercial Fishery Data

### Summarized by fishing year, April 1 to March 31

###Canadian catches:
- Earliest data from summaries of trawl fishing, 1945. Landings only, recorded by PMFC area (e.g., 5A, 5C) and month.
- GFCatch contains landed catches and some limited discards for 1954-1995.
- PacharvTrawl contains catches and discards for 1996-March 2007. Reliable statistics, largely from at-sea observer logbooks.
- FOS contains catches  and discards for April 2007-present. Reliable statistics, largely from at-sea observer logbooks.

###USA catches:
- Obtained from PMFC Data Series -- combined Canadian and USA landings by PMFC area and month. USA landings obtained by subtracting the Canadian portion recorded in GFCatch. Some discrepancies as combined landings were sometimes less than the Canadian amount. In these cases the USA catch was set to zero.

---
.left-column[
# Fishery Catch for Area 5ABCD
Total catches of Pacific Cod during the period 1956-2017 in Hecate Strait and Queen Charlotte Sound. Catches represent the sum of landings from US and Canadian vessels and estimated at-sea releases from Canadian vessels.
]

.right-column[
```{r catch.5abcd, dev='svg', fig.height=6, fig.width=10}
make.catches.plot(catch.5)
```
]

---
.left-column[
# Fishery Catch for Area 3CD
Total catches of Pacific Cod during the period 1956-2017 off the West Coast of Vancouver Island. Catches represent the sum of landings from US and Canadian vessels and estimated at-sea releases from Canadian vessels.
]

.right-column[
```{r catch.3cd, dev='svg', fig.height=6, fig.width=10}
make.catches.plot(catch.3)
```
]

---
# Research Surveys

### Area 5ABCD
- Queen Charlotte Sound Synoptic Survey 2003-2017

- Hecate Strait Assemblage Survey 1984-2003

- Hecate Strait Pacific Cod Monitoring Survey 2002-2004

- Hecate Strait Synoptic Survey 2005-2017

### Area 3CD
- WCVI Synoptic Survey 2004-2016 (even years, **2018 not included**)

- NMFS Triennial Survey 1989-2001 (1989, 1992, 1995, 1998, 2001)

---
# Survey indices of abundance

- For all surveys, a swept area estimate of biomass in any year y was obtained by summing the product of the CPUE and the area surveyed across the surveyed strata *i*.

- Variance of biomass estimate calculated.

- One thousand bootstrap replicates with replacement constructed to estimate bias corrected 95% confidence levels for each survey year.

---
# Survey indices of abundance for Area 5ABCD - 1
**(a)** - HS Assemblage, **(b)** - QCS Synoptic, **(c)** - HS Synoptic

```{r fig-base-index-fits-5abcd-1, dev='svg', fig.height=5, fig.width=12}
plot_grid(i.plot(base.model.5abcd, base.model.5abcd.name, 1, every = 5)
            + ylab("Commercial CPUE (kg/hour)"),
          i.plot(base.model.5abcd, base.model.5abcd.name, 2, every = 5)
            + ylab("Commercial CPUE (kg/hour)"),
          i.plot(base.model.5abcd, base.model.5abcd.name, 3, every = 5)
            + ylab("Commercial CPUE (kg/hour)"),
          nrow = 1,
          ncol = 3,
          labels = c("(a)", "(b)", "(c)"),
          label_x = 0.15)
```

---
# Survey indices of abundance for Area 5ABCD - 2
**(d)** - Commercial CPUE pre-1996, **(e)** - Commercial CPUE post-1995

```{r fig-base-index-fits-5abcd-2, dev='svg', fig.height=5, fig.width=12}
plot_grid(i.plot(base.model.5abcd, base.model.5abcd.name, 4, every = 10)
            + ylab("Commercial CPUE (kg/hour)"),
          i.plot(base.model.5abcd, base.model.5abcd.name, 5, every = 5)
            + ylab("Commercial CPUE (kg/hour)"),
          nrow = 1,
          ncol = 2,
          labels = c("(d)", "(e)"),
          label_x = 0.08)
```

---
# Survey indices of abundance for Area 3CD
**(a)** - WCVI Synoptic, **(b)** - Commercial CPUE pre-1996, **(c)** - Commercial CPUE post-1995,  **(d)** - NMFS Triennial (Canada)

```{r fig-base-index-fits-3cd, dev='svg', fig.height=5, fig.width=12}
plot_grid(i.plot(base.model.3cd, base.model.3cd.name, 1, every = 5),
          i.plot(base.model.3cd, base.model.3cd.name, 2, every = 5)
            + ylab("Commercial CPUE (kg/hour)"),
          i.plot(base.model.3cd, base.model.3cd.name, 3, every = 5)
            + ylab("Commercial CPUE (kg/hour)"),
          i.plot(base.model.3cd, base.model.3cd.name, 4, every = 5),
          nrow = 1,
          ncol = 4,
          labels = c("(a)", "(b)", "(c)", "(d)"),
          label_x = c(0.17, 0.15, 0.13, 0.23))
```

---
# Commercial Length Data

Criteria for length data extraction for use in estimating size composition of bottom trawl catches:

- Commercial trips, bottom trawl only

- By fishing year, April 1 to March 31, based on fishing event haul date/time

- Eliminated 7 samples that may have been tomcod

---
# Commercial Length Data
```{r lengths-comm, dev='svg', fig.height=5.5, fig.width=12}
xx <- dat$commercial_samples %>%
  dplyr::filter(!is.na(length))

xx <- xx[!duplicated(xx$specimen_id), , drop = FALSE]
xx$area <- gfplot::assign_areas(xx$major_stat_area_name,
 area_regex = c("3[CD]+", "5[ABCD]+"))

xx %>%
 filter(!is.na(area)) %>%
 filter(year >= 1996) %>%
  filter(year < 2018) %>%
 filter(species_category_code %in% 1) %>%
 do(gfplot:::bin_lengths(., value = length, bin_size = 2)) %>%
 rename(length_bin = length) %>%
 group_by(year, length_bin, area) %>%
 summarise(n = n()) %>%
 group_by(year, area) %>%
 mutate(proportion = n / sum(n), total = sum(n)) %>%
 ungroup() %>%
 mutate(sex = "M", survey_abbrev = area) %>% # sex = "M" is a trick to plot them all
 plot_lengths() + xlab("Length (cm)") +
 guides(colour = FALSE, fill = FALSE)


```

---
# Commercial CPUE Standardization

- Historical and modern
- Testing

