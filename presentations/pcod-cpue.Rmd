---
title: |
  2018 Pacific cod stock assessment for Hecate Strait, Queen Charlotte Sound (5ABCD) and West Coast Vancouver Island (3CD)
subtitle:  CPUE Standardization
author: |
  Robyn E. Forrest, Sean Anderson, Chris Grandin, Paul Starr
date: "`r Sys.Date()`"
output:
  xaringan::moon_reader:
    lib_dir: libs
    chakra: libs/remark-latest.min.js
    nature:
      titleSlideClass: [center, middle]
      ratio: "16:9"
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
css: pcod.css
---

```{r setup, include=FALSE, cache=FALSE}
knitr::opts_chunk$set(echo = FALSE,
                      warning = FALSE,
                      cache = FALSE,
                      autodep = FALSE,
                      cache.comments = FALSE,
                      fig.align = "center",
                      fig.width = 9,
                      dev = 'svg',
                      fig.asp = 0.618)
options(htmltools.dir.version = FALSE)
library(knitr)
```

<!--
## Depth distributions

<img src="../index/knitr-figs/cpue-depth-hists-1.png" height="500" class='center-img'>
-->

## 3CD Historical CPUE Variables

<img src="../index/knitr-figs/cpue-bubble-plots-hist-3CD-1.png" height="500" class='center-img'>

---

## 3CD localities

<img src="../index/knitr-figs/cpue-locality-map-3-1.png" height="500" class='center-img'>

---

## 5ABCD localities

<img src="../index/knitr-figs/cpue-locality-map-5-1.png" height="500" class='center-img'>

---

class: inverse, middle, center

# A Tweedie GLMM standardization model

---

## Advantages of GLMMs over GLMs for index standardization

GLMMs with random effects for things like vessels, localities, etc.

--

1. allow prediction for an average level

--

1. create more realistic estimates of uncertainty

--

1. make better use of the data

--

1. allow for explicit comparison of variance components

---

## Challenges with *delta* index standardization models

Delta-gamma or delta-lognormal index standardization models:

--

1. add complexity (2 models)

--

1. use 2 GLM links; coefficients cannot be combined

--

1. assume independence among the 2 models

--

1. may be insufficiently robust to variable sampling intensity

--

1. **create an index that is dependent on the reference levels**

---

## The Tweedie distribution

<img src="../index/knitr-figs/cpue-tweedie-ex-1.png" height="500" class='center-img'>

---

## A Tweedie GLMM standardization model

A Tweedie distribution observation model:

$$
  y_i \sim \mathrm{Tweedie}(\mu_i, p, \phi), \quad 1 < p < 2,
$$

and a log link (i.e. an exponentiated inverse link):

$$
\begin{align}
 \mu_i &= \exp \left(
  \mathbf{X}_i \mathbf{\beta} + \alpha^\mathrm{locality}_{j[i]} + \alpha^\mathrm{locality-year}_{k[i]} + \alpha^\mathrm{vessel}_{l[i]} \right)
\end{align}
$$

with a vector of fixed effects ($\mathbf{\beta}$)

---

## Fixed effect coefficients (historical)

<img src="../index/knitr-figs/cpue-coef-plot1-1.png" height="500" class='center-img'>

---

## Fixed effect coefficients (modern)

<img src="../index/knitr-figs/cpue-coef-plot1-modern-1.png" height="500" class='center-img'>

---

## Locality random effects (historical)

<img src="../index/knitr-figs/cpue-coef-plot2-1.png" height="500" class='center-img'>

---

## Locality random effects (modern)

<img src="../index/knitr-figs/cpue-coef-plot2-modern-1.png" height="500" class='center-img'>

---

## Locality-year random effects (historical)

<img src="../index/knitr-figs/cpue-coef-plot3-1.png" height="500" class='center-img'>

---

## Locality-year random effects (modern)

<img src="../index/knitr-figs/cpue-coef-plot3-modern-1.png" height="500" class='center-img'>

---

## CPUE standardizations (historical)

<img src="../index/knitr-figs/cpue-index-ts-hist-1.png" height="500" class='center-img'>

---

## CPUE standardizations (modern)

<img src="../index/knitr-figs/cpue-index-ts-modern-1.png" height="500" class='center-img'>

---

## CPUE standardizations â€” with and without space-time interactions

<img src="../index/knitr-figs/cpue-int-test-plot-1.png" height="500" class='center-img'>

---

## Randomized quantile residuals

<img src="../index/knitr-figs/cpue-quantile-residuals-1.png" height="500" class='center-img'>

---

## Locality-specific CPUE trends (**with** space-time interactions)

<img src="../index/knitr-figs/cpue-re-int-ts-1.png" height="500" class='center-img'>

---

## Locality-specific CPUE trends (**without** space-time interactions)

<img src="../index/knitr-figs/cpue-re-no-int-ts-1.png" height="500" class='center-img'>

---

## Simulation testing the space-time assumption

<img src="../index/knitr-figs/cpue-sim-test-tweedie-glmm-plot-1.png" height="500" class='center-img'>
