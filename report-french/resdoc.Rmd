---
title: "Assessment of Pacific Cod (*Gadus macrocephalus*) for Hecate Strait and Queen Charlotte Sound (Area 5ABCD), and West Coast Vancouver Island (Area 3CD) in 2018"
author: |
  Robyn E. Forrest^1^,
  Sean C. Anderson^1^,
  Chris J. Grandin^1^,
  Paul J. Starr^2^

author_list: "Forrest, R.E., Anderson, S.C., Grandin, C.J., and Paul J. Starr"
address: |
  ^1^Pacific Biological Station\
     Fisheries and Oceans Canada, 3190 Hammond Bay Road\
     Nanaimos, British Columbia, V9T 6N7, Canada\
     \
  ^2^Canadian Groundfish Research and Conservation Society\
      1406 Rose Ann Drive\
      Nanaimo, British Columbia, V9T 4K8, Canada\

year: "2019"
report_number: "nnn"
type: res-doc
abstract: |
  The status of two stocks of Pacific Cod (*Gadus macrocephalus*) in Hecate Strait/Queen Charlotte Sound (Area 5ABCD) and West Coast Vancouver Island (Area 3CD) was assessed using Bayesian delay-difference models. The models were fit to fishery-independent indices of abundance and new standardized commercial catch-per-unit-effort (CPUE) indices that were developed using Tweedie generalized linear mixed effect models (GLMMs). New analyses of growth and maturity were also done and incorporated into the models.

  Model estimates of biomass and stock status in both management areas were sensitive to prior assumptions about natural mortality and survey scaling parameters, variance in the mean weight data, and the goodness of fit to the indices of abundance, particularly the commercial CPUE data. Harvest advice was produced in the form of decision tables that summarized the probability of breaching reference points in 2019 over a range of fixed 2018 catch levels. Due to model sensitivity to a number of assumptions, these stocks were assessed using a model-averaging approach which combined the posterior distributions from seven alternative model configurations for each stock.The resulting distributions were used to assess the historical biomass trajectories, current stock status and decision tables based on catch projections appropriate to each stock.

  Reference points based on historical reconstruction of long-term average biomass and fishing mortality were accepted in 2013 for the Area 5CD Pacific Cod stock. "Historical" reference points were recommended because uncertainty in estimates of productivity parameters implied large uncertainty in reference points based on maximum sustainable yield (MSY). On the basis of the previous acceptance of historical reference points for Area 5CD Pacific Cod, the current assessment applies the same approach for the Areas 5ABCD and 3CD stocks. For both stocks, an upper stock reference point (USR) is defined as estimated average biomass during the period 1956-2004. A limit reference point (LRP) is defined as the lowest estimated biomass agreed to be an undesirable state to avoid (occurred in year 2000 in Area 5ABCD, and in 1986 in Area 3CD). For both stocks, a limit removal rate (LRR) is defined as estimated average fishing mortality during the period 1956--2004.

  Biomass in Area 5ABCD is estimated to have been on a declining trajectory since 2011, following declining trends in abundance indices, despite low estimated fishing mortality rates over the same period. Median posterior estimates of biomass are estimated to be between the median LRP and median USR for Area 5ABCD. Recruitment is estimated to have been below average for the past two decades.

  Biomass in Area 3CD is estimated to have been on a declining trajectory since 2015 after following an increasing trend from a historical low level of biomass between 1998 and 2014. These trends are consistent with the available biomass indices, including a recent downturn in the WCVI synoptic survey and the CPUE series. Median posterior estimates of biomass are estimated to be above the median LRP but below the USR for Area 3CD. Recruitment is estimated to have been below average for most years in the past two decades, with above average peaks in 2009, 2013 and 2014.

always_allow_html: yes
link-citations: true
output:
  csasdown::resdoc_pdf
  #csasdown::resdoc_word
header: ""
bibliography: bib/refs.bib
region: Pacific Region
# ---------------------
# End of options to set
# ---------------------
knit: bookdown::render_book
site: bookdown::bookdown_site

csl: csl/csas.csl
lot: true
lof: true
header-includes:
- \setcounter{section}{1}
---

<!--chapter:end:index.Rmd-->

```{r setup, echo=FALSE, cache=FALSE, message=FALSE, results='hide', warning=FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  warning = FALSE,
  message = FALSE,
  comment = "#>",
  fig.path = "knitr-figs/",
  cache.path = if (knitr:::is_latex_output()) "knitr-cache-tex/" else "knitr-cache-docx/",
  fig.asp = 0.618,
  fig.width = 7.5,
  out.width = "6in",
  echo = FALSE,
  autodep = TRUE,
  cache = TRUE,
  cache.comments = FALSE,
  dev = if (knitr:::is_latex_output()) "pdf" else "png",
  dpi = 200,
  fig.align = "center",
  fig.pos = "htb"
)
source(file.path(here::here(), "R", "all.R"))
```

```{r load-models, cache=TRUE}
build(ovwrt.base = FALSE,
      ovwrt.sens = FALSE,
      ovwrt.retro = FALSE,
      burnin = 1000,
      thin = 1)
load.models.into.parent.env()
source(file.path(rootd.R, "custom-knitr-variables.R"))
```

```{r setup-tables, cache=FALSE, echo=FALSE}
if(!knitr:::is_latex_output())
  options(knitr.table.format = "pandoc")
```

<!--chapter:end:00-load.Rmd-->

# INTRODUCTION

## STOCK STRUCTURE AND LIFE HISTORY

Pacific Cod (*Gadus macrocephalus*) is a relatively short-lived, fast-growing member of the family Gadidae. A common name in British Columbia (BC) is grey cod (or gray cod). Stocks of Pacific Cod are distributed from California, throughout the waters of BC, Gulf of Alaska and the Bering Sea to Russia, Korea, Japan and China [@hart1973]. Maximum observed age in British Columbia is around 10--11 years [@westrheim1996, this document], while a maximum age of approximately 13 years has been reported for Alaskan stocks [@roberson2001]. Maximum length recorded in British Columbia is 100 cm [@hart1973], although some larger specimens have been observed in Alaska and Russia [@westrheim1996]. In recent Synoptic trawl surveys in BC, the maximum recorded length was 93 cm (Appendix A, Table \@ref(tab:length-biosamples-surv)). Pacific Cod are demersal spawners, with several studies reporting that spawning most likely occurs during February to March. A comprehensive review of the biology, life history and distribution of Pacific Cod in BC is provided by @westrheim1996.

Four stocks of Pacific Cod are defined for management purposes on the BC coast: Strait of Georgia (4B); West Coast Vancouver Island (3CD); Queen Charlotte Sound (5AB); and Hecate Strait (5CD). This study focuses on the stocks in Queen Charlotte Sound combined with Hecate Strait (5ABCD), and the West Coast Vancouver Island (3CD) (Figure \@ref(fig:fig-map)).

Recent genetic analyses have identified a distinction between North American and Asian Pacific Cod stocks, and have shown some evidence for distinction between Alaskan stocks and those south of Dixon Entrance in British Columbia [reviewed in @forrest2013]. There is also evidence that fish taken off the coast of Washington and the west coast of Vancouver Island may be distinct from fish sampled within the Strait of Georgia or Puget Sound. However, linkages, if any, among stocks in BC and those in Alaska remain poorly understood. To date it is uncertain whether genetic stock structure exists within BC waters [@forrest2013]. Genetic samples have been collected from spawning grounds in Hecate Strait and Queen Charlotte Sound since the 2013 assessment but these have not yet been analyzed.

The choice to provide science advice for combined areas 5AB and 5CD in a single stock assessment was due mainly to poor model diagnostics and the lack of historical fishery-independent indices of abundance for Area 5AB [@forrest2013]. There is also no evidence for genetic distinction between these two stocks. Provision of science advice for Areas 5ABCD combined should not imply that the areas should be managed as a single area, which is a choice for fishery managers in consultation with fishing industry members and other interested parties.

## ECOSYSTEM CONSIDERATIONS

Population dynamics of Pacific Cod in BC have been characterized by large estimated variations in abundance [e.g., @sinclair2001; @forrest2013], although the causes are not clear. Hypotheses for apparent cyclic abundance in Hecate Strait include predator-prey cycles [@walters1986], density-dependent growth and mortality [@fournier1983], and northward water transport of larvae [@tyler1986; @tyler1991]. Natural mortality has been estimated as high as 0.6--0.65 *y*^-1^ in some stock assessments [e.g., @fournier1983; @sinclair2005] although lower estimates (~0.4 *y*^-1^) have also been obtained [@sinclair2001; @forrest2013]. The combination of apparently volatile dynamics with short life span and high natural mortality suggests periods of over/under harvest could result if harvest strategies are not robust to these features. Also, in the context of the BC integrated groundfish fishery, constraints imposed by quotas for other species and economic considerations can mean that a single-species approach does not necessarily dictate the best harvest strategy.

### PREY AND PREDATORS

Pacific Cod are omnivores, eating a diet of mainly marine invertebrates, including amphipods, euphausiids, shrimp and crabs. At around 50--55 cm they also become piscivorous, with Pacific Sand Lance (*Ammodytes hexapterus*) and Pacific Herring (*Clupea pallasi*) becoming important components of the diet [@westrheim1996]. Juvenile Sablefish (*Anoplopoma fimbria*) and adult Pacific Hake (*Merluccius productus*) have also been reported in the diet of Pacific Cod off the west coast of Vancouver Island @ware1986. Pacific Cod have been reported in the diets of Pacific Halibut (*Hippoglossus stenolepis*), North Pacific Spiny Dogfish (*Squalus suckleyi*), sea birds, seals and sealions [@westrheim1996].

@walters1986 demonstrated a Pacific Cod-Herring predator-prey interaction in Hecate Strait, in contrast to @ware1986. Simulation models developed by @walters1986 concluded that availability of Pacific Herring prey could be an important driver of Pacific Cod production in Hecate Strait, and, similarly, that Pacific Cod predation could be a significant driver of Pacific Herring abundance. These authors acknowledged that there are alternative hypotheses for cycles in abundance of Pacific Cod and Pacific Herring (e.g., environmental forcing; see below) and suggested that large-scale management experiments may be the only way to distinguish among competing hypotheses.

### ENVIRONMENT


Several studies have investigated linkages between recruitment and environmental indices for Pacific Cod in Hecate Strait (see @westrheim1996 for review). The dominant hypothesis is an inverse relationship between recruitment and northward  advection of larvae [@tyler1986; @tyler1991]. Northward advection has been shown to be positively correlated with mean annual sea level at Prince Rupert during the spawning season, which in turn has been used as an explanatory variable for recruitment by a number of authors [@fournier1983; @sinclair2000; @sinclair2005-2; @sinclair2005]. However, recent updates of the analyses by @tyler1991 failed to find a continuing correlation between Prince Rupert Sea level and recruitment of Pacific Cod in Hecate Strait (R. Forrest, Pacific Biological Station, unpublished data).This could in part be due to low quotas (and therefore lower catches) since 2001, contributing to low stock assessment estimates of recruitment in recent years [@forrest2013].

### OTHER SPECIES

Other species caught with Pacific Cod include Arrowtooth Flounder (*Atheresthes stomias*), Yellowtail Rockfish (*Sebastes flavidus*), Pacific Ocean Perch (*S. alutus*), Lingcod (*Ophiodon elongatus*), Silvergray Rockfish (*S. brevispinis*), English Sole (*Parophrys vetulus*) and Big Skate (*Raja binoculata*) [@forrest2013]. Vessels catching Pacific Cod must hold quota for all quota species encountered [@dfo2017]. Since 1996, there has been 100% at-sea observer coverage on commercial bottom trawl vessels in BC. At-sea releases are recorded by observers and counted against the vessel's quota, according to agreed-upon discard mortality rates.

## FISHERIES

Pacific Cod in BC are caught almost entirely in the groundfish bottom trawl fishery, which is part of BC's integrated groundfish fishery [@dfo2017]. They are also caught in very small quantities in the groundfish longline fishery (around 0.5% of the total annual catch on average), also part of the integrated fishery. Currently, the majority of the BC Pacific Cod catch is taken from Hecate Strait (Area 5CD), where it is one of the principal target species of the trawl fishery (Figures \@ref(fig:fig-catch-5ab),\@ref(fig:fig-catch-5cd) and \@ref(fig:fig-catch-3cd)). Commercial catches also come from Queen Charlotte Sound (Area 5AB) and the west coast of Vancouver Island (Area 3CD). Near negligible catch is also taken from the west coast of Haida Gwaii, Area 5E ( < 0.5% of total average annual catch since 1985).

Pacific Cod are distributed throughout Hecate Strait (Area 5CD) at depths mainly less than 150 m. Pacific Cod density appears to be highest over the Two Peaks/Butterworth, White Rocks, Shell Ground, Reef Island, and Horseshoe fishing grounds [Appendices \@ref(fishery-independent-indices-of-abundance) and \@ref(commercial-cpue-standardization),  @forrest2013]. In Queen Charlotte Sound (Area 5AB), Pacific Cod are caught mainly off Cape Scott and Mexicana Banks, north of Vancouver Island, in Area 5A, and around the edge of Goose Island Bank in Area 5B  [Appendix \@ref(fishery-independent-indices-of-abundance) and \@ref(commercial-cpue-standardization), @forrest2013]. The depth range of capture in 5ABCD ranges from around 60--200 m, with data showing a shift to deeper depths since 1996 (Appendix B, Figure \@ref(fig:cpue-depth-hists)). The transition to deeper fishing grounds reflects a larger proportion of catches coming from deeper waters in Queen Charlotte Sound in more recent years (Figures \@ref(fig:fig-catch-5ab) and \@ref(fig:fig-catch-5cd)). Annual reported catches of Pacific Cod in both Hecate Strait and Queen Charlotte Sound have shown considerable variability since the beginning of the time series in 1956 (Figure \@ref(fig:fig-catch-5abcd)). The depth range of catches off West Coast Vancouver Island (Area 3CD) is similar to Area 5ABCD, with the majority of catch coming from 50--200 m depth zones (Appendix B, Figure \@ref(fig:cpue-depth-hists)). See @sinclair2001 for description of changes in historical depth ranges of the fishery. See also Appendix B. Historical catches in Area 3CD have shown a similarly variable pattern to Area 5ABCD (Figure \@ref(fig:fig-catch-3cd)).

Prior to the introduction of at-sea observer coverage in 1996, estimates of at-sea releases (discards) for the period 1956--1995 were obtained from fishing logbooks. These estimates are considered an underestimate of the actual releases (Tables \@ref(tab:tab-catch-5abcd) and \@ref(tab:tab-catch-3cd)). Estimates in years following the introduction of 100% at-sea observer coverage in 1996 can be considered to be  accurate. Since 1996, the proportions of estimated discards have been considerably higher than in years before at-sea observers (Tables \@ref(tab:tab-catch-5abcd) and \@ref(tab:tab-catch-3cd)), especially in Queen Charlotte Sound, largely as a result of reduced total catches and TACs (Table \@ref(tab:tab-tac)). Pacific Cod can be legally discarded by trawlers in BC. However, on-board observers first estimate the quantity being discarded. Therefore, in addition to greater accuracy in reporting of discards since 1996, incentives to avoid discarding have also been greater.

Japanese and Soviet vessels also trawled in waters off BC in the late 1960s and early 1970s. These vessels were mainly targeting rockfish and likely at depths greater than 150 m. The bycatch of Pacific Cod in these fisheries is, however, unknown. Given uncertainty in foreign catches and discards in the earlier parts of the time series, total catch estimates should be considered underestimates prior to 1996.

Total fishing effort of bottom trawl vessels has declined in all areas in recent years. A detailed analysis of catch per unit effort (CPUE) is provided in Appendix B. As noted by @sinclair2000, there are a number of problems with the use of commercial catch per unit effort as an index of biomass for Pacific Cod. Changes in the management regime from an unrestricted fishery prior to 1992, to the introduction of TACs (1992--1996) and then to Individual Vessel Quotas (IVQs) (1997-present), as well as several increases in mesh size [@forrest2013, their Table 5], have affected the underlying relationship between commercial CPUE and abundance, and the relationship between fishing effort and fishing mortality. In recent years of lower Pacific Cod quotas (Table \@ref(tab:tab-tac)), many fishing masters report actively avoiding Pacific Cod to prevent their Pacific Cod quota being exceeded before catching available quotas for other species. In the present assessment CPUE series are split into pre- and post-1996 series, and generalized linear mixed affect models are used to attempt to standardize the indices (Appendix \@ref(commercial-cpue-standardization)).

## ASSESSMENT HISTORY

A number of methods have been used to assess Pacific Cod in Hecate Strait since the 1980s. @fournier1983 developed an age-structured model and used it to test for evidence of age-dependent trends in natural mortality, density-dependent natural mortality and catchability, and also for evidence of an environmental factor affecting recruitment. Evidence was found for a relationship between mean sea level at Prince Rupert and recruitment, and also for density-dependent natural mortality. Natural mortality was estimated to be 0.65 *y*^-1^ by @fournier1983. This author cautioned about the possibility of confounding among model parameters and systematic data biases that could influence conclusions from the analysis. Estimates of age were obtained from length-frequency analysis [@foucher1982].

Pacific Cod are one of the most difficult Pacific groundfish species to age. Annual rings (annuli) in otoliths, other bony structures and scales are difficult to distinguish from interannual growth checks [@beamish1981; @chilton1982; @roberson2001; @johnston2012]. In British Columbia, age compositions have been estimated using length-based approaches, scales, otoliths and, currently, dorsal fin ray sections, although all methods present difficulties. In the absence of reliable direct age data, length-based approaches were used to assess the Hecate Strait stock during the 1990s [e.g., @haist1995; @haist1998]. In the last of these, @haist1998 suggested that the stock had reached an historic low in 1996, followed by a slight rebound.

@sinclair2000 used a simple surplus production model fit to a commercial CPUE index to assess the Area 5CD stock in 2000. This author cited significant structural changes in the fishery during the 1990s resulting in changes in quality and comparability of fishery-dependent data available for the analysis. Changes included voluntary increases in mesh size in the commercial fishery and introduction of individual vessel quotas (IVQs) in 1997 as discussed above. Given the large structural differences between the previous length-based models and the surplus production model, @sinclair2000 noted that results were remarkably comparable until 1994, with three estimated peaks in abundance occurring in 1965, 1974--5 and 1986--7. The two approaches diverged significantly after 1994, with the length-based Multifan model [@haist1998] estimating an increase in biomass while the surplus production model estimated a decline. The differences were interpreted to be due to differences in the indices of abundance used to tune the models, as well as structural model differences.

@sinclair2001 developed a delay-difference model [@deriso1980; @schnute1985] containing a Ricker stock-recruit function to assess Pacific Cod in Areas 3CD and 5CD. Recruitment was assumed to be knife-edged at age 2 years. A report card summary of information available for the stock was also developed. The delay-difference model provided a better statistical fit to the data than the previously-applied surplus production model [@sinclair2000]. However, biomass estimates followed a similar trend and magnitude. The 2001 Area 3CD stock was updated in 2002 [@Starr2002], using the same delay-difference model developed the previous year [@sinclair2001] and adding data from DFO's shrimp trawl survey. The authors of the 2002 assessment noted that the estimated MSY-based reference points *F*~MSY~ and *B*~MSY~ were not well estimated [@Starr2002].

The Area 5CD assessment was updated in 2004 [@sinclair2005], using a similar delay-difference model to that used by @sinclair2001, but using a Beverton-Holt stock-recruit function. Model fits were presented with alternative combinations of fixing or estimating natural mortality (*M*) and the steepness parameter of the stock-recruit function, *h* (Mace and Doonan 1988). They reported similar fits and biomass estimates for both scenarios but noted very different estimates of equilibrium MSY-based management parameters under alternative combinations of fixed and estimated *h* and *M*. They proposed "history-based" reference points, based on estimated historical biomass and fishing mortality, due to unreliability of MSY-based reference points.  The Area 5AB and 5CD stocks were last assessed in 2013 [@forrest2013] using a new delay-difference model with a Beverton-Holt stock-recruit function and the assumption of knife-edged selectivity at 2 y. The model had some minor structural differences from the previous assessment, although bridging analyses showed these to have a relatively minor effect [@forrest2013, their Appendix A]. The 2013 assessment adopted the same historical reference points that had been used in 2004 and these were accepted during peer review for Area 5CD [@dfo2015]. However, no reference points were accepted for Area 5AB [@dfo2015-2]. Key uncertainties noted by @forrest2013 were:

1. Uncertainty in fixed variance parameters, particularly the assumed observation error in the surveys, and the objective function component of the fit to annual mean weights;
2. Reliability of commercial CPUE as an index of abundance, and effects on CPUE of management changes post-1996;
3. Uncertainty in the prior probability distribution used for natural mortality *M*;
4. Uncertainty in the growth function (model parameters and assumptions of stationarity);
5. The possibility of violating the assumption of knife-edged recruitment at age 2 years, given evidence for younger fish in the length composition data from the commercial fishery; and
6. Uncertainty in stock structure.

Sensitivity to the first three of these uncertainties was partially addressed in @forrest2013 through the presentation of sensitivity analyses and alternative "model-averaged" decision tables for Areas 5AB and 5CD. The fourth and fifth uncertainties are partially addressed in the current assessment through the addition of extra sensitivity analyses comparing the previous and updated growth parameters, and comparing results with the assumption of knife-edged selectivity (Section \@ref(sensitivity-analyses)). The sixth is still a key uncertainty for Pacific Cod. In the current assessment, data from Areas 5AB and 5CD are combined, under the assumption that Pacific Cod in Queen Charlotte Sound and Hecate Strait belong to a single stock.

# DATA SOURCES

## DATABASES

Data were extracted from a number of different databases:

**GFBio**:
Biological samples and research cruise database. Groundfish Section, Marine
Ecosystems and Aquaculture Division, Science Branch, Fisheries and Oceans Canada,
Pacific Biological Station. This data archive includes most of the groundfish
specimen data collected since the 1950s. It therefore includes data from a variety
of sources (port and at-sea commercial sampling, research survey sampling),
collected using a variety of sampling methods.

**GFCatch**:
Canadian trawl landings, 1954--1995 [@rutherford1999].

**PacHarvTrawl**:
Canadian trawl landings, 1996 to March 31, 2007. SQL Server database, Groundfish Section, Marine Ecosystems and Aquaculture Division, Science Branch, Fisheries and Oceans Canada, Pacific Biological Station.

**GFFOS**:
Canadian trawl landings, April 1, 2007 to 2017. View of the Fisheries and Oceans Canada (DFO) Fishery Operations (FOS) database. Groundfish Section, Marine Ecosystems and Aquaculture Division, Science Branch, Fisheries and Oceans Canada, Pacific Biological Station.

## CATCH DATA

Groundfish fisheries were managed by calendar year until 1996. Beginning in 1997--98 the fishing year changed to April 1--March 31. In 2010--2011 the fishing year was changed again to February 21 to February 20. Throughout this document, as in @forrest2013, fishing years are defined as beginning on April 1 for all years, and are referenced by starting year, e.g., fishing year 1957 runs from April 1, 1957 to March 31, 1958. These definitions were used consistently in all calculations involving commercial catch data, including development of the commercial CPUE index (Appendix \@ref(commercial-cpue-standardization)) and calculation of annual average mean weight in the catch (Appendix \@ref(analysis-of-biological-data)). Landings data are presented separately for Canada and the USA (Tables \@ref(tab:tab-catch-5abcd) and \@ref(tab:tab-catch-3cd)). Combined USA-Canada landings data were obtained from the Pacific Marine Fisheries Commission reports for 1956--1981 and the USA landed portion was determined by subtracting the Canadian landed amount from the combined total for each year. In cases where the difference was negative, the USA landed amount was set to zero. Canadian data were obtained from the GFCatch database for the period 1954--1995 [@rutherford1999]; from the PacHarvest database for the period 1996-March 31, 2007; and from the Fisheries and Oceans Canada (DFO) FOS database for the period April 1, 2007 until the present. The annual size compositions of commercial catches and landings were estimated from port samples and at-sea samples collected by observers archived in the GFBio database (Appendix \@ref(analysis-of-biological-data).

At the time of the assessment, the 2018 fishing year was incomplete. In order to provide projections for the 2019 fishing season, the 2018 catch was extrapolated in each area. For Area 5ABCD, the three year average proportion of catch taken by September 30 (88.4%) was used to extrapolate from the catch at September 30, 2018 to the total estimated catch for the 2018 fishing year (Table \@ref(tab:tab-catch-5abcd)). For Area 3CD, the 2018 catch to September 30 was anomolously low for reasons that were unclear but that could have been related to the fishing industry delaying opportunities to catch Pacific Cod. Therefore, the total catch for the 2018 fishing year was extrapolated to be the same as the catch for 2017 (Table \@ref(tab:tab-catch-3cd)).

## INDICES OF ABUNDANCE

Stock assessment models in Area 5ABCD were fit to three fishery-independent survey indices (Hecate Strait Multispecies Assemblage Survey, Hecate Strait Synoptic Survey and Queen Charlotte Sound Synoptic Survey) and two commercial CPUE indices derived from commercial bottom trawl catch and effort data (pre-1996 and post-1995).

Stock assessment models in Area 3CD were fit to two fishery-independent survey indices (West Coast Vancouver Island Synoptic Survey and NMFS Triennial Survey in Canada) and two commercial CPUE indices derived from commercial bottom trawl catch and effort data (pre-1996 and post-1995).

The fishery-independent indices of abundance were developed using swept-area analyses. Descriptions of the surveys and details of the analyses are provided in Appendix \@ref(fishery-independent-indices-of-abundance).

The commercial CPUE indices were standardized for depth, fishing locality, month, vessel, and latitude, when available, using generalized linear mixed models (GLMMs), based on a Tweedie distribution. Details are provided in Appendix \@ref(commercial-cpue-standardization).

## BIOLOGICAL DATA

Updates to estimated growth, maturity and annual mean weights in commercial catches are provided in Appendix \@ref(analysis-of-biological-data).

We note that due to the near neglible quantities of catch taken in Area 5E (average <0.5% of total catch since 1985), and from the commercial groundfish longline fishery (around 0.5% of total catch since 1985), data from Area 5E and from the longline fishery are excluded from this assessment.

# STOCK ASSESSMENT MODEL

All models presented in this document are Bayesian models implemented in AD Model Builder [@fournier2012]. The models are based on the Integrated Statistical Catch Age Model (iSCAM), first reported in @martell2011. A major modification by the authors of @forrest2013 and this assessment is inclusion of delay-difference calculations. The model in its present formulation is fully described in Appendix \@ref(delay-difference-model). Two major differences between the current model and the previous assessment [@forrest2013] are:

1. The current model estimates only one average recruitment parameter ($R_{0}$). The models in @forrest2013 and @martell2011 estimated three average recruitment parameters:

  - $R_{0}$, average unfished recruitment used in derivation of stock-recruit parameters;
  - $R_{Init}$, initial average recruitment used to initialize the age structure in the first year; and
  - $R_{Avg}$, average recruitment for the time series.

The decision to use just one average recruitment parameter was made because there is little to no information for estimating three parameters in the delay-difference model, which contains no explicit age composition information.

Also, the von Bertalanffy growth parameters have been updated in the current assessment for both stocks, to reflect more recent age and length data. Details are provided in Appendix \@ref(analysis-of-biological-data).

The reference models for the Area 5ABCD and 3CD assessments are discussed in more detail in Section \@ref(reference-case-models).

# REFERENCE POINTS

The DFO Fishery Decision-making Framework Incorporating the Precautionary Approach (PA) policy [@dfo2009] requires stock status to be characterized using three reference points:

1. A Reference Removal Rate;
2. A Limit Reference Point (LRP);
3. An Upper Stock Reference point (USR).

In the current assessment, these reference points are incorporated into the decision tables, where projected probabilities of breaching the reference points are reported. I.e., reference points are not incorporated into a formal harvest control rule.

Provisional values of $USR = 0.8B_{MSY}$ and $LRP = 0.4B_{MSY}$ are suggested in the absence of stock-specific reference points [@dfo2009]. The framework specifies a limit reference removal rate of $F_{MSY}$. We refer to the reference removal rate as the limit removal rate (LRR) throughout this document. The PA policy also endorses “history-based” proxies based on estimated average spawning biomass and fishing mortality over a productive historical period [@dfo2009].

As already noted, large uncertainties in the productivity parameters *M* and *h* have resulted
in substantial uncertainties in MSY-based reference points for Hecate Strait Pacific Cod in previous assessments [@Starr2002; @sinclair2005; @forrest2013]. Given uncertainty in productivity parameters for this stock, @sinclair2005 suggested using alternative reference points based on the reconstructed history of the stock, i.e., "history-based" reference points. They recommended the Limit Reference Point to be the minimum spawning biomass from which the stock recovered to above average levels. This was estimated to have occurred in 1971 (i.e., $LRP = B_{1971}$). @sinclair2005 suggested long-term average Biomass ($B_{Avg}$) as a candidate proxy Upper Stock Reference and long-term average harvest rate ($U_{Avg}$) as a proxy for the reference removal rate.

@sinclair2005 and @forrest2013 acknowledged that the absolute estimate of biomass in 1971 is dependent on model formulation, but found that most model formulations agreed that 1971 was the year in which the stock was lowest and subsequently recovered to above average levels. Therefore, they recommended the LRP be set at $B_{1971}$, as estimated by the assessment model. The Groundfish Subcommittee of PSARC [@fargo2005] subsequently recommended the use of $B_{1971}$ as the LRP for the Hecate Strait stock and it was again accepted as LRP by a Regional Peer Review (RPR) process in 2014 [@dfo2015] for Area 5CD. Concurrently, long-term average Biomass ($B_{Avg}$) between 1956 and 2004, and long-term average fishing mortality ($F_{Avg}$) for the same period were accepted by the RPR for the Area 5CD USR and LRR, respectively [@dfo2015].

While there was no precedent for reference points in Queen Charlotte Sound, the minimum stock size from which the biomass was estimated to have recovered to an above average level occurred in 1985 [@forrest2013]. These authors proposed $B_{1985}$ as the LRP for the Queen Charlotte Sound, with average biomass and fishing mortality for the period 1956--2004 as the USR and LRR, respectively. However, the RPR did not accept any reference points for the Queen Charlotte Sound (Area 5AB) Pacific Cod stock [@dfo2015-2]. The main reason cited was that the fishery in Area 5AB had become an "avoidance" fishery for Pacific Cod (to avoid breaching the Pacific Cod TAC before TACs for other groundfish species had been realized). Therefore the RPR participants felt that post-1996 estimates of abundance, which were largely informed by low catches, could not be assumed to accurately reflect abundance.

@forrest2018 simulation-tested a set of alternative reference points for Hecate Strait Pacific Cod and Rock Sole (*Lepidopsetta* spp.). They found that the "history-based" reference points (or operational control points, OCPs) that had been used for Pacific Cod in 2013 [@forrest2013] were robust to stock assessment biases because they scaled in the same direction as bias in estimates of biomass and fishing mortality. However, they were not necessarily good proxies for MSY-based reference points and tended to produce more precautionary catch recommendations than reference points based on $B_{MSY}$, $B_{0}$ and the spawning potential ratio (SPR; @clark1991). While the "history-based" reference points outperformed others in terms of long-term conservation outcomes, there were sometimes large trade-offs in terms of catch and catch stability [@forrest2018]. Reference points based on estimated $B_{0}$ performed similarly to the "history-based" reference points but tended to have better trade-off properties [@forrest2018].

Some of the reference point concerns with the 5AB model may have been addressed by combining data for Areas 5AB and 5CD in the present stock assessment. Therefore we suggest using the same USR for Area 5ABCD as had been used for Area 5CD in [@forrest2013]. During the review meeting for this assessment, it was decided by reviewers and attendees to modify the LRP to be the lowest estimated biomass agreed to be an undesirable state to avoid. The change in definition led to using 2000 as the low-biomass year and therefore the limit reference point for this assessment (i.e., $LRP = B_{2000}$).

In the absence of accepted reference points for Area 3CD, we suggest implementing the same approach. The LRP was kept as the biomass in 1986, as in the previous assessment, as it was agreed that moving it to a more recent time period would have a negligible effect. 

In addition to the LRR, LRP and USR discussed above, two benchmark measures are also included: (i) $F_{2017}$ and (ii) $B_{2018}$. Projected biomass and fishing mortality relative to these benchmarks are included in the decision tables to show whether: (i) fishing mortality is projected to increase or decrease under alternative projected 2018 catch levels; and whether biomass is projected to increase or decrease under alternative projected 2018 catch levels.

Suggested reference points and benchmarks for both areas are provided in Section \@ref(sec:reference-points-and-decision-tables}.

# REFERENCE CASE MODELS
Reference Case models were established for Areas 5ABCD and 3CD to show model response under what were considered the most plausible choices across a range of assumptions for each stock. These models served as the basis from which sensitivity runs were made, altering alternative hypotheses one step at a time. Most of these sensitivity runs altered assumptions that the current model configuration and data availability were not able to reliably exclude from consideration. Consequently, these Reference Case models should not be considered to be the “best available information” from which management advice can be provided. Instead, a model averaging approach (see below) was adopted that combined model results across a range of plausible assumptions, which in turn was used to provide management advice.

The Reference Case models for Areas 5ABCD and 3CD shared similar characteristics in terms of data choices, prior probability distributions and fixed parameter settings. For brevity, both reference case models are described in this section, with differences explained as necessary. The Bayesian delay-difference model is fully described in Appendix \@ref(delay-difference-model).

The joint posterior distribution for each model was numerically approximated using the
Markov Chain Monte Carlo routines built into AD Model Builder (Metropolis-Hastings algorithm) [@fournier2012]. Posterior samples were drawn every 5,000 iterations from a chain of length 10 million, resulting in 2,000 posterior samples (the first 1,000 samples were dropped to allow for sufficient burn-in). We assessed consistency with chain convergence by visual inspection of trace plots and autocorrelation plots and through calculating the potential scale reduction statistic $\hat{R}$ and the effective number of simulation draws $n_\mathrm{eff}$ via the R package Stan [@rstan2018].

<!-- https://github.com/stan-dev/stan/blob/238faf42b556c007197c9faca20214ad9b37f0b2/src/docs/reference-manual/analysis.Rmd -->

The potential scale reduction statistic [@gelman1992] is a common metric used in Bayesian statistics to assess chain convergence [@gelman2014; @hobbs2015; @stan-manual2017]. The statistic measures the ratio of the average variance of MCMC samples within each chain to the variance of the samples across chains. As $\hat{R}$ approaches 1.0, the chains are consistent with convergence. In our case, we only had a single chain for each model run, but in following the advice of @gelman2014, we first divided the chain in two, effectively treating the first and second half as separate chains. Following the notation of @hobbs2015, we can calculate $\hat{R}$ for a given parameter $\theta$ as follows. For $j = 1, ..., m$ chains (two half chains here), we calculate the mean of the variances $w$ as:

$$
w=\frac{1}{m}\sum_{j=1}^{m}\operatorname{var}\left(\theta_{j}\right)
$$

where \(\theta_{j}\) is defined as
$\theta_{j}=\frac{1}{K-1}\sum_{n=1}^{K}\left(\theta_{kj}-\overline{\theta}_{j}\right)^{2}$
across $k = 1, ..., K$ iterations. We then define the among-chain variance $b$ as:

$$
b=\frac{K}{m-1}\sum_{j=1}^{m}\left(\overline{\theta}_{j}-\overline{\overline{\theta}}\right)^{2}
$$

where
$\overline{\overline{\theta}}=\frac{1}{m}\sum_{j=1}^{m}\overline{\theta}_{j}$.
The variance of a stationary distribution of $\theta$ is then calculated as a weighted mean
$\sigma_{\theta}^{2}=\left(1-\frac{1}{K}\right)w+\frac{1}{K}b$,
and we can define the potential scale reduction factor as $\hat { R } = \sqrt{\frac{\sigma_{ \theta}^{2}}{w}}$.

The statistic $n_\mathrm{eff}$ measures the effective number of MCMC independent samples after accounting for autocorrelation. For brevity we do not define the full calculation here, but it is available in @gelman2014 pp. 286--287 or @stan-manual2017 pp. 373--376.

## DATA CHOICES

Both models were fit to observed catch data, observed average annual mean weight in the commercial catch, and fishery-independent and -dependent indices of abundance. Details on objective function components of the model are provided in Appendix \@ref(delay-difference-model).

Data sources for observed catch data were described in Section \@ref(data-sources), with values in Tables \@ref(tab:tab-catch-5abcd) and \@ref(tab:tab-catch-3cd) and Figures \@ref(fig:fig-catch-5abcd) to \@ref(fig:fig-discards-5cd) for Area 5ABCD, and Figures \@ref(fig:fig-catch-3cd) to \@ref(fig:fig-discards-3cd) for Area 3CD.

Fishery independent swept area abundance indices are documented in Appendix \@ref(fishery-independent-indices-of-abundance), including biomass estimates, CVs and years covered.

For Area 5ABCD, these are:

1. the Hecate Strait Multispecies Assemblage Survey;
2. the Queen Charlotte Sound Synoptic Survey;
3. the Hecate Strait Synoptic Survey.

For Area 3CD, these are:

1. the West Coast Vancouver Island Synoptic Survey;
2. the NMFS Triennial Survey (in Canada).

Fishery dependent indices are fully documented in Appendix \@ref(commercial-cpue-standardization). In each area, the CPUE time series are standardized GLMMs, with separate analyses for the periods before and after the introduction of 100% observer coverage in 1996, which resulted in large improvements in estimates of catch, discards and general data reliability. The two periods are referred to as: historical (1956--1995) and modern (1996--2017) (Appendix \@ref(commercial-cpue-standardization)).

Details on the calculation of average annual mean weight in the commercial fishery are provided in Appendix \@ref(analysis-of-biological-data). Inclusion of average annual mean weight data is intended to provide information about recruitment in the absence of age-composition data. This is dependent on the underlying assumption of the delay-difference model (Appendix \@ref(delay-difference-model)) that selectivity, growth and natural mortality are constant and knife-edged throughout the time period covered by the model (1956--2017). It is important to note that lower average annual mean weight in the commercial data could indicate a recruitment event, but could also have other causes including smaller proportions of older/larger fish due to fishing or natural mortality, changes in the spatial distribution of the fishery, or changes in growth.

## PRIOR PROBABILITY DISTRIBUTIONS AND FIXED VARIANCE PARAMETERS

The prior probability distributions for leading parameters in the Area 5ABCD and 3CD Reference Case models are provided in Tables \@ref(tab:tab-priors-5abcd) and \@ref(tab:tab-priors-3cd). Graphic presentation of prior probability distributions is provided in Figures \@ref(fig:fig-base-mcmc-priors-5abcd) and \@ref(fig:fig-base-mcmc-priors-3cd). Model sensitivities to prior assumptions are tested in Section \@ref(sensitivity-analyses).

## LEADING PARAMETERS

A broad, uniform prior probability distribution was used for $\ln(R_0)$, reflecting an ignorance the scale of the stock.

A beta distribution was used as a prior for steepness with shape parameters that resulted in a distribution with mean = 0.7 and SD = 0.15. These parameter choices resulted in a distribution with little to no probability density for values less than 0.2 (Figure \@ref(fig:fig-base-mcmc-priors-5abcd)), implying that no transformation was necessary. This is the same prior probability distribution accepted for use in the previous stock assessment [@forrest2013]. @sinclair2005 fixed steepness at 0.75 in one of their "preferred" scenarios. In their other "preferred" scenario, the mode of the joint posterior distribution (MPD) estimate of steepness was 0.53. The prior probability distribution chosen here encompasses both of these values.

A normal distribution was used for $\ln(M)$ with mean = $\ln(0.5)$ and SD = 0.1, as was used in @forrest2013. @sinclair2005 obtained MPD estimates of *M* of 0.596 and 0.567 in their two "preferred" scenarios, whereas @forrest2013 obtained MPD estimates of 0.393 *y*^-1^ and 0.426 *y*^-1^ for Areas 5CD and 5AB, respectively. A bridging analysis done by @forrest2013 suggested that *M* could be considerably lower, depending on the values of other fixed or estimated parameters, and there has been considerable variability of estimates of *M* for Pacific cod throughout its assessment history [@fournier1983; @haist1998; @sinclair2001].

## SURVEY SCALING PARAMETERS (CATCHABILITY)

Broad uniform prior probability distributions were used for the scaling parameter $q_{k}$ for indices *k*:

1. Hecate Strait Multispecies Assemblage Survey;
1. NMFS Triennial Survey; and
1. Commercial CPUE indices.

These priors reflected ignorance of the scale of the survey index relative to the stock. The Hecate Strait Multispecies Assemblage (HSMA) Survey was never designed as a stratified random trawl survey. Instead, it was a grid survey with one fixed location station per grid.  @sinclair1999 assigned each station to a depth stratum and analyzed the data as if the survey used a stratified random design. Because of this post-hoc stratification approach, the relationship between the survey index and the Pacific Cod stock is unknown.  The National Marine Fisheries Service (NMFS) Triennial Survey ventured into Canadian waters seven times in the period 1980 to 2001. The survey was a random transect design, using a random start and then progressing up the west coast of the United States and Canada at 50 nm intervals.  Each transect was stratified by depth and stations along the transect were selected randomly.  The extent that the Triennial survey extended into Canada varied by survey, but the data were analyzed as if the survey had the same areal coverage in every year (see Appendix \@ref(fishery-independent-indices-of-abundance)).  This survey was included in the current 3CD stock assessment to provide fishery independent biomass information in the 1980s and 1990s. However, as for the HSMA survey, the relationship between the survey index and the 3CD Pacific Cod stock is not known. The commercial CPUE indices are standardized catch rates (Appendix \@ref(commercial-cpue-standardization)) with an unknown relationship to stock abundance.

Normal distributions were used for $\ln(q_{k})$ for indices *k* =:

1. Queen Charlotte Sound Synoptic Survey;
2. Hecate Strait Synoptic Survey; and
3. West Coast Vancouver Island Synoptic Survey.

The choice of prior probability distribution for survey scaling parameters has the potential for large impacts on stock assessment outcomes. We therefore present a number of alternative prior formulations as sensitivity analyses for the following informative prior probability distributions in Section \@ref(sensitivity-analyses).

### Survey scaling parameters for Area 5ABCD

We used informative prior probability distributions for the two synoptic surveys based on median posterior estimates of *q* from the most recent stock assessment for Rock Sole [@holt2016]. This was done to constrain the tendency in the models towards estimating implausibly high stock sizes. Rock sole is a flatfish species occupying a similar (although slightly shallower) depth range to Pacific Cod. @holt2016 obtained median posterior estimates of *q* = 0.6280 for Area 5AB and *q* = 0.1869 for Area 5CD. They did not use an informative prior probability distribution for *q*. The CV of their estimates was around 0.3. For our combined Area 5ABCD assessment we pro-rated these values according to the relative areas of habitat in Areas 5AB and 5CD. Adding up the areas of all the surveyed depth strata in each area gave a ratio of approximately 0.65:0.35 (5AB:5CD). Therefore the following values were used as means for the normal prior probability distributions for $\ln(q_{k})$, for

1. *k* = Queen Charlotte Sound Synoptic Survey: mean $\ln(q_{k})$ = $\ln(0.6280
   \cdot 0.65)$ = -0.895998; and
2. *k* = Hecate Strait Synoptic Survey: mean $\ln(q_{k})$ = $\ln(0.1869 \cdot
   0.35)$ = -2.727539;

For both synoptic surveys, the standard deviation of the normal prior probability distribution for $\ln(q_{k})$ was set to 0.3 in log space.

### Survey scaling parameters for Area 3CD

As for Area 5ABCD, we used an informative prior probability distribution for the West Coast Vancouver Island Synoptic Survey based on a median posterior estimate from a recent assessment. Again this was done to constrain the very large stock size estimates made by the model when a uniform prior was applied. There have been fewer recent stock assessments focused on Area 3CD only and none for species in the same depth range as Pacific Cod. Here we used a normal prior probability distribution for $\ln(q_{k})$ with mean set to the median posterior estimate of *q* from the most recent assessment for Area 3CD Pacific Ocean Perch (*Sebastes alutus*) [@edwards2013-2], i.e., mean $\ln(q_{k})$ = $\ln(0.228)$ = -1.47841. The standard deviation of the normal prior probability distribution for $\ln(q_{k})$ was set to 0.3 in log space, as for Area 5ABCD. Pacific Ocean Perch occurs in a deeper depth range than Pacific Cod, but it is a major target species for the trawl fishery and may therefore be informative about catchability in this area. @edwards2013-2 did not use an informative prior probability distribution for *q*.

## FIXED VARIANCE PARAMETERS

The errors in variables approach used to partition process and observation error is described in detail in Appendix \@ref(delay-difference-model). Briefly, The key variance parameter is the inverse of the total
variance, i.e., total precision $\phi^{-2}$ [@martell2011]. This parameter can be fixed or estimated, and was fixed here. The total variance is partitioned into observation and process error components by the model parameter $\rho$, which represents the proportion of the total variance that is due to observation
error [@punt1993; @deriso2007]. These parameters are used to derive the observation error component of the total variance ($\sigma_O$, Eq. \@ref(eq:ddsigo)) and the process error term ($\sigma_R$, Eq. \@ref(eq:ddsigr)), which enters the objective function in the log likelihood function for the recruitment residuals (Eq. \@ref(eq:ddrlt)).

@forrest2013 found it was not possible to obtain plausible estimates of the variance term
$\phi^{-2}$ for their Base Case model. Any attempt to estimate $\phi^{-2}$ resulted in estimates of $\sigma_R$ close to 2.0 and estimates of $\sigma_O$ close to 1.5, with extremely poor fits to the indices of abundance, particularly the commercial CPUE data. It was therefore necessary to fix $\phi^{-2}$ and $\rho$ to give fixed values of $\sigma_O$ and $\sigma_R$. @sinclair2005 also used fixed variance parameters in their assessment of Area 5CD Pacific Cod. @forrest2013 used values of $\phi^{-2}$ and $\rho$ that resulted in $\sigma_O$ = 0.25 and $\sigma_R$ = 0.8. Preliminary model runs with the current dataset found that $\sigma_O$ = 0.25 resulted in poor fits to the synoptic survey indices of abundance, especially in Area 5ABCD. Therefore in the current assessment $\sigma_O$ was reduced to 0.2 in both Reference Case models. Sensitivity tests are provided in Section \@ref(sensitivity-analyses).

In addition to the overall observation error term $\sigma_O$, annual index points for each index of abundance series were weighted by annual CVs, using a multiplicative weighting approach fully described in Appendix \@ref(delay-difference-model).

As for the previous stock assessment for Pacific Cod [@forrest2013], fixed variance components were used for the likelihood components for annual catch ($\sigma_C$) and average annual mean weight ($\sigma_W$). Problems with interpreting the mean weight data were discussed in @forrest2013, their Appendix C. These problems stem from changes over time in the sample sizes of different categories of length data, i.e., sorted and unsorted categories, and lack of data for smaller fish before observers measured fish at sea. Concerns about the use of the mean weight data were also recorded in the review of the 2005 assessment [@fargo2005]. This issue was acknowledged by @sinclair2005, who noted that the mean weight series was necessary for estimation of model parameters but was down-weighted in the objective function. As in @forrest2013, $\sigma_W$ was set to 0.2 in the Reference Case models. Because the model assumes observed catches are known without error, $\sigma_C$ was set to a small value, i.e., $\sigma_C$ = 0.05. However, sensitivity tests to these assumptions are provided in Section \@ref(sensitivity-analyses).

# RESULTS

## AREA 5ABCD: QUEEN CHARLOTTE SOUND AND HECATE STRAIT

The model diagnostics were consistent with convergence (Figure \@ref(fig:fig-base-mcmc-trace-5abcd)) and posterior sample autocorrelation was minor for most parameters (Figure \@ref(fig:fig-base-mcmc-autocor-5abcd)). The value of $\hat{R}$ was $\sim 1.00$ for all parameters (Table \@ref(tab:tab-param-est-table-5abcd)).

The MPD model fits to the five indices of abundance are shown in Figure \@ref(fig:fig-base-index-fits-5abcd). The model followed the general trends of the three fishery-independent indices, but could not fit some of the larger peaks (for example 2004 and 2005 peaks in the Queen Charlotte Sound Synoptic Survey, and the 2013 peak in the Hecate Strait Synoptic Survey, Figure \@ref(fig:fig-base-index-fits-5abcd)). Similarly, the model followed the major patterns in the two CPUE indices but did not capture all the peaks (Figure \@ref(fig:fig-base-index-fits-5abcd)).

@forrest2013 considered goodness of fit to the indices of abundance to be a primary driver of uncertainty in their assessment, as estimates of productivity parameters were sensitive to how well the model fit observed peaks in the indices. They presented a number of sensitivity analyses to treatment of the observation error parameter $\sigma_O$, some of which are explored in the current assessment (Section \@ref(sensitivity-analyses).

Model fit to the average annual weight in the commercial fishery (Figure \@ref(fig:fig-base-mean-weight-5abcd)) was slightly better than in the 2013 assessment [@forrest2013, their Figure 37], which tended to underestimate annual mean weight. However, the current model also tended to underestimate annual mean weight, especially between 1970 and 2000. The slightly improved fit compared to the previous assessment is likely partly due to the updated growth parameters used in the current model compared to the previous assessment (see Section \@ref(sensitivity-analyses)). The effects of alternative values of $\sigma_W$ are evaluated in Section \@ref(sensitivity-analyses).

Model fit to the total commercial catch is shown in Figure \@ref(fig:fig-base-catch-fit-5abcd). Model fits are almost perfect due to the setting $\sigma_C$ = 0.05 in the objective function (Appendix \@ref(delay-difference-model)). This was done so that the model was essentially conditioned on the catch data, which was assumed to be known with very little error, even though pre-1996 discard rates are uncertain.

Posterior probability distributions of estimated parameters are provided in Figure \@ref(fig:fig-base-mcmc-priors-posts-5abcd) and Table (\@ref(tab:tab-param-est-table-5abcd)). The median, 2.5^th^ percentile and 97.5^th^ percentile posterior parameter estimates, and MPD estimates, are provided in Table \@ref(tab:tab-param-est-table-5abcd). With the exception of steepness, the posterior estimates did not appear to be strongly influenced by the prior probability distributions. The posterior probability distribution for steepness was very similar to the prior probability distribution (Figure \@ref(fig:fig-base-mcmc-priors-posts-5abcd)), implying that there is little information about this parameter in the available data. This is common in many stock assessments and was also noted in the previous stock assessments for Areas 5AB and 5CD [@forrest2013]. Sensitivity to the prior distribution assumed for steepness is tested in Section \@ref(sensitivity-analyses).

Posterior probability estimates of $\ln(M)$ tended to be lower than the prior values (Figure \@ref(fig:fig-base-mcmc-priors-posts-5abcd)), with a posterior median estimate of 0.346 *y*^-1^, which is slightly lower than the median posterior estimate of 0.393 *y*^-1^ obtained by @forrest2013 for the Area 5CD stock. As noted above, @forrest2013 reported that posterior estimates of $M$ were strongly influenced by the fit to the index of abundance data. Therefore the value assumed for $\sigma_O$ likely has a stronger influence on estimates of $M$ than the prior probability distribution for $\ln(M)$. This is discussed further in Section \@ref(sensitivity-analyses).

Survey scaling parameters ($q_{k}$) were strongly positively correlated with each other, especially the two synoptic surveys $q_2$ and $q_3$ in Figure \@ref(fig:fig-base-mcmc-pairs-5abcd), which were linearly correlated. This implies that changing the prior probability distribution for one of these parameters will strongly affect the other, and correspondingly, the scale of estimated biomass in the model. Because the two synoptic surveys occur in mostly the same years, it appears that the model had little leeway to change the ratio of their relative scales (see Section \@ref(sensitivity-analyses)). Survey scaling parameters were negatively correlated with $M$. $R_0$ was also positively correlated with $M$, implying that there is limited information in the data to estimate both parameters independently, as they scale together when the estimated scale of the stock changes (Figure \@ref(fig:fig-base-mcmc-pairs-5abcd)).The estimated a posterior distribution for the Queen Charlotte Sound $q$ was well outside of the prior while the posterior distribution for the Hecate St synoptic survey scaling parameter was shifted but still within the compass of the prior distribution (Figure \@ref(fig:fig-base-mcmc-priors-posts-5abcd)). These results indicate that the prior for the QC Sound synoptic survey may not be appropriate for this species/survey combination, especially given the strong linear correlation between the two synoptic surveys ($q_2$ and $q_3$ in Figure \@ref(fig:fig-base-mcmc-pairs-5abcd)).

Estimates of reference points and benchmarks are provided in Table \@ref(tab:tab-ref-points-table-5abcd).

Median posterior estimated biomass $B_{t}$ (with 95% credibility interval) is shown in Figure \@ref(fig:fig-base-biomass-5abcd), with values in Table \@ref(tab:tab-post-biomass-5abcd). Of note is the estimated downturn in estimated biomass since 2011. This is in contrast to the 2013 assessment [@forrest2013, their Figure 16], which projected an increase in biomass for 2014. In the current assessment, this downturn is driven by a decreasing trend in the synoptic surveys since 2013, as well as in the modern CPUE index (Figure \@ref(fig:fig-base-index-fits-5abcd)). Also of note compared to the previous assessment is the lower estimate of $B_0$, which is now estimated to be lower than the 1956 stock biomass, with a smaller confidence interval (Figure \@ref(fig:fig-base-biomass-5abcd)). This is due to the structural change in the current assessment, where all average recruitment parameters are now set to the same estimated value (see Section \@ref(stock-assessment-model)), and may also be a function of the reduction in biomass driven by the drop in biomass indices.

Median posterior estimated relative biomass ($B_{t}/B_0$) (with 95% credibility interval) is shown in Figure \@ref(fig:fig-base-depl-5abcd) and Table \@ref(tab:tab-post-depl-5abcd). Median posterior estimated age-2 recruits and recruitment deviations (with 95% credibility interval) are shown in Figure \@ref(fig:fig-base-recr-5abcd) and Table \@ref(tab:tab-post-recr-5abcd). Recruitment is estimated to have been below average since 1990, with negative recruitment deviations since 2010.This is likely to be the primary reason that this stock is not doing well, in spite of low estimated fishing mortalities (Figure \@ref(fig:fig-base-f-5abcd)).

Median posterior estimated fishing mortality ($F_{t}$) is shown in Figure \@ref(fig:fig-base-f-5abcd). Fishing mortality in 2017 was low compared to the historical period, with the posterior median estimated to be 0.03 y^-1^ (Tables \@ref(tab:tab-ref-points-table-5abcd) and \@ref(tab:tab-post-f-5abcd)).

We ran a retrospective analysis, sequentially removing the terminal year of data for four years to show the effects of each year's data (Figure \@ref(fig:fig-base-retro-biomass-5abcd)). Results clearly show the effects of the biennial synoptic surveys on terminal estimates of biomass. Removing four years of data reverted the model back to its 2013 state, with an increase in biomass as was projected in the previous assessment for the Area 5CD stock [@forrest2013]. Adding the 2014 data had little effect on the model as there were no Area 5AB or 5CD surveys in 2014. However, adding the 2015 data resulted in a lowering of estimated terminal biomass, because of a large drop in the 2015 Hecate Strait Synoptic Survey index (Figure \@ref(fig:fig-base-index-fits-5abcd)).

## AREA 3CD: WEST COAST VANCOUVER ISLAND

The model diagnostics were consistent with convergence (Figure \@ref(fig:fig-base-mcmc-trace-3cd)) and posterior sample autocorrelation was minor for most parameters (Figure \@ref(fig:fig-base-mcmc-autocor-3cd)).The value of $\hat{R}$ was 1.00 for all parameters (Table \@ref(tab:tab-param-est-table-3cd)).

The MPD model fits to the four indices of abundance are shown in Figure \@ref(fig:fig-base-index-fits-3cd). The model fit the two fishery-independent indices quite closely (Figure \@ref(fig:fig-base-index-fits-3cd) a and d), but did not fit the 2012 data point in the West Coast Vancouver Island Synoptic Survey. Similarly, the model followed the major patterns in the two CPUE indices but did not capture all the peaks (\@ref(fig:fig-base-index-fits-3cd) b and c).

As for Area 5ABCD, the model tended to underfit average annual weight in the commercial fishery (Figure \@ref(fig:fig-base-mean-weight-3cd)). The effects of alternative values of $\sigma_W$ are evaluated in Section \@ref(sensitivity-analyses).

Model fit to the total commercial catch is shown in Figure \@ref(fig:fig-base-catch-fit-3cd).

Posterior probability distributions of estimated parameters are provided in Figure \@ref(fig:fig-base-mcmc-priors-posts-3cd) and Table \@ref(tab:tab-param-est-table-3cd). The median, 2.5^th^ percentile and 97.5^th^ percentile posterior parameter estimates, and MPD estimates, are provided in Table \@ref(tab:tab-param-est-table-3cd). As for Area 5ABCD, with the exception of steepness, the posterior estimates did not appear to be strongly influenced by the prior probability distributions. The posterior probability distribution for steepness, however, was very similar to the prior probability distribution (Figure \@ref(fig:fig-base-mcmc-priors-posts-3cd)), implying that there is little information about this parameter in the available data. Sensitivity to the prior distribution assumed for steepness is tested in Section \@ref(sensitivity-analyses).

As for Area 5ABCD, posterior probability estimates of $\ln(M)$ tended to be lower than the prior values (Figure \@ref(fig:fig-base-mcmc-priors-posts-3cd)), with a posterior median estimate of 0.413 *y*^-1^. This is higher than the median posterior estimate of 0.346 *y*^-1^ obtained for the Area 5ABCD stock (Table \@ref(tab:tab-param-est-table-3cd)), and very similar to the value of 0.42 *y*^-1^ obtained by @sinclair2001 for the Area 3CD stock.

Survey scaling parameters ($q_{k}$) were strongly positively correlated with each other (Figure \@ref(fig:fig-base-mcmc-pairs-3cd)). As for Area 5ABCD, the survey scaling parameters were negatively correlated with $M$, implying that there is limited information in the data to distinguish between a small productive stock or a larger, less productive stock (Figure \@ref(fig:fig-base-mcmc-pairs-3cd)). Interestingly, $R_0$ was positively correlated with $M$. As for the QC Sound synoptic survey, the estimated posterior distribution for the WCVI synoptic survey scaling parameter was outside of the prior (Figure \@ref(fig:fig-base-mcmc-priors-posts-3cd)).

Estimates of reference points and benchmarks are provided in Table \@ref(tab:tab-ref-points-table-3cd).

Median posterior estimated biomass $B_{t}$ (with 95% credibility interval) is shown in Figure \@ref(fig:fig-base-biomass-3cd), with values in Table \@ref(tab:tab-post-biomass-3cd). Biomass is estimated to have been on a declining trajectory since 2015. This followed an increasing trend from a historical low level of biomass between 1998 and 2014. The stock is estimated to have increased in abundance since 2008, consistent with an increasing trend in observed abundance in the West Coast Vancouver Island Synoptic Survey since 2010, as well as a general increase in the modern CPUE index since 2008 (Figure \@ref(fig:fig-base-index-fits-3cd)). The downturn in estimated biomass in 2017 is consistent with a slight drop in the West Coast Vancouver Island Synoptic Survey index and a large decrease in the modern CPUE index in 2017.

Median posterior estimated relative biomass ($B_{t}/B_0$) (with 95% credibility interval) is shown in Figure \@ref(fig:fig-base-depl-3cd) and Table \@ref(tab:tab-post-depl-3cd). Median posterior estimated age-2 recruits and recruitment deviations (with 95% credibility interval) are shown in Figure \@ref(fig:fig-base-recr-3cd) and Table \@ref(tab:tab-post-recr-3cd). Recruitment is estimated to have been below average for most years in the past two decades, with above average peaks in 2009, 2013 and 2014.

Median posterior estimated fishing mortality ($F_{t}$) is shown in Figure \@ref(fig:fig-base-f-3cd). Fishing mortality in 2017 is estimated to be very low, with the posterior median estimated to be 0.01 *y*^-1^ (Tables \@ref(tab:tab-ref-points-table-3cd) and \@ref(tab:tab-post-f-3cd)), reflecting low catches during the past decade (Figure \@ref(fig:fig-base-catch-fit-5abcd)) and an apparent growth in biomass (Figure \@ref(fig:fig-base-biomass-3cd)).

We ran a retrospective analysis, sequentially removing the terminal year of data for four years to show the effects of each year's data (Figure \@ref(fig:fig-base-retro-biomass-3cd)). Results were not so systematic as for Area 5ABCD (Figure \@ref(fig:fig-base-retro-biomass-3cd)) and the relative magnitude of the bias was smaller. The largest effect was the addition of the 2017 data which caused the terminal biomass estimate to shift notably, most likely due to the large drop in the modern CPUE index in 2017 (Figure \@ref(fig:fig-base-index-fits-3cd)).

# SENSITIVITY ANALYSES

We present a number of sensitivity analyses to show the influence of certain data sources, fixed
parameters and prior probability distributions on model outcomes for the Area 5ABCD and 3CD Reference Case models. Prior probability distributions for leading parameters are provided in Tables \@ref(tab:tab-priors-5abcd) and \@ref(tab:tab-priors-3cd). Fixed parameters are provided in Section \@ref(reference-case-models).

For both stocks, we tested sensitivity of the model outputs to the following data and assumptions:

1. Inclusion of a locality-year interaction as a random effect in the commercial CPUE data (historical period: pre-1996 and modern period: post-1995)
1. Inclusion of commercial CPUE indices for the historical and modern periods.
1. Inclusion of the NMFS Triennial Survey index for Area 3CD
1. The prior probability distribution for $\ln(q)$
1. The prior probability distribution for $\ln(M)$
1. The prior probability distribution for steepness
1. The assumption of knife-edged selectivity and maturity at age 2
1. The updated growth parameters
1. The assumed fixed value of observation error $\sigma_O$
1. The assumed fixed value of $\sigma_R$
1. The assumed fixed value of $\sigma_W$
1. The influence of the pre-1996 annual mean weight data
1. The assumption of perfectly-known pre-1996 catch data

Results are presented under these headings below. In all sensitivity runs, as for the Reference Case models, posterior samples were drawn every 5,000 iterations from a chain of length 10 million, resulting in 2,000 posterior samples. The first 1,000 samples were dropped to allow for sufficient burn-in.

## SC 1B AND SC 1C. EXCLUSION OF A LOCALITY-YEAR INTERACTION AS RANDOM EFFECT IN COMMERCIAL CPUE INDICES

The reference case models were fit to historical and modern commercial CPUE indices that included a locality-year interaction as random effect (see Appendix \@ref(commercial-cpue-standardization), Equations \@ref(eq:cpue-tweedie) to \@ref(eq:cpue-vessel)). Two sensitivity analyses are shown to illustrate the effect of omitting the locality-year interaction term (Equation \@ref(eq:cpue-locality-year)) from both historical and modern indices:

> **Sc 1b.** Use equations without the interaction term to create CPUE indices
> for the historical and modern periods. Use the annual CVs resulting from the
> analysis as annual weighting terms in objective function of delay difference
> model (Equations \@ref(eq:ddsigjt), \@ref(eq:ddcjt)).

> **Sc 1c.** Use equations without the interaction term to create CPUE indices
> for the historical and modern periods **and** double the annual CVs resulting
> from the analysis. Input the doubled CVs as weighting terms in objective
> function of delay difference model (Equations \@ref(eq:ddsigjt),
> \@ref(eq:ddcjt)).

Sc 1c was done because the annual CVs of the CPUE indices with omitted locality-year interactions were very small (less than 0.1 in some years). Annual CVs were doubled to address concerns that the objective function of the delay-difference model may have been giving the CPUE indices too much weight.

Resulting posterior estimates of biomass, recruitment, and fishing mortality
compared to the Reference Case models are shown in Figures \@ref(fig:fig-sens1-biomass-5abcd) to \@ref(fig:fig-sens1-f-5abcd) for Area 5ABCD, and Figures \@ref(fig:fig-sens8-biomass-3cd) to \@ref(fig:fig-sens8-f-3cd) for Area 3CD. Removing the locality-year random effect interaction did not have a major effect on the biomass, recruitment, or fishing mortality posteriors. Of these sensitivity tests, removing the locality-year random effect interaction without artificially doubling the CV had the largest effect --- this sensitivity analysis lowered the absolute estimate of biomass slightly and somewhat narrowed the credible intervals.

## SC 1D to 1F. EXCLUSION OF COMMERCIAL CPUE INDICES

A sensitivity analysis was done where the modern CPUE index was removed from the model altogether (Sc 1d). This was to address concerns that CPUE in the post-IVQ period (post-1995) may not be a good index of abundance, as some skippers reported avoiding Pacific Cod when quotas were low, especially in Area 5AB [@forrest2013]. For comparison, to illustrate the effect of the historical CPUE index on model output, the historical CPUE index was removed (Sc 1e). Finally, to show the overall influence of the commercial CPUE data on model outcomes, both commercial CPUE indexes were removed (Sc 1f):

> **Sc 1d.** Remove modern CPUE index from the model. Historical
index includes locality-year interaction term as a random effect.

> **Sc 1e.** Remove historical CPUE index from the model. Modern
index includes locality-year interaction term as a random effect.

> **Sc 1f.** Remove both CPUE indices from the model.

Resulting posterior estimates of biomass, recruitment, and fishing mortality compared to the Reference Case models are shown in Figures \@ref(fig:fig-sens1-biomass-5abcd) to \@ref(fig:fig-sens1-f-5abcd) for Area 5ABCD and Figures \@ref(fig:fig-sens8-biomass-3cd) to \@ref(fig:fig-sens8-f-3cd) for Area 3CD. For clarity biomass trajectories without Sc 1e and 1f are provided in Figures \@ref(fig:fig-sens1-sub2-biomass-5abcd) and \@ref(fig:fig-sens8-sub2-biomass-3cd).

Removing the modern CPUE index from the model had little effect on the biomass, recruitment, or fishing mortality posteriors (Figures \@ref(fig:fig-sens1-sub2-biomass-5abcd) and \@ref(fig:fig-sens8-sub2-biomass-3cd)). However, removing the historical CPUE index had a large effect on the posterior estimates --- especially the biomass estimates --- substantially increasing the estimates of biomass prior to approximately 1970 (Figures \@ref(fig:fig-sens1-biomass-5abcd) and \@ref(fig:fig-sens8-biomass-3cd)). A similar strong influence of historical CPUE was noted by @forrest2013 who included a no-CPUE model run in their final model averaged decision tables.

## SC 1G. EXCLUSION OF THE NMFS TRIENNIAL SURVEY INDEX FOR AREA 3CD

For Area 3CD only, a sensitivity analysis was done where the NMFS Triennial Survey index was removed from the model:

> **Sc 1g (Area 3CD only).** Remove NMFS Triennial Survey index from the model.

Resulting posterior estimates of biomass, recruitment and fishing mortality compared to the Reference Case models are included in Figures \@ref(fig:fig-sens8-sub2-biomass-3cd) to \@ref(fig:fig-sens8-f-3cd).There was very little impact on the biomass trajectory compared to the reference case in this sensitivity run.

## SC 2A AND 2B. PRIOR PROBABILITY DISTRIBUTION FOR SURVEY SCALING PARAMETERS (CATCHABILITY)

The absolute scale of the estimated biomass in the two assessed areas, determined by estimated catchability (*q*) in the survey indices, is considered the major axis of uncertainty in this assessment. For 5ABCD, six sensitivity analyses are shown to illustrate the effect of the normal prior probability distributions assumed for $\ln(q)$ for the QCS and HS Synoptic Surveys (see Sections \@ref(survey-scaling-parameters-for-area-5abcd) and \@ref(survey-scaling-parameters-for-area-3cd) for Reference Case details:

> **Sc 2a.** The mean of the QCS Synoptic Survey prior was set to the same mean as for the HS Synoptic Survey, and was then pro-rated according to relative areas, i.e., mean $\ln(q)$ = $\ln(0.1869 \cdot 0.65)$.

> **Sc 2b.** No prior was used for \textit{q} for either the QCS and HS Synoptic Surveys.

Four additional analyses were done to bracket the considerable uncertainty in the scale of the stock.

> **Sc 2c.** The means of the QCS and HS Synoptic Survey priors were set to ln(0.5), and were then pro-rated according to relative areas, i.e.,for Queen Charlotte Sound mean $\ln(q)$ = $\ln(0.5 \cdot 0.65)$ ; and for Hecate Strait mean $\ln(q)$ = $\ln(0.5 \cdot 0.35)$.

> **Sc 2d.** The means of the QCS and HS Synoptic Survey priors were set to ln(1), and were then pro-rated according to relative areas, i.e.,for Queen Charlotte Sound mean $\ln(q)$ = $\ln(0.65)$ ; and for Hecate Strait mean $\ln(q)$ = $\ln(0.35)$.

> **Sc 2e.** The SDs of the QCS and HS Synoptic Survey priors were set to 0.6.

> **Sc 2f.** The SDs of the QCS and HS Synoptic Survey priors were set to 1.0.

For 3CD, six sensitivity analyses are shown to illustrate the effect of the normal prior probability distribution assumed for $\ln(q)$ for the WCVI Synoptic Survey:

> **Sc 2a.** The SD of the WCVI Synoptic Survey was set to the same SD as the value estimated by @edwards2013-2 for Pacific Ocean Perch, i.e., SD = 0.448.

> **Sc 2b.** No prior was used for \textit{q} for the WCVI Synoptic Survey.

As for Area 5ABCD, four additional analyses were done to bracket the considerable uncertainty in the scale of the stock.

> **Sc 2c.** The mean of the WCVI Synoptic Survey prior was set to ln(0.5).

> **Sc 2d.** The mean of the WCVI Synoptic Survey prior was set to ln(1).

> **Sc 2e.** The SD of the WCVI Synoptic Survey prior was set to 0.6.

> **Sc 2f.** The SD of the WCVI Synoptic Survey prior was set to 1.0.

Models were moderately sensitive to choice of the parameters used for the normal prior for $\ln(q)$ (Sc 2a; Figures \@ref(fig:fig-sens2-biomass-5abcd) and \@ref(fig:fig-sens9-biomass-3cd)). For clarity, estimated biomass biomass trajectories without Sc 2b is provided for Area 3Cd in Figure \@ref(fig:fig-sens9-biomass-3cd-sub). Essentially, lowering the value of the mean (Area 5ABCD), or increasing the variance (Area 3CD) resulted in lower estimates of $q$ (Tables \@ref(tab:tab-param-table-sens2a-5abcd) and \@ref(tab:tab-param-table-sens2a-3cd)), leading to larger estimates of biomass (Figures \@ref(fig:fig-sens2-biomass-5abcd) and \@ref(fig:fig-sens9-biomass-3cd-sub)) and recruitment (Figures \@ref(fig:fig-sens2-recr-5abcd) and \@ref(fig:fig-sens9-recr-3cd)).

Notably, removing the informative prior in Sc 2b resulted in very low estimates of $q$ for these surveys (Tables \@ref(tab:tab-param-table-sens2b-5abcd) and \@ref(tab:tab-param-table-sens2b-3cd)),leading to very large and uncertain estimates of biomass (Figures \@ref(fig:fig-sens2-biomass-5abcd) and \@ref(fig:fig-sens9-biomass-3cd)) and recruitment (Figures \@ref(fig:fig-sens2-recr-5abcd) and \@ref(fig:fig-sens9-recr-3cd)). This was extremely pronounced for Area 3CD (Table \@ref(tab:tab-param-table-sens2b-3cd) and Figure \@ref(fig:fig-sens9-biomass-3cd)) For both areas, increased estimates of biomass led to decreased estimates of $F_{t}$ (Figures \@ref(fig:fig-sens2-f-5abcd) and \@ref(fig:fig-sens9-f-3cd)).

Given model sensitivity to priors assumed for survey $ln(q)$, and the tendency of the estimates to run to very low values without prior constraint, it seems justified to use a prior probability distribution informed by age-structured assessments for groundfish species caught in the same areas with the same gear, even though those estimates are conditional on the assumptions inherent in those models. Synoptic survey *q* should be considered a major source of uncertainty in this assessment and we suggest inclusion of Sc 2a (both areas) in the ensemble of models for model-averaged decision tables (Section \@ref(sec:reference-points-and-decision-tables)).

## SC 3A TO 3C. PRIOR PROBABILITY DISTRIBUTION FOR *M*

Three sensitivity analyses are shown to illustrate the effect of the parameters of the normal prior distribution assumed for $\ln(M)$:

> **Sc 3a.** The mean was held at the Reference Case value of 0.5, while the standard
  deviation was increased to 0.2.

> **Sc 3b.** The mean was reduced to 0.4 and the standard deviation was held at
  the Reference Case value of 0.1.

> **Sc 3c.** The mean was reduced to 0.4 and the standard deviation was increased
  to 0.2.

Resulting posterior estimates of biomass, recruitment and fishing mortality compared to the Reference Case models are shown in Figures \@ref(fig:fig-sens3-biomass-5abcd) to \@ref(fig:fig-sens3-f-5abcd) for Area 5ABCD and Figures \@ref(fig:fig-sens10-biomass-3cd) to \@ref(fig:fig-sens10-f-3cd) for Area 3CD. Resulting parameter estimates are provided in Tables \@ref(tab:tab-param-table-sens3a-5abcd) to \@ref(tab:tab-param-table-sens3c-5abcd) for Area 5ABCD and Tables \@ref(tab:tab-param-table-sens3a-3cd) to \@ref(tab:tab-param-table-sens3c-3cd) for Area 3CD.

For Area 5ABCD, respective median posterior estimates of *M* for Sc 3a, 3b and 3c were 0.324 y^-1^, 0.287 y^-1^ and 0.298 y^-1^. These values are compared to the median posterior Reference Case estimate of *M* = 0.346 y^-1^.

For Area 3CD, respective median posterior estimates of *M* for Scenarios 3a, 3b and 3c were 0.392 y^-1^, 0.391 y^-1^ and 0.398 y^-1^. These values are compared to the median posterior Reference Case estimate of *M* = 0.413 y^-1^.

For Area 5ABCD, all sensitivity runs resulted in lower estimates of biomass than the Reference Case model (Figure \@ref(fig:fig-sens3-biomass-5abcd)).This was not surprising, given that all had lower posterior median estimates of *M*. Differences in estimated biomass among scenarios were smaller for Area 3CD, although all were slightly lower than for the Reference Case model (Figure \@ref(fig:fig-sens10-biomass-3cd)).

We suggest inclusion of Sc 3b (both areas) in the ensemble of models for model-averaged decision tables (Section \@ref(sec:reference-points-and-decision-tables)), as this scenario resulted in the biggest difference in estimated biomass in both areas.

## SC 4A AND SC 4B. PRIOR PROBABILITY DISTRIBUTION FOR STEEPNESS

Two sensitivity analyses were done to illustrate the effect of the prior probability distribution assumed for steepness in the reference case model:

> **Sc 4a.** Use a uniform prior for steepness bounded between 0.21 and 0.999.

> **Sc 4b.** Use a beta prior for steepness with mean = 0.85 and sd = 0.15.

Resulting posterior estimates of biomass, recruitment and fishing mortality compared to the Reference Case models are shown in Figures \@ref(fig:fig-sens4-biomass-5abcd) to \@ref(fig:fig-sens4-f-5abcd) for Area 5ABCD, and Figures \@ref(fig:fig-sens11-biomass-3cd) to \@ref(fig:fig-sens11-f-3cd) for Area 3CD. Resulting parameter estimates are provided in Tables \@ref(tab:tab-param-table-sens4a-5abcd) to \@ref(tab:tab-param-table-sens4b-5abcd) for Area 5ABCD and Tables \@ref(tab:tab-param-table-sens4a-3cd) to \@ref(tab:tab-param-table-sens4b-3cd) for Area 3CD.

For Area 5ABCD, respective median posterior estimates of *h* for Scenarios 4a and 4b were 0.479 and 0.883.  For Area 3CD, respective median posterior estimates of *h* for Scenarios 4a and 4b were 0.497 and 0.889. This was compared compared to 0.744 for the Area 5ABCD Reference Case and 0.747 for the Area 3CD Reference Case.

Despite the very large range in median posterior estimates of *h* among scenarios for both areas, there was almost no discernible effect on estimated biomass and recruitment, especially for Area 3CD (Figures \@ref(fig:fig-sens4-biomass-5abcd) and \@ref(fig:fig-sens11-biomass-3cd)). Model insensitivity to the prior probability distribution for *h* explains in part why the posterior probability distribution so closely matched the prior for both models (Figures \@ref(fig:fig-base-mcmc-priors-posts-5abcd) and \@ref(fig:fig-base-mcmc-priors-posts-3cd)).

Differences in model sensitivity to the prior for *h* in the current assessment vs. the previous assessment for Area 5CD can be explained by changes in the treatment of average recruitment. The model used in @forrest2013, estimated $R_{0}$ as a separate parameter to average annual recruitment ($R_{Avg}$). As a result, when @forrest2013 tested a uniform prior for *h*, while biomass estimates were unaffected, their posterior estimates of $B_{0}$ became very large [@forrest2013, their Figures 33 and 34]. They described poor model convergence for most parameters and noted the model's tendency to sample very low estimates of steepness coincident with the very large estimates of $\ln(R_0)$. This suggests there was very little information in the data for estimation of a separate $\ln(R_0)$ parameter in the absence of age-composition data, suggesting that it may be preferable to combine average and unfished recruitment, as has been done in the current assessment.

## SC 5A AND 5B. THE ASSUMPTION OF KNIFE-EDGED SELECTIVITY AND MATURITY AT AGE 2, AND EFFECTS OF UPDATING THE GROWTH PARAMETERS

The Reference Case delay-difference models assumed knife-edged selectivity and maturity at age 2 *y* (i.e., age at recruitment $k$ = 2, Table \@ref(tab:tab-param-list)). New analysis of age and maturity data  suggest age at 50% maturity could be closer to 3 *y* for BC Pacific Cod (Appendix \@ref(analysis-of-biological-data)). A sensitivity analysis (Sc 5a) was done to illustrate the effect of assuming that fish recruit to the fishery and mature at age 3 *y*:

Another sensitivity analysis (Sc 5b) was done to illustrate the effects of reverting back to the von Bertalanffy growth parameters used in the previous Area 5CD assessments [@forrest2013; @sinclair2005], which were also used by @sinclair2001 in the last assessment for Area 3CD. These previous stock assessments used the von Bertalanffy parameters that @westrheim1996 reported for Area 3CD, ($L_{inf}$ = 89.48 cm; $K_{VB}$ = 0.307 *y*^1^; and $a_0$ = -0.116 *y*).

The current Area 5ABCD assessment used values of growth parameters estimated in Appendix \@ref(analysis-of-biological-data) using survey age and length data from the Hecate Strait and Queen Charlotte Sound Synoptic Surveys ($L_{inf}$ = 95.51 cm; $K_{VB}$ = 0.19 *y*^1^; and $a_0$ = -0.81 *y*). The current Area 3CD assessment used values of growth parameters estimated in Appendix \@ref(analysis-of-biological-data) using survey age and length data from the West Coast Vancouver Island Synoptic Survey ($L_{inf}$ = 82.59 cm; $K_{VB}$ = 0.26 *y*^1^; and $a_0$ = -0.67 *y*). For both areas, the new values of the growth rate $K_{VB}$ were much lower than used in the previous assessments.The delay-difference model in Sc 5b used Ford-Walford parameters $W_{k}$, $\alpha_g$ and $\rho_g$ (Appendix \@ref(delay-difference-model)) derived from previous growth parameters used in [@forrest2013; @sinclair2005; @sinclair2001].

In summary, the two new scenarios are:

> **Sc 5a.** Set $k = 3 y$ and update weight at recruitment $W_k$ and Ford-Walford parameters accordingly.

> **Sc 5b.** Run the model using the von Bertalanffy growth parameters that were used in the previous stock assessment [@forrest2013].

Resulting posterior estimates of biomass, recruitment and fishing mortality compared to the Reference Case models are shown in Figures \@ref(fig:fig-sens5-biomass-5abcd) to \@ref(fig:fig-sens5-f-5abcd) for Area 5ABCD and Figures \@ref(fig:fig-sens12-biomass-3cd) to \@ref(fig:fig-sens12-f-3cd) for Area 3CD.
Fits to the average annual mean weight in the commercial fishery for Scenarios 5a and 5b are shown in Figures \@ref(fig:fig-sens5-meanweightfit-5abcd) and \@ref(fig:fig-sens12-meanweightfit-3cd).

Not surprisingly, the Area 5ABCD model was sensitive to both the age at knife-edged selectivity and the growth parameters (Figure \@ref(fig:fig-sens5-biomass-5abcd)). For Sc 5a, the model estimated much lower biomass, especially for the historical period. This is expected since this scenario does not include age-2 fish. The fit to the average annual mean weight for Sc 5a (Figure \@ref(fig:fig-sens5-meanweightfit-5abcd) a) was better for the historical portion of the time series than for the Reference Case model, which tended to greatly underfit in some years (Figure \@ref(fig:fig-base-mean-weight-5abcd)). However, it should be remembered that prior to 1996, many observations of small fish were missing from the commercial length data, as only landed fish were measured (Appendix \@ref(analysis-of-biological-data) and @forrest2013, their Appendix C). Therefore, the current Reference Case model is estimating mean weights that were probably present in the catch but not recorded.

For Sc 5b in Area 5ABCD, estimates of biomass were lower than for the Reference Case, especially for the historical period (Figure \@ref(fig:fig-sens5-biomass-5abcd)), with smaller peaks in biomass in the 1970s and 1990s. The von Bertalanffy growth rate used by @forrest2013 and @sinclair2005 was larger than that in the Reference Case model, indicating a more productive stock. Therefore large peaks in catches could be explained by lower biomass in Sc 5b, due to greater stock productivity. Recent estimates of biomass were, however, more similar to the Reference Case (Figure \@ref(fig:fig-sens5-biomass-5abcd)). Fits to the annual average mean weight for Sc 5b (Figure \@ref(fig:fig-sens5-meanweightfit-5abcd) b) were similar to fits in the Reference Case model (Figure \@ref(fig:fig-base-mean-weight-5abcd)).

For Area 3CD, results were broadly similar to those in Area 5ABCD, although differences in biomass between the Reference Case and the two scenarios were more distinct (Figure \@ref(fig:fig-sens12-biomass-3cd)). The fit to the average annual mean weight data was very poor for Sc 5a, and fairly similar to the Reference Case model for Sc 5b (Figure \@ref(fig:fig-sens12-meanweightfit-3cd)). As for Area 5ABCD, the growth rate used in the Reference Case model was lower than that used in Sc 5b. Therefore the model needed to explain catches of a less productive stock with a larger historical biomass.

## SC 6A - 6C. ASSUMED FIXED VALUE OF OBSERVATION ERROR $\sigma_O$

The observation error parameter was $\sigma_O$ was fixed at 0.2 in the Reference Case models (Section \@ref(fixed-variance-parameters)). Three sensitivity analyses were done to explore the impacts of changing this value:

> **Sc 6a.** Fix $\sigma_O$ = 0.10.

> **Sc 6b.** Fix $\sigma_O$ = 0.15.

> **Sc 6c.** Fix $\sigma_O$ = 0.25.

Resulting posterior estimates of biomass, recruitment and fishing mortality compared to the Reference Case models are shown in Figures \@ref(fig:fig-sens6-biomass-5abcd) to \@ref(fig:fig-sens6-f-5abcd) for Area 5ABCD and Figures \@ref(fig:fig-sens13-biomass-3cd) to \@ref(fig:fig-sens13-f-3cd) for Area 3CD.

MPD index fits for the HSMAS, HSSS and QCSS surveys are shown in Figures \@ref(fig:fig-sens6-index-hsmas-5abcd) to \@ref(fig:fig-sens6-index-hsss-5abcd). MPD index fits for the Area 5ABCD commercial CPUE indices are shown in Figures \@ref(fig:fig-sens6-index-cpue-pre1996-5abcd) and \@ref(fig:fig-sens6-index-cpue-post1995-5abcd).

MPD index fits for the WCVISS and Triennial Survey are shown in Figures \@ref(fig:fig-sens13-index-wcviss-3cd) and \@ref(fig:fig-sens13-index-triennial-3cd). MPD index fits for the Area 3CD commercial CPUE indices are shown in Figures \@ref(fig:fig-sens13-index-cpue-pre1996-3cd) and \@ref(fig:fig-sens13-index-cpue-post1995-3cd).

Confidence intervals shown on the plots are derived from the observed data (see Appendices \@ref(fishery-independent-indices-of-abundance) and \@ref(commercial-cpue-standardization)) and are unaffected by the value of $\sigma_O$.

As expected, decreasing the value of $\sigma_O$ resulted in closer fits to indices of abundance in both areas. In Area 5ABCD, reducing $\sigma_O$ also caused a reduction in estimated historical biomass, especially Sc 6a, although recent estimates of biomass were similar among scenarios (Figure \@ref(fig:fig-sens6-biomass-5abcd)). In Area 3CD, results were less pronounced (Figure \@ref(fig:fig-sens13-biomass-3cd)), with more similar index fits among scenarios (Figure \@ref(fig:fig-sens13-index-triennial-3cd)).

Productivity parameters *M* and *h* were sensitive to changes in $\sigma_O$, as were scale parameters $R_{0}$ and catchability parameters \textit{q} (Tables \@ref(tab:tab-param-table-sens6a-5abcd) to \@ref(tab:tab-param-table-sens6c-5abcd) for Area 5ABCD, and Tables \@ref(tab:tab-param-table-sens6a-3cd) to \@ref(tab:tab-param-table-sens6c-3cd) for Area 3CD).

## SC 6C. ASSUMED FIXED VALUE OF PROCESS ERROR $\sigma_R$

The process error parameter was $\sigma_R$ was fixed at 0.8 in the Reference Case models (Section \@ref(fixed-variance-parameters)), as this stock appears to have had very variable
recruitment throughout the history of the fishery. One sensitivity
analysis was done to test the effect of increasing the assumed value of $\sigma_R$:

> **Sc 6d.** Fix $\sigma_R$ = 1.0.

There was very little discernible difference in the estimated biomass, recruitment and fishing mortality between the Reference Case model and Sc 6d (Figures \@ref(fig:fig-sens6-biomass-5abcd) to \@ref(fig:fig-sens6-f-5abcd) for Area 5ABCD and Figures \@ref(fig:fig-sens13-biomass-3cd) to \@ref(fig:fig-sens13-f-3cd) for Area 3CD).

## SC 7A. ASSUMED FIXED VALUE OF $\sigma_W$

Given the uncertainties in interpreting the mean weight time series (see Section \@ref(reference-case-models)) and its potential to provide direct information for scaling the stock size, two sensitivity analysis was done to illustrate the effect of the fixed value of $\sigma_W$:

> **Sc 7a.** Fix $\sigma_W$ = 0.4.

> **Sc 7b.** Fix $\sigma_W$ = 0.15.

Resulting posterior estimates of biomass, recruitment and fishing mortality compared to the Reference Case models are shown in Figures \@ref(fig:fig-sens7-biomass-5abcd) to \@ref(fig:fig-sens7-f-5abcd) for Area 5ABCD and Figures \@ref(fig:fig-sens14-biomass-3cd) to \@ref(fig:fig-sens14-f-3cd) for Area 3CD.

Increasing $\sigma_W$ in Sc 7a resulted in a large reduction in estimated biomass in both areas (Figures \@ref(fig:fig-sens7-biomass-5abcd) and \@ref(fig:fig-sens14-biomass-3cd)), but very poor fits to the average annual mean weight data (Figures \@ref(fig:fig-sens7-meanweightfit-5abcd)a and \@ref(fig:fig-sens14-meanweightfit-3cd)a). Decreasing $\sigma_w$ in Sc 7b did not have a noticeable effect on estimated biomass (Figures \@ref(fig:fig-sens7-biomass-5abcd) and \@ref(fig:fig-sens14-biomass-3cd)) or fits to the mean weight data (Figures Figures \@ref(fig:fig-sens7-meanweightfit-5abcd)b and \@ref(fig:fig-sens14-meanweightfit-3cd)b). Confidence intervals shown on the plots arise from the observed data and are unaffected by the value of $\sigma_W$.

## SC 7C. HISTORICAL ANNUAL MEAN WEIGHT IN THE COMMERCIAL CATCH
The annnual mean weight data are known to be biased prior to 1996 due to lack of samples of fish released at sea. For both stocks, a sensitivity analysis was done with pre-1996 annual mean weight data removed, to illustrate the influence of these data on the model.

> **Sc 7c.** Remove observed annual mean weight data prior to 1996.

This scenario is essentially a more extreme case of Sc 7a. Removing the pre-1996 mean weight data resulted in much lower estimates of biomass (Figures \@ref(fig:fig-sens7-biomass-5abcd) and \@ref(fig:fig-sens14-biomass-3cd)), especially in the early parts of the time series. Notably for Area 5ABCD, removing these data also resulted in an implausibly large spike (> 15 */y*) in the credible interval for fishing mortality in 1991 (Figure \@ref(fig:fig-sens7-f-5abcd)). For Area 3CD, there were large peaks in estimated fishing mortality throughout the historical period (Figure \@ref(fig:fig-sens14-f-3cd)).

## SC 8A and 8B. ASSUMPTION OF PERFECTLY-KNOWN HISTORICAL CATCH
For each stock, two sensitivity analyses were done, where pre-1996 commercial catch data were inflated by a fixed amount. These were done mainly to bracket the uncertainty in the model due to uncertain historical discarding and, to a lesser extent, foreign catches in the early part of the time series. These scenarios are not intended to represent real estimates of historical discarding. Reconstruction of the historical catch data, in collaboration with the fishing industry, is recommended as an area of future research.

> **Sc 8a.** Inflate pre-1996 catches by 25%.

> **Sc 8b.** Inflate pre-1996 catches by 50%.

As expected, inflating the historical commercial catch data inflated estimates of historical biomass by a similar magnitude (Figures \@ref(fig:fig-sens8-biomass-5abcd) and \@ref(fig:fig-sens15-biomass-3cd)), as the models needed more biomass to explain the observed catch. We note that RPR industry participants felt that unreported discards were not significant for this species due to the nature of fishing operations during the historical period.

# COMBINED COMPOSITE MODEL
The Regional Peer Review meeting held in October 2018 reviewed the Reference Case model and the suite of sensitivity runs described above, coming to the conclusion that no one model adequately represented the uncertainty associated with this stock assessment. Consequently, the meeting agreed to adopt an approach that combined model runs to include a greater range of plausible uncertainties associated with this species in each area.

@forrest2013 used a model-averaging approach to construct decision tables based on combined posterior samples from several different sensitivity cases. This was to address some of the key irresolvable uncertainties associated with the stock assessment. A similar approach was used in the 2011 assessment of Pacific Hake [@stewart2011], where two structurally different stock assessment models were judged by the Pacific Fishery Management Council’s Scientific and Statistical Committee to be equally plausible. A similar “ensemble” approach is used in the annual assessments of Pacific Halibut, where four structurally distinct models are used in construction of the decision table [@stewart2016]. Two recent BC groundfish stock assessments (Shortspine Thornyhead [@starr2017] and Walleye Pollock [@starr2018]), which were based on the same iscam delay-difference model have also adopted this approach.

For Area 5ABCD, the following seven models were selected because they represent stock hypotheses and sources of uncertainty which cannot be ruled out given the current model structure and the availability of data:

1.	Sc 1a Reference model
2.	Sc 2d Set the mean of the prior probability distribution for synoptic surveys $\ln(q)$ = $\ln(1.0)$ (pro-rated by depth-stratum areas of Area 5AB and 5CD)
3.	Sc 2e Increase the standard deviation (SD) for synoptic survey $\ln(q)$ to 0.6.
4.	Sc 3a Set the parameters of the prior probability distribution for $\ln(M)$ to $\mathcal{N}\sim(0.4,0.1)$;
5.	Sc 5a Set knife-edged age at recruitment = 3 years
6.	Sc 6b Reduce the overall observation error term $\sigma_O = 0.15$
7.	Sc 7b Reduce the SD in the likelihood for the fit to average annual mean weight $\sigma_W = 0.15$

Posterior estimates of biomass from the six sensitivity cases are shown together in Figure \@ref(fig:fig-model-average-biomass-comp-5abcd). The combined posterior estimates of biomass are shown in Figure \@ref(fig:fig-model-average-biomass-5abcd). Projected biomass from the model-averaged set is shown in Figure \@ref(fig:fig-model-average-biomass-5abcd-proj).

For Area 3CD, the following seven models were selected because they represent stock hypotheses and sources of uncertainty which cannot be ruled out given the current model structure and the availability of data:

1.	Sc 1a Reference model
2.	Sc 2d Set the mean of the prior probability distribution for synoptic survey $\ln(q)$ = $\ln(1.0)$
3.	Sc 2e Increase the standard deviation (SD) for synoptic survey $\ln(q)$ to 0.6.
4.	Sc 3a Set the parameters of the prior probability distribution for $\ln(M)$ to $\mathcal{N}\sim(0.4,0.1)$;
5.	Sc 5a Set knife-edged age at recruitment = 3 years
6.	Sc 6b Reduce the overall observation error term $\sigma_O = 0.15$
7.	Sc 7b Reduce the SD in the likelihood for the fit to average annual mean weight $\sigma_W = 0.15$

Posterior estimates of biomass from the model-averaged set are shown together in Figure \@ref(fig:fig-model-average-biomass-comp-3cd). The combined posterior estimates of biomass are shown in Figure \@ref(fig:fig-model-average-biomass-3cd). Projected biomass from the model-averaged set is shown in Figure \@ref(fig:fig-model-average-biomass-3cd-proj).

# MODEL-AVERAGED REFERENCE POINTS AND DECISION TABLES
Reference points were calculated for each area using model-averaged blended posteriors as described above. The results are shown in Table \@ref(tab:tab-ref-points-table-avg-5abcd) for Area 5ABCD and Table \@ref(tab:tab-ref-points-table-avg-3cd) for Area 3CD. Biomass and recruitment posterior medians with credible intervals and MPD values are also provided in Tables \@ref(tab:tab-post-biomass-avg-5abcd) and \@ref(tab:tab-post-recr-avg-5abcd) for Area 5ABCD and Tables \@ref(tab:tab-post-biomass-avg-3cd) and \@ref(tab:tab-post-recr-avg-3cd) for Area 3CD.

Performance measures were calculated over a sequence of alternative 2018 projected catch levels and are based on posterior samples for a one-year projection to the end of 2019. Uncertainty enters the projections through parameter uncertainty propagated from the modeled time series, and recruitment anomalies for the projection year, which were drawn randomly from a normal distribution, $\mathcal{N}(0,\sigma_R^2)$. The following performance measures were evaluated:

1. $P(B_{2020} < B_{2019})$
1. $P(F_{2019} > F_{2018})$
1. $P(B_{2020} < LRP)$
1. $P(B_{2020} < USR)$
1. $P(F_{2019} > LRR)$

where

1. $USR$ (Upper Stock Reference) is the historical mean of the biomass estimates from 1956--2004.
1. $LRP$ (Limit Reference Point) is the lowest estimated biomass agreed upon as an undesirable state to be avoided. For Area 5ABCD this is the estimated biomass in 2000. For Area 3CD it is the estimated biomass in 1986.
1. $LRR$ (Limit Removal Rate) is the average fishing mortality rate from 1956--2004.

For more information on reference points, see Section \@ref(reference-points).

The above performance measures are intended to present probabilities of "undesirable" states under alternative 2018 projected catch levels. For example, an "undesirable" biomass-based performance measure occurs when the 2019 projected biomass is below the LRP, i.e., $B_{2019}/LRP < 1$. An "undesirable" fishing mortality-based performance measure occurs when projected 2018 fishing mortality is above the reference point, i.e., $F_{2018}/LRR > 1$.

Probabilities of such states are measured as the proportion of thinned, burned-in posterior samples that meet the criteria above (i.e., proportion of posterior samples < 1 for biomass-based performance measures; and proportion of posterior samples > 1 for fishing mortality-based performance measures). Note that MPD results are not used in development of advice.

Decision tables summarizing the probability of breaching reference points over a range of fixed catches for a one-year projection were constructed for each area using the unweighted combined posterior samples from a set of six sensitivity cases, plus the reference case (the "model-averaged" set). For each performance measure, under each alternative 2018 catch level, Vectors of 1,000 burned-in posterior samples from each of the seven models were combined into a single vector of 7,000 samples. Probabilities of performance measures were then calculated from the combined samples. No attempt was made to assign different weights to the alternative sensitivity cases.

## Area 5ABCD

The "Model-Averaged" decision table probabilities are presented in Table \@ref(tab:tab-decision-avg-5abcd). In summary:

•	$P(B_{2020} < B_{2019})$ ranged from 12% to 89% over the range of 2019 catch levels.

•	$P(F_{2019} > F_{2018})$ ranged from < 1% to > 99%. The 2018 catch was extrapolated to be approximately 200 mt, hence the probability increase between 200 mt and 300 mt.

•	$P(B_{2020} < LRP)$ ranged from <1% to 11%.

•	$P(B_{2020} < USR)$ ranged from 98% to 99%.

•	$P(F_{2019} > LRR)$  ranged from <1% to 95%.

Under a 2019 catch level of 900 mt, close to the 2017 TAC, there is an estimated 1% probability
that the 2020 biomass will be below the LRP and a 99% probability that the 2019 biomass will
be below the USR.

## Area 3CD

The "Model-Averaged" decision table probabilities for Area 3CD are presented in Table \@ref(tab:tab-decision-avg-3cd). In summary:

•	$P(B_{2020} < B_{2019})$ ranged from 76% to 89% over the range of 2019 catch levels.

•	$P(F_{2019} > F_{2018})$ ranged from < 1% to > 99%. The 2018 catch was extrapolated to be approximately 164 mt, hence the probability increase between 100 mt and 200 mt.

•	$P(B_{2020} < LRP)$ ranged from <1% to 1%.

•	$P(B_{2020} < USR)$ ranged from 95% to 97%.

•	$P(F_{2019} > LRR)$  ranged from <1% to 96%.

Under a 2019 catch level of 500 mt, close to the 2017 TAC, there is an estimated 18% probability
that the 2020 biomass will be below the LRP and a 99% probability that the 2020 biomass will be
below the USR.

# SUMMARY AND RESEARCH RECOMMENDATIONS

We presented the alternative, model averaged decision tables for Areas 5ABCD and 3CD in an attempt to more comprehensively incorporate substantial structural uncertainty in the assessments into advice for fishery managers and stakeholders. The absolute scale of the estimated biomass in the two assessed areas, determined by estimated catchability (*q*) in the survey indices, was considered the major axis of uncertainty in this assessment. Several sensitivity analyses were done to evaluate the possible magnitude of this uncertainty. Relatedly, uncertainty in the relative scale of biomass between the historical and modern eras was also identified as an important axis of uncertainty, especially for Area 5ABCD. However, we emphasize that there are major structural uncertainties that we have not been able to address in this assessment. These include, but are not limited to:

1. The effects of the assumption of constant selectivity over each of the two time periods in the trawl fishery. This assumption is unlikely to be correct, given the known variations in mesh size regulations and in fishing behaviour;
1. The effect of the assumption that recruitment to the fishery, surveys and the spawning biomass is knife-edged at age 2 years. Knife-edge recruitment is a structural assumption associated with the delay-difference model. Addressing this uncertainty would involve adopting another modelling approach;
1. The impact of uncertainty in stock structure in understanding patterns in abundance;
1. The impact of uncertainty in the magnitude of historical discarding and foreign catches;
1. The impact of change in onboard observer coverage and representativeness of length samples from the commercial catch.This issue is particularly important when interpreting sorted samples taken from landed catch relative to unsorted samples taken from catch as it comes on board.
1. There was a substantial change in the quality of the catch/effort data available to this assessment beginning in 1996. Before 1996, data were self-reported by fishers with uncertain reliability.  Tow-by-tow data only began in 1991, which meant that the catch location and depth can only be approximately known before 1991. Before 1991, effort and catch were combined on a daily basis within defined spatial "localities", again with unknown reliability. This meant that the analyses performed on the pre-1996 catch/effort data had fewer available variables for standardizing the "abundance" effect compared to the post-1995 data.  As well, all fisher-dependent data (both before and after 1996) are affected by economic and other non-biological considerations for which it is difficult or impossible to standardize. Consequently, CPUE data need to be viewed as potentially biased and possibly misleading. This is an important uncertainty because both area stock assessments are highly dependent on the pre-1996 CPUE series, as indicated by sensitivity runs 1e and 1f, which estimate much larger stock sizes in the absence of the pre-1996 CPUE series. On the other hand, there is little sensitivity to the removal of the post-1995 CPUE data for either stock, likely because of the presence of the co-occurring fishery- independent surveys.

Uncertainty is therefore under-represented in this assessment. We make a number of research recommendations to help reduce uncertainties for BC Pacific Cod stocks:

1. Investigate application of a length-based model to characterize possible changes in selectivity in the trawl fishery, particularly the impact of changing mesh size regulations and recognizing that length samples prior to 1996 under-represent smaller length classes.
1. Investigate possible mixing between stock areas within and outside of British Columbia. Genetic samples have been collected from spawning fish in Hecate Strait and Queen Charlotte Sound but these data have not yet been analyzed. Other sources of information could also be considered, such as comparing trends in Alaskan waters, comparing trends with other BC commercial fisheries, otolith microchemistry or similarities/differences in other biological factors among areas.
1. Explore the application of geostatistical tools to coast-wide geospatial data for developing indices of abundance and better capturing spatio-temporal characteristics of the stock.
1. Work with the fishing industry to improve understanding of the magnitude of historical foreign catch and discards, and drivers of changes in fishing effort during the historical period, which may improve understanding of the relationship between commercial CPUE and abundance, and to better characterize uncertainty due to historical changes in the fishery.
1. Continue to develop feedback simulation models for this species [@forrest2018; @carruthers2018] to evaluate, *inter alia*, costs and benefits of including age-composition data in developing advice for this species, given the current paucity of available ageing data, the expense of preparing fin-sections and the uncertainty associated with age readings. Such analyses could  also be used to evaluate relative performance of the delay-difference model and alternative data-rich and/or data-limited assessment methods.

# ACKNOWLEDGEMENTS

We are grateful to Elise Keppel (Pacific Biological Station) for reconstructing
the historical commercial catch per unit effort data. Her work on the data for this
assessment made it possible to create a fully reproducible analysis and will be
helpful in future assessments for this and other stocks. Matthew Grinnell (Pacific Biological Station) assisted with initial preparation of this document. Norm Olsen, Greg Workman and Maria Surry (Pacific Biological Station) provided support and advice with data preparation for the assessment. We thank Bruce Turris and Brian Mose (Canadian Groundfish Research and Conservation Society) for their advice on fishery operations and assessment needs. Rob Tadey and Gwyn Mason (Groundfish Management Unit) provided advice on historical TAC values. We are very grateful to two reviewers, Ian Stewart (International Pacific Halibut Commission) and Daniel Ricard (Gulf Fisheries Centre), whose detailed reviews greatly improved the advice in this assessment. Rowan Haigh (Institute of Ocean Sciences) also provided helpful editorial comments.

\clearpage

<!--chapter:end:01-main.Rmd-->

\clearpage

# TABLES

```{r tab-catch-5abcd}
catch.table(catch.5,
            catch.5.discards,
            area = "5ABCD",
 cap = paste0("Reported catch (mt) of Pacific Cod in Area 5ABCD ",
              "by Canada and the USA, ",
              min(catch.5$year), "--", max(catch.5$year),
              ". The reported discards for the period ", min(catch.5$year),
              "--1995 are ",
              "unrepresentative of true discarding because the estimates were taken ",
              "from logbooks. Discard estimates since 1996 are based on at-sea ",
              "observations and are considered to be more representative of true discarding."))

```

\clearpage

```{r tab-catch-3cd}
catch.table(catch.3,
            catch.3.discards,
            area = "3CD",
 cap = paste0("Reported catch (mt) of Pacific Cod in Area 3CD ",
              "by Canada and the USA, ",
              min(catch.3$year), "--", max(catch.3$year),
              ". The reported discards for the period ", min(catch.3$year),
              "--1995 are ",
              "unrepresentative of true discarding because the estimates were taken ",
              "from logbooks. Discard estimates since 1996 are based on at-sea ",
              "observations and are considered to be more representative of true discarding."))
```

\clearpage

```{r tab-tac}
tac.table(tac,
 cap = paste0("Summary of TACs by area."))
```

\clearpage

```{r tab-priors-5abcd}
priors.table(base.model.5abcd,
basis.vec = c("Noninformative",
              "Informative-Previous assessment",
              "Informative-Previous assessment",
              "No prior-Fixed parameter",
              "No prior-Fixed parameter",
              "No prior-Fixed parameter",
              "No prior-Fixed parameter",
              "Noninformative-Technical necessity",
              "Noninformative-Technical necessity",
              "Noninformative-Technical necessity",
              "Noninformative-Technical necessity",
              "Noninformative-Technical necessity"),
             cap = paste0("Prior probability distributions, their parameters and initial values used in the ",
                          "Area 5ABCD Reference Case model. ", q.5abcd.desc))
```

\clearpage

```{r tab-priors-3cd}
priors.table(base.model.3cd,
basis.vec = c("Noninformative",
              "Informative-Previous assessment",
              "Informative-Previous assessment",
              "No prior-Fixed parameter",
              "No prior-Fixed parameter",
              "No prior-Fixed parameter",
              "No prior-Fixed parameter",
              "Noninformative-Technical necessity",
              "Noninformative-Technical necessity",
              "Noninformative-Technical necessity",
              "Noninformative-Technical necessity"),
             cap = paste0("Prior probability distributions, their parameters and initial values used in the ",
                          "Area 3CD Reference Case model. ", q.3cd.desc))
```

```{r tab-suggested-ref-points}
suggested.ref.points()
```

\clearpage

## MODEL RESULTS: AREA 5ABCD

```{r tab-param-table-5abcd, results='asis'}
make.parameters.table(base.model.5abcd,
  caption = paste0("Estimated and fixed parameters and prior probablilty distributions used ",
    "in the Reference Case, Area 5ABCD."),
  omit_pars = c("Log initial recruitment ($\\ln(\\overline{R}_{init})$)",
    "Log mean recruitment ($\\ln(\\overline{R})$)"),
  omit_selectivity_pars = TRUE)
```

```{r tab-param-est-table-5abcd, results='asis'}
pars_est_omit <- c("$\\overline{R}_{init}$", "$\\overline{R}$", "$\\vartheta$")
make.parameters.est.table(base.model.5abcd,
  caption = paste0("Posterior (2.5\\textsuperscript{th} percentile, Median, and ",
    "97.5\\textsuperscript{th} percentile) and MPD ",
    "estimates of key parameters from the Reference Case, Area 5ABCD. $R_0$ is in thousands of fish. $B_0$ is in tonnes. ",
    q.5abcd.desc),
  omit_pars = pars_est_omit)
```

```{r tab-ref-points-table-5abcd, results='asis'}
make.ref.points.table(base.model.5abcd,
                      omit_msy = TRUE,
                      add.hist.ref = TRUE,
                      lrp = c(2000, 2000),
                      usr = c(1956, 2004),
                      digits = 2,
                      caption = paste0("Posterior (2.5\\textsuperscript{th} percentile, Median, and ",
                                       "97.5\\textsuperscript{th} percentile) of reference points for Area 5ABCD. ",
                                       "Biomass is in tonnes."))
```

```{r tab-post-biomass-5abcd, results='asis'}
make.value.table(base.model.5abcd,
                 1,
                 digits = 0,
                 caption = paste0("Posterior (2.5\\textsuperscript{th} percentile, Median, and 97.5\\textsuperscript{th} ",
                                  "percentile) and MPD estimates of biomass (t) for the Reference Case, ",
                                  "Area 5ABCD."))
```

\clearpage

```{r tab-post-depl-5abcd}
make.value.table(base.model.5abcd,
                 5,
                 digits = 2,
                 caption = paste0("Posterior (2.5\\textsuperscript{th} percentile, Median, and 97.5\\textsuperscript{th} ",
                                  "percentile) and MPD estimates of biomass relative to $B_0$ ",
                                  "for the Reference Case, Area 5ABCD."))
```

\clearpage

```{r tab-post-recr-5abcd, results='asis'}
make.value.table(base.model.5abcd,
                 2,
                 digits = 0,
                 caption = paste0("Posterior (2.5\\textsuperscript{th} percentile, Median, and 97.5\\textsuperscript{th} ",
                                  "percentile) and MPD estimates of recruitment (thousands) for the Reference Case, ",
                                  "Area 5ABCD."))
```

\clearpage

```{r tab-post-f-5abcd, results='asis'}
make.value.table(base.model.5abcd,
                 3,
                 digits = 2,
                 caption = paste0("Posterior (2.5\\textsuperscript{th} percentile, Median, and 97.5\\textsuperscript{th} ",
                                  "percentile) and MPD estimates of fishing mortality, F, ",
                                  "for the Reference Case, Area 5ABCD."))
```

\clearpage

## MODEL RESULTS: AREA 3CD

```{r tab-param-table-3cd, results='asis'}
make.parameters.table(base.model.3cd,
  caption = paste0("Estimated and fixed parameters and prior probablilty distributions used ",
    "in the Reference Case, Area 3CD."),
  omit_pars = c("Log initial recruitment ($\\ln(\\overline{R}_{init})$)",
    "Log mean recruitment ($\\ln(\\overline{R})$)"),
  omit_selectivity_pars = TRUE)
```

```{r tab-param-est-table-3cd, results='asis'}
make.parameters.est.table(base.model.3cd,
  caption = paste0("Posterior (2.5\\textsuperscript{th} percentile, Median, and ",
    "97.5\\textsuperscript{th} percentile) and MPD ",
    "estimates of key parameters from the reference Case, Area 3CD. $R_0$ is in thousands of fish. $B_0$ is in tonnes.  ",
    q.5abcd.desc),
  omit_pars = pars_est_omit)
```

```{r tab-ref-points-table-3cd, results='asis'}
make.ref.points.table(base.model.3cd,
                      omit_msy = TRUE,
                      add.hist.ref = TRUE,
                      lrp = c(1986, 1986),
                      usr = c(1956, 2004),
                      digits = 2,
                      caption = paste0("Posterior (2.5\\textsuperscript{th} percentile, Median, and ",
                                       "97.5\\textsuperscript{th} percentile) of reference points for Area 3CD. ",
                                       "Biomass is in tonnes."))
```

```{r tab-post-biomass-3cd, results='asis'}
make.value.table(base.model.3cd,
                 1,
                 digits = 0,
                 caption = paste0("Posterior (2.5\\textsuperscript{th} percentile, Median, and 97.5\\textsuperscript{th} ",
                                  "percentile) and MPD estimates of biomass (t) for ",
                                  "the Reference Case, Area 3CD."))
```

\clearpage

```{r tab-post-depl-3cd}
make.value.table(base.model.3cd,
                 5,
                 digits = 2,
                 caption = paste0("Posterior (2.5\\textsuperscript{th} percentile, Median, and 97.5\\textsuperscript{th} ",
                                  "percentile) and MPD estimates of biomass relative to $B_0$ ",
                                  "for the Reference Case, Area 3CD."))
```

\clearpage

```{r tab-post-recr-3cd, results='asis'}
make.value.table(base.model.3cd,
                 2,
                 digits = 0,
                 caption = paste0("Posterior (2.5\\textsuperscript{th} percentile, Median, and 97.5\\textsuperscript{th} ",
                                  "percentile) and MPD estimates of recruitment (thousands) for the Reference Case,",
                                  "Area 3CD."))
```

\clearpage

```{r tab-post-f-3cd, results='asis'}
make.value.table(base.model.3cd,
                 3,
                 digits = 2,
                 caption = paste0("Posterior (2.5\\textsuperscript{th} percentile, Median, and 97.5\\textsuperscript{th} ",
                                  "percentile) and MPD estimates of fishing mortality, F, ",
                                  "for the Reference Case, Area 3CD."))
```

\clearpage

## SELECTED SENSITIVITY RESULTS: AREA 5ABCD

```{r tab-param-table-sens2a-5abcd, results='asis'}
make.parameters.est.table(sens.models.2[[1]],
 caption = paste0("Posterior (2.5\\textsuperscript{th} percentile, Median, and ",
                   "97.5\\textsuperscript{th} percentile) and MPD ",
                   "estimates of key parameters ",
                  "for Sc 2a (mean of the QCS Synoptic Survey was set to the same mean as for the HS Synoptic Survey), Area 5ABCD. $R_0$ is in thousands of fish. $B_0$ is in tonnes. "),
  omit_pars = pars_est_omit)
```

```{r tab-param-table-sens2b-5abcd, results='asis'}
make.parameters.est.table(sens.models.2[[2]],
 caption = paste0("Posterior (2.5\\textsuperscript{th} percentile, Median, and ",
                   "97.5\\textsuperscript{th} percentile) and MPD ",
                   "estimates of key parameters ",
                  "for Sc 2b (uniform priors for synoptic survey catchability), Area 5ABCD. $R_0$ is in thousands of fish. $B_0$ is in tonnes. "),
  omit_pars = pars_est_omit)
```


```{r tab-param-table-sens3a-5abcd, results='asis'}
make.parameters.est.table(sens.models.3[[1]],
 caption = paste0("Posterior (2.5\\textsuperscript{th} percentile, Median, and ",
                   "97.5\\textsuperscript{th} percentile) and MPD ",
                   "estimates of key parameters ",
                  "for Sc 3a (mean ln(M)=ln(0.5), SD=0.2), Area 5ABCD. $R_0$ is in thousands of fish. $B_0$ is in tonnes. "),
  omit_pars = pars_est_omit)
```

\clearpage


```{r tab-param-table-sens3b-5abcd, results='asis'}
make.parameters.est.table(sens.models.3[[2]],
 caption = paste0("Posterior (2.5\\textsuperscript{th} percentile, Median, and ",
                   "97.5\\textsuperscript{th} percentile) and MPD ",
                   "estimates of key parameters ",
                  "for Sc 3b (mean ln(M)=ln(0.4), SD=0.1), Area 5ABCD. $R_0$ is in thousands of fish. $B_0$ is in tonnes. "),
  omit_pars = pars_est_omit)
```

```{r tab-param-table-sens3c-5abcd, results='asis'}
make.parameters.est.table(sens.models.3[[3]],
 caption = paste0("Posterior (2.5\\textsuperscript{th} percentile, Median, and ",
                   "97.5\\textsuperscript{th} percentile) and MPD ",
                   "estimates of key parameters ",
                  "for Sc 3c (mean ln(M)=ln(0.4), SD=0.2), Area 5ABCD. $R_0$ is in thousands of fish. $B_0$ is in tonnes. "),
  omit_pars = pars_est_omit)
```

```{r tab-param-table-sens4a-5abcd, results='asis'}
make.parameters.est.table(sens.models.4[[1]],
 caption = paste0("Posterior (2.5\\textsuperscript{th} percentile, Median, and ",
                   "97.5\\textsuperscript{th} percentile) and MPD ",
                   "estimates of key parameters ",
                  "for Sc 4a (Uniform prior for steepness), Area 5ABCD. $R_0$ is in thousands of fish. $B_0$ is in tonnes. "),
  omit_pars = pars_est_omit)
```

\clearpage

```{r tab-param-table-sens4b-5abcd, results='asis'}
make.parameters.est.table(sens.models.4[[2]],
 caption = paste0("Posterior (2.5\\textsuperscript{th} percentile, Median, and ",
                   "97.5\\textsuperscript{th} percentile) and MPD ",
                   "estimates of key parameters ",
                  "for Sc 4b (beta prior for steepness with mean = 0.85 and SD = 0.15), Area 5ABCD. $R_0$ is in thousands of fish. $B_0$ is in tonnes. "),
  omit_pars = pars_est_omit)
```

```{r tab-param-table-sens6a-5abcd, results='asis'}
make.parameters.est.table(sens.models.6[[1]],
 caption = paste0("Posterior (2.5\\textsuperscript{th} percentile, Median, and ",
                   "97.5\\textsuperscript{th} percentile) and MPD ",
                   "estimates of key parameters ",
                  "for Sc 6a ($\\sigma_{O}$ = 0.1), Area 5ABCD. $R_0$ is in thousands of fish. $B_0$ is in tonnes. "),
  omit_pars = pars_est_omit)
```

```{r tab-param-table-sens6b-5abcd, results='asis'}
make.parameters.est.table(sens.models.6[[2]],
 caption = paste0("Posterior (2.5\\textsuperscript{th} percentile, Median, and ",
                   "97.5\\textsuperscript{th} percentile) and MPD ",
                   "estimates of key parameters ",
                  "for Sc 6b ($\\sigma_{O}$ = 0.15), Area 5ABCD. $R_0$ is in thousands of fish. $B_0$ is in tonnes. "),
  omit_pars = pars_est_omit)
```

\clearpage

```{r tab-param-table-sens6c-5abcd, results='asis'}
make.parameters.est.table(sens.models.6[[3]],
 caption = paste0("Posterior (2.5\\textsuperscript{th} percentile, Median, and ",
                   "97.5\\textsuperscript{th} percentile) and MPD ",
                   "estimates of key parameters ",
                  "for Sc 6c ($\\sigma_{O}$ = 0.25), Area 5ABCD. $R_0$ is in thousands of fish. $B_0$ is in tonnes. "),
  omit_pars = pars_est_omit)
```


\clearpage

## SELECTED SENSITIVITY RESULTS: AREA 3CD

```{r tab-param-table-sens2a-3cd, results='asis'}
make.parameters.est.table(sens.models.9[[1]],
 caption = paste0("Posterior (2.5\\textsuperscript{th} percentile, Median, and ",
                   "97.5\\textsuperscript{th} percentile) and MPD ",
                   "estimates of key parameters ",
                  "for Sc 2a (sd of the WCVI Synoptic Survey was set to the same sd as for the QCS and HS Synoptic Surveys), Area 3CD. $R_0$ is in thousands of fish. $B_0$ is in tonnes. "),
  omit_pars = pars_est_omit)
```

```{r tab-param-table-sens2b-3cd, results='asis'}
make.parameters.est.table(sens.models.9[[2]],
 caption = paste0("Posterior (2.5\\textsuperscript{th} percentile, Median, and ",
                   "97.5\\textsuperscript{th} percentile) and MPD ",
                   "estimates of key parameters ",
                  "for Sc 2b (uniform priors for synoptic survey catchability), Area 3CD. $R_0$ is in thousands of fish. $B_0$ is in tonnes. "),
  omit_pars = pars_est_omit)
```

```{r tab-param-table-sens3a-3cd, results='asis'}
make.parameters.est.table(sens.models.10[[1]],
 caption = paste0("Posterior (2.5\\textsuperscript{th} percentile, Median, and ",
                   "97.5\\textsuperscript{th} percentile) and MPD ",
                   "estimates of key parameters ",
                  "for Sc 3a (mean ln(M)=ln(0.5), SD=0.2), Area 3CD. $R_0$ is in thousands of fish. $B_0$ is in tonnes. "),
  omit_pars = pars_est_omit)
```

\clearpage


```{r tab-param-table-sens3b-3cd, results='asis'}
make.parameters.est.table(sens.models.10[[2]],
 caption = paste0("Posterior (2.5\\textsuperscript{th} percentile, Median, and ",
                   "97.5\\textsuperscript{th} percentile) and MPD ",
                   "estimates of key parameters ",
                  "for Sc 3b (mean ln(M)=ln(0.4), SD=0.1), Area 3CD. $R_0$ is in thousands of fish. $B_0$ is in tonnes. "),
  omit_pars = pars_est_omit)
```

```{r tab-param-table-sens3c-3cd, results='asis'}
make.parameters.est.table(sens.models.10[[3]],
 caption = paste0("Posterior (2.5\\textsuperscript{th} percentile, Median, and ",
                   "97.5\\textsuperscript{th} percentile) and MPD ",
                   "estimates of key parameters ",
                  "for Sc 3c (mean ln(M)=ln(0.4), SD=0.2), Area 3CD. $R_0$ is in thousands of fish. $B_0$ is in tonnes. "),
  omit_pars = pars_est_omit)
```

```{r tab-param-table-sens4a-3cd, results='asis'}
make.parameters.est.table(sens.models.11[[1]],
 caption = paste0("Posterior (2.5\\textsuperscript{th} percentile, Median, and ",
                   "97.5\\textsuperscript{th} percentile) and MPD ",
                   "estimates of key parameters ",
                  "for Sc 4a (Uniform prior for steepness), Area 3CD. $R_0$ is in thousands of fish. $B_0$ is in tonnes. "),
  omit_pars = pars_est_omit)
```

\clearpage


```{r tab-param-table-sens4b-3cd, results='asis'}
make.parameters.est.table(sens.models.11[[2]],
 caption = paste0("Posterior (2.5\\textsuperscript{th} percentile, Median, and ",
                   "97.5\\textsuperscript{th} percentile) and MPD ",
                   "estimates of key parameters ",
                  "for Sc 4b (beta prior for steepness with mean = 0.85 and SD = 0.15), Area 3CD. $R_0$ is in thousands of fish. $B_0$ is in tonnes. "),
  omit_pars = pars_est_omit)
```

```{r tab-param-table-sens6a-3cd, results='asis'}
make.parameters.est.table(sens.models.13[[1]],
 caption = paste0("Posterior (2.5\\textsuperscript{th} percentile, Median, and ",
                   "97.5\\textsuperscript{th} percentile) and MPD ",
                   "estimates of key parameters ",
                  "for Sc 6a ($\\sigma_{O}$ = 0.1), Area 3CD. $R_0$ is in thousands of fish. $B_0$ is in tonnes. "),
  omit_pars = pars_est_omit)
```

```{r tab-param-table-sens6b-3cd, results='asis'}
make.parameters.est.table(sens.models.13[[2]],
 caption = paste0("Posterior (2.5\\textsuperscript{th} percentile, Median, and ",
                   "97.5\\textsuperscript{th} percentile) and MPD ",
                   "estimates of key parameters ",
                   "for Sc 6b ($\\sigma_{O}$ = 0.15), Area 3CD. $R_0$ is in thousands of fish. $B_0$ is in tonnes. "),
  omit_pars = pars_est_omit)
```

\clearpage


```{r tab-param-table-sens6c-3cd, results='asis'}
make.parameters.est.table(sens.models.13[[3]],
 caption = paste0("Posterior (2.5\\textsuperscript{th} percentile, Median, and ",
                   "97.5\\textsuperscript{th} percentile) and MPD ",
                   "estimates of key parameters ",
                  "for Sc 6c ($\\sigma_{O}$ = 0.25), Area 3CD. $R_0$ is in thousands of fish. $B_0$ is in tonnes. "),
  omit_pars = pars_est_omit)
```

\clearpage

## MODEL-AVERAGED REFERENCE POINTS AND DECISION TABLES {#sec:reference-points-and-decision-tables}


```{r tab-ref-points-table-avg-5abcd, results='asis'}
make.ref.points.table(c(base.model.5abcd,
                        sens.models.6.sub),
                      omit_msy = TRUE,
                      add.hist.ref = TRUE,
                      lrp = c(2000, 2000),
                      usr = c(1956, 2004),
                      digits = 2,
                      caption = paste0("Posterior (2.5\\textsuperscript{th} percentile, Median, and ",
                                       "97.5\\textsuperscript{th} percentile) of reference points for ",
                                       "model-averaged Area 5ABCD. ",
                                       "Biomass is in tonnes."))
```

```{r tab-post-biomass-avg-5abcd, results='asis'}
make.value.table(c(base.model.5abcd,
                        sens.models.6.sub),
                 1,
                 digits = 0,
                 caption = paste0("Posterior (2.5\\textsuperscript{th} percentile, Median, and 97.5\\textsuperscript{th} ",
                                  "percentile) and MPD estimates of biomass (t) for model-averaged Area 5ABCD."))
```

```{r tab-post-recr-avg-5abcd, results='asis'}
make.value.table(c(base.model.5abcd,
                        sens.models.6.sub),
                 2,
                 digits = 0,
                 caption = paste0("Posterior (2.5\\textsuperscript{th} percentile, Median, and 97.5\\textsuperscript{th} ",
                                  "percentile) and MPD estimates of recruitment (thousands) model-averaged Area 5ABCD."))
```

```{r tab-ref-points-table-avg-3cd, results='asis'}
make.ref.points.table(c(base.model.3cd,
                        sens.models.13.sub),
                      omit_msy = TRUE,
                      add.hist.ref = TRUE,
                      lrp = c(1986, 1986),
                      usr = c(1956, 2004),
                      digits = 2,
                      caption = paste0("Posterior (2.5\\textsuperscript{th} percentile, Median, and ",
                                       "97.5\\textsuperscript{th} percentile) of reference points for ",
                                       "model-averaged Area 3CD. ",
                                       "Biomass is in tonnes."))
```
\vspace{10pt}
```{r tab-post-biomass-avg-3cd, results='asis'}
make.value.table(c(base.model.3cd,
                        sens.models.13.sub),
                 1,
                 digits = 0,
                 caption = paste0("Posterior (2.5\\textsuperscript{th} percentile, Median, and 97.5\\textsuperscript{th} ",
                                  "percentile) and MPD estimates of biomass (t) for model-averaged Area 3CD."))
```

```{r tab-post-recr-avg-3cd, results='asis'}
make.value.table(c(base.model.3cd,
                        sens.models.13.sub),
                 2,
                 digits = 0,
                 caption = paste0("Posterior (2.5\\textsuperscript{th} percentile, Median, and 97.5\\textsuperscript{th} ",
                                  "percentile) and MPD estimates of recruitment (thousands) model-averaged Area 3CD."))
```

\clearpage

```{r tab-decision-avg-5abcd, results='asis'}
decision.table(avg.model.5abcd,
               caption = paste0("Decision table with model averaging for Area 5ABCD. Models averaged are: ",
                                and.string(c(base.model.5abcd.name, sens.models.name.6.sub)),
                                "."))
```

\clearpage

```{r tab-decision-avg-3cd, results='asis'}
decision.table(avg.model.3cd,
               caption = paste0("Decision table with model averaging for Area 3CD. Models averaged are: ",
                                and.string(c(base.model.3cd.name, sens.models.name.13.sub)),
                                "."))
```

\clearpage

<!--chapter:end:02-tables.Rmd-->

\clearpage

# FIGURES

```{r fig-map, fig.cap="Map of the management areas 5AB (Queen Charlotte Sound), 5CD (Hecate Strait), and 3CD (West Coast Vancouver Island).", out.width="4in"}
knitr::include_graphics(here::here("report/figure/Pcod_3CD5ABCDE_Pic.png"))

```

\clearpage

## CATCH: AREA 5ABCD

```{r fig-catch-5abcd, fig.cap="Catch for Area 5ABCD. Canadian catch includes at-sea releases."}
make.catches.plot(catch.5)
```

```{r fig-discards-5abcd, fig.cap="Estimated at-sea releases of Pacific Cod by bottom trawlers for Area 5ABCD."}
discards.plot(catch.5)
```

```{r fig-catch-5ab, fig.cap="Catch for Area 5AB. Canadian catch includes at-sea releases."}
make.catches.plot(catch.5ab)
```

```{r fig-discards-5ab, fig.cap="Estimated at-sea releases of Pacific Cod by bottom trawlers for Area 5AB."}
discards.plot(catch.5ab)
```

```{r fig-catch-5cd, fig.cap="Catch for Area 5CD. Canadian catch includes at-sea releases."}
make.catches.plot(catch.5cd)
```

```{r fig-discards-5cd, fig.cap="Estimated at-sea releases of Pacific Cod by bottom trawlers for Area 5CD."}
discards.plot(catch.5cd)
```

\clearpage

## CATCH: AREA 3CD

```{r fig-catch-3cd, fig.cap="Catch for Area 3CD. Canadian catch includes at-sea releases."}
make.catches.plot(catch.3)
```

```{r fig-discards-3cd, fig.cap="Estimated at-sea releases of Pacific Cod by bottom trawlers for Area 3CD."}
discards.plot(catch.3)
```

\clearpage

## PRIOR PROBABILITY DISTRIBUTIONS

```{r fig-base-mcmc-priors-5abcd, fig.cap=paste0("Prior probability distributions used in the Area 5ABCD reference model. ", q.5abcd.desc)}
make.priors.posts.plot(base.model.5abcd)
```

```{r fig-base-mcmc-priors-3cd, fig.cap=paste0("Prior probability distributions used in the Area 3CD reference model. ", q.3cd.desc)}
make.priors.posts.plot(base.model.3cd)
```

\clearpage

## MODEL RESULTS: AREA 5ABCD

```{r fig-base-mcmc-trace-5abcd, fig.cap=paste0("Traceplots of posterior samples for the Area 5ABCD reference model. ", q.5abcd.desc)}
make.traces.plot(base.model.5abcd)
```

```{r fig-base-mcmc-autocor-5abcd, fig.cap=paste0("Autocorrelation plots for the Area 5ABCD reference model. ", q.5abcd.desc)}
make.autocor.plot(base.model.5abcd)
```

```{r fig-base-index-fits-5abcd, fig.cap="MPD fits to observed indices of abundance (points) for the Area 5ABCD reference model from: (a) the Hecate Strait Assemblage survey, (b) the Queen Charlotte Sound Synoptic Survey, (c) the Hecate Strait Synoptic Survey, (d) the Commercial CPUE pre-1996, and (e) the Commercial CPUE post-1995. For clarity, only MPD results are shown"}
plot_grid(i.plot(base.model.5abcd, base.model.5abcd.name, 1, every = 5),
          i.plot(base.model.5abcd, base.model.5abcd.name, 2, every = 5),
          i.plot(base.model.5abcd, base.model.5abcd.name, 3, every = 5),
          i.plot(base.model.5abcd, base.model.5abcd.name, 4, every = 10)
            + ylab("Commercial CPUE (kg/hour)"),
          i.plot(base.model.5abcd, base.model.5abcd.name, 5, every = 5)
            + ylab("Commercial CPUE (kg/hour)"),
          nrow = 2,
          ncol = 3,
          labels = c("(a)", "(b)", "(c)", "(d)", "(e)"),
          label_x = 0.2)
```

```{r fig-base-mean-weight-5abcd, fig.cap="MPD fit to the mean weight data for Area 5ABCD reference model. For clarity, only MPD results are shown"}
plot_grid(mw.plot(base.model.5abcd[[1]], cv = 0.2, every = 5, last.yr = 2015),
          mw.compare.plot(base.model.5abcd[[1]]),
          nrow = 1,
          ncol = 2)
```

```{r fig-base-catch-fit-5abcd, fig.cap="MPD fit to the catch data for Area 5ABCD reference model. For clarity, only MPD results are shown"}
catch.fit.plot(base.model.5abcd, every = 5, last.yr = 2015)
```

(ref:priorpostcaption5abcd) Histograms of posterior samples with prior probability distributions (lines) used in the Area 5ABCD reference model. MPD estimate shown as vertical dashed line. Note that both the Queen Charlotte Sound and Hecate Strait Synoptic Surveys used normal prior distributions on $ln(q)$, see Figure \@ref(fig:fig-base-mcmc-priors-5abcd) for full distribution. 

```{r fig-base-mcmc-priors-posts-5abcd, fig.cap=paste("(ref:priorpostcaption5abcd)", q.5abcd.desc)}
make.priors.posts.plot(base.model.5abcd, priors.only = FALSE)
```

```{r fig-base-mcmc-pairs-5abcd, fig.cap="Pairs plots of posterior samples for the Area 5ABCD reference model. $\\bar{R} = R_{Avg}$, $q_1$ = Hecate Strait Assemblage survey, $q_2$ = Queen Charlotte Sound Synoptic Survey, $q_3$ = Hecate Strait Synoptic Survey, $q_4$ = Commercial CPUE pre-1996, and $q_5$ = Commercial CPUE post-1995."}
make.pairs.plot(base.model.5abcd)
```


```{r fig-base-biomass-5abcd, fig.cap="Posterior estimated biomass for the Reference Model, Area 5ABCD.  The green dashed line shows the median Upper Stock Reference (USR) which is the mean biomass estimate for the years 1956--2004. The red dashed line shows the median Limit Reference Point (LRP) which is the lowest estimated biomass agreed to be an undesirable state to avoid, in this case it is the biomass estimate for 2000."}
b.plot(base.model.5abcd,
       base.model.5abcd.name,
       depl = FALSE,
       add.hist.ref = TRUE,
       lrp = c(2000, 2000),
       usr = c(1956, 2004))
```

```{r fig-base-depl-5abcd, fig.cap="Relative biomass for the Reference Model, Area 5ABCD."}
b.plot(base.model.5abcd,
       base.model.5abcd.name,
       depl = TRUE)
```

```{r fig-base-recr-5abcd, fig.cap="Recruitment (a) and recruitment deviations (b) for the Reference Model, Area 5ABCD.  The green dashed line shows the mean of the MCMC posterior medians, the blue dashed line shows the median of the MCMC posterior medians."}
plot_grid(r.plot(base.model.5abcd,
                 base.model.5abcd.name,
                 add.meds = TRUE,
                 x.axis.angle = 90),
          r.devs.plot(base.model.5abcd,
                      base.model.5abcd.name,
                      x.axis.angle = 90),
          nrow = 1,
          ncol = 2,
          labels = c("(a)", "(b)"),
          label_x = c(0.15, 0.1))
```

```{r fig-base-f-5abcd, fig.cap="Fishing mortality for the Reference Model, Area 5ABCD."}
f.plot(base.model.5abcd,
       base.model.5abcd.name)
```

```{r fig-base-retro-biomass-5abcd, fig.cap="Retrospective biomass for the Reference Model, Area 5ABCD."}
b.plot.mpd(c(base.model.5abcd, base.retro.models.5abcd),
           c(base.model.5abcd.name, retro.names),
           depl = FALSE)
```


\clearpage

## MODEL RESULTS: AREA 3CD

```{r fig-base-mcmc-trace-3cd, fig.cap=paste0("Traceplots of posterior samples for the Area 3CD reference model. ", q.3cd.desc)}
make.traces.plot(base.model.3cd)
```

```{r fig-base-mcmc-autocor-3cd, fig.cap=paste0("Autocorrelation plots for the Area 3CD reference model. ", q.3cd.desc)}
make.autocor.plot(base.model.3cd)
```

```{r fig-base-index-fits-3cd, fig.cap="MPD fits to observed indices of abundance (points) for the Area 3CD reference model from: (a) the West Coast Vancouver Island Synoptic Survey, (b) the Commercial CPUE pre-1996, (c) the Commercial CPUE post-1995, and (d) the NMFS Triennial Survey (Canadian portion)."}
plot_grid(i.plot(base.model.3cd, base.model.3cd.name, 1, every = 5),
          i.plot(base.model.3cd, base.model.3cd.name, 2, every = 5)
            + ylab("Commercial CPUE (kg/hour)"),
          i.plot(base.model.3cd, base.model.3cd.name, 3, every = 5)
            + ylab("Commercial CPUE (kg/hour)"),
          i.plot(base.model.3cd, base.model.3cd.name, 4, every = 5),
          nrow = 2,
          ncol = 2,
          labels = c("(a)", "(b)", "(c)", "(d)"),
          label_x = c(0.15, 0.13, 0.13, 0.2))
```

```{r fig-base-mean-weight-3cd, fig.cap="MPD fit to the mean weight data for Area 3CD reference model."}
plot_grid(mw.plot(base.model.3cd[[1]], cv = 0.2, every = 5, last.yr = 2015),
          mw.compare.plot(base.model.3cd[[1]]),
          nrow = 1,
          ncol = 2)
```

```{r fig-base-catch-fit-3cd, fig.cap="MPD fit to the catch data for Area 3CD reference model."}
catch.fit.plot(base.model.3cd, every = 5, last.yr = 2015)
```

(ref:priorpostcaption3cd) Histograms of posterior samples with prior probability distributions (lines) used in the Area 3CD reference model. MPD estimate shown as vertical dashed line. Note that the West Coast Vancouver Island Synoptic Survey used a normal prior distribution on $ln(q)$, see Figure \@ref(fig:fig-base-mcmc-priors-3cd) for full distribution.

```{r fig-base-mcmc-priors-posts-3cd, fig.cap=paste("(ref:priorpostcaption3cd)", q.3cd.desc)}
make.priors.posts.plot(base.model.3cd, priors.only = FALSE)
```

```{r fig-base-mcmc-pairs-3cd, fig.cap=paste0("Pairs plots of posterior samples for the Area 3CD reference model. ", q.3cd.desc)}
make.pairs.plot(base.model.3cd)
```

```{r fig-base-biomass-3cd, fig.cap="Posterior estimated biomass for the Reference Model, Area 3CD. The green dashed line shows the median Upper Stock Reference (USR) which is the mean biomass estimate for the years 1956--2004. The red dashed line shows the median Limit Reference Point (LRP) which is the lowest estimated biomass agreed to be an undesirable state to avoid, in this case it is the biomass estimate for 1986."}
b.plot(base.model.3cd,
       base.model.3cd.name,
       depl = FALSE,
       add.hist.ref = TRUE,
       lrp = c(1986, 1986),
       usr = c(1956, 2004))
```

```{r fig-base-depl-3cd, fig.cap="Relative biomass for the Reference Model, Area 3CD."}
b.plot(base.model.3cd,
       base.model.3cd.name,
       depl = TRUE)
```

```{r fig-base-recr-3cd, fig.cap="Recruitment (a) and recruitment deviations (b) for the Reference Model, Area 3CD.  The green dashed line shows the mean of the MCMC posterior medians, the blue dashed line shows the median of the MCMC posterior medians."}
plot_grid(r.plot(base.model.3cd, base.model.3cd.name, add.meds = TRUE, x.axis.angle = 90),
          r.devs.plot(base.model.3cd, base.model.3cd.name, x.axis.angle = 90),
          nrow = 1,
          ncol = 2,
          labels = c("(a)", "(b)"),
          label_x = c(0.17, 0.1))
```

```{r fig-base-f-3cd, fig.cap="Fishing mortality for the Reference Model, Area 3CD."}
f.plot(base.model.3cd,
       base.model.3cd.name)
```

```{r fig-base-retro-biomass-3cd, fig.cap="Retrospective biomass for the Reference Model, Area 3CD."}
b.plot.mpd(c(base.model.3cd, base.retro.models.3cd),
           c(base.model.3cd.name, retro.names),
           depl = FALSE)
```

\clearpage

## SENSITIVITY ANALYSES: AREA 5ABCD

```{r fig-sens1-biomass-5abcd, fig.cap="Sensitivity of biomass estimates to removing the year/locality interaction term from the commercial CPUE indices and using the annual CVs resulting from the analysis as the annual weighting terms in the objective function for two CV options, and to removal of the CPUE indices, Area 5ABCD."}
b.plot(c(base.model.5abcd, sens.models.1), c(base.model.5abcd.name, sens.models.name.1))
```

```{r fig-sens1-sub2-biomass-5abcd, fig.cap="Sensitivity of biomass estimates to removing the year/locality interaction term from the commercial CPUE indices and using the annual CVs resulting from the analysis as the annual weighting terms in the objective function for two CV options, and to removal of post-1995 CPUE indices, Area 5ABCD."}
b.plot(c(base.model.5abcd, sens.models.1.sub2), c(base.model.5abcd.name, sens.models.name.1.sub2))
```

```{r fig-sens1-recr-5abcd, fig.cap="Sensitivity of recruitment estimates to removing the year/locality interaction term from the commercial CPUE indices and using the annual CVs resulting from the analysis as the annual weighting terms in the objective function for two CV options, Area 5ABCD."}
r.plot(c(base.model.5abcd, sens.models.1.sub),
       c(base.model.5abcd.name, sens.models.name.1.sub))
```

```{r fig-sens1-f-5abcd, fig.cap="Sensitivity of fishing mortality estimates to removing the year/locality interaction term from the commercial CPUE indices and using the annual CVs resulting from the analysis as the annual weighting terms in the objective function for two CV options, and to removal of the CPUE indices, Area 5ABCD."}
f.plot(c(base.model.5abcd, sens.models.1), c(base.model.5abcd.name, sens.models.name.1))
```

```{r fig-sens2-biomass-5abcd, fig.cap="Sensitivity of biomass estimates to the mean of the catchability, $q$, being set equal for the QCS and HSS surveys, and to a uniform prior being used for both surveys, Area 5ABCD."}
b.plot(c(base.model.5abcd, sens.models.2), c(base.model.5abcd.name, sens.models.name.2))
```

```{r fig-sens2-recr-5abcd, fig.cap="Sensitivity of recruitment estimates to the mean of the catchability, $q$, being set equal for the QCS and HSS surveys, and to a uniform prior being used for both surveys, Area 5ABCD."}
r.plot(c(base.model.5abcd, sens.models.2), c(base.model.5abcd.name, sens.models.name.2))
```

```{r fig-sens2-f-5abcd, fig.cap="Sensitivity of fishing mortality estimates to the mean of the catchability, $q$, being set equal for the QCS and HSS surveys, and to a uniform prior being used for both surveys, Area 5ABCD."}
f.plot(c(base.model.5abcd, sens.models.2), c(base.model.5abcd.name, sens.models.name.2))
```

```{r fig-sens3-biomass-5abcd, fig.cap="Sensitivity of biomass estimates to the parameters on the normal prior for natural mortality, M, Area 5ABCD."}
b.plot(c(base.model.5abcd, sens.models.3), c(base.model.5abcd.name, sens.models.name.3))
```

```{r fig-sens3-recr-5abcd, fig.cap="Sensitivity of recruitment estimates to the parameters on the normal prior for natural mortality, M, Area 5ABCD."}
r.plot(c(base.model.5abcd, sens.models.3), c(base.model.5abcd.name, sens.models.name.3))
```

```{r fig-sens3-f-5abcd, fig.cap="Sensitivity of fishing mortality estimates to the parameters on the normal prior for natural mortality, M, Area 5ABCD."}
f.plot(c(base.model.5abcd, sens.models.3), c(base.model.5abcd.name, sens.models.name.3))
```

```{r fig-sens4-biomass-5abcd, fig.cap="Sensitivity of biomass estimates to the prior probability distribution for steepness, including using a bounded uniform prior and a beta prior, Area 5ABCD."}
b.plot(c(base.model.5abcd, sens.models.4), c(base.model.5abcd.name, sens.models.name.4))
```

```{r fig-sens4-recr-5abcd, fig.cap="Sensitivity of recruitment estimates to the prior probability distribution for steepness, including using a bounded uniform prior and a beta prior, Area 5ABCD."}
r.plot(c(base.model.5abcd, sens.models.4), c(base.model.5abcd.name, sens.models.name.4))
```

```{r fig-sens4-f-5abcd, fig.cap="Sensitivity of fishing mortality estimates to the prior probability distribution for steepness, including using a bounded uniform prior and a beta prior, Area 5ABCD."}
f.plot(c(base.model.5abcd, sens.models.4), c(base.model.5abcd.name, sens.models.name.4))
```

```{r fig-sens5-biomass-5abcd, fig.cap="Sensitivity of biomass estimates to setting $k_{age} = 3y$ and update the Ford-Walford parameters accordingly, and to using the growth parameters used in the previous stock assessment, Area 5ABCD."}
b.plot(c(base.model.5abcd, sens.models.5), c(base.model.5abcd.name, sens.models.name.5))
```

```{r fig-sens5-recr-5abcd, fig.cap="Sensitivity of recruitment estimates to setting $k_{age} = 3y$ and update the Ford-Walford parameters accordingly, and to using the growth parameters used in the previous stock assessment, Area 5ABCD."}
r.plot(c(base.model.5abcd, sens.models.5), c(base.model.5abcd.name, sens.models.name.5))
```

```{r fig-sens5-f-5abcd, fig.cap="Sensitivity of fishing mortality estimates to setting $k_{age} = 3y$ and update the Ford-Walford parameters accordingly, and to using the growth parameters used in the previous stock assessment, Area 5ABCD."}
f.plot(c(base.model.5abcd, sens.models.5), c(base.model.5abcd.name, sens.models.name.5))
```

```{r fig-sens5-meanweightfit-5abcd, fig.cap="MPD fits to the average annual mean weights for (a) the Sensitivity to setting $k_{age} = 3y$ and update the Ford-Walford parameters accordingly, and (b) to using the growth parameters used in the previous Area 5CD stock assessment. Area 5ABCD."}
plot_grid(
  mw.plot(sens.models.5[[1]], cv = 0.2, every = 5, last.yr = 2015),
  mw.plot(sens.models.5[[2]], cv = 0.2, every = 5, last.yr = 2015),
          nrow = 1,
          ncol = 2,
          labels = c("(a)", "(b)"),
         label_x = c(0.15, 0.13, 0.13, 0.2))
```

```{r fig-sens6-biomass-5abcd, fig.cap="Sensitivity of biomass estimates to the assumed value of observation and process errors, Area 5ABCD."}
b.plot(c(base.model.5abcd, sens.models.6), c(base.model.5abcd.name, sens.models.name.6))
```

```{r fig-sens6-recr-5abcd, fig.cap="Sensitivity of recruitment estimates to the assumed value of observation and process errors, Area 5ABCD."}
r.plot(c(base.model.5abcd, sens.models.6), c(base.model.5abcd.name, sens.models.name.6))
```

```{r fig-sens6-f-5abcd, fig.cap="Sensitivity of fishing mortality estimates to the assumed value of observation and process errors, Area 5ABCD."}
f.plot(c(base.model.5abcd, sens.models.6), c(base.model.5abcd.name, sens.models.name.6))
```

```{r fig-sens6-index-hsmas-5abcd, fig.cap="MPD index fits showing sensitivity to the assumed value of observation and process errors, HSMAS, Area 5ABCD."}
i.plot(c(base.model.5abcd, sens.models.6), c(base.model.5abcd.name, sens.models.name.6), ind = 1)
```

```{r fig-sens6-index-qcss-5abcd, fig.cap="MPD index fits showing sensitivity to the assumed value of observation and process errors, QCSS, Area 5ABCD."}
i.plot(c(base.model.5abcd, sens.models.6), c(base.model.5abcd.name, sens.models.name.6), ind = 2)
```

```{r fig-sens6-index-hsss-5abcd, fig.cap="MPD index fits showing sensitivity to the assumed value of observation and process errors, HSSS, Area 5ABCD."}
i.plot(c(base.model.5abcd, sens.models.6), c(base.model.5abcd.name, sens.models.name.6), ind = 3)
```

```{r fig-sens6-index-cpue-pre1996-5abcd, fig.cap="MPD index fits showing sensitivity to the assumed value of observation and process errors, commercial CPUE pre-1996, Area 5ABCD."}
i.plot(c(base.model.5abcd, sens.models.6), c(base.model.5abcd.name, sens.models.name.6), ind = 4, every = 5) +
  ylab("Commercial CPUE (kg/hour)")
```

```{r fig-sens6-index-cpue-post1995-5abcd, fig.cap="MPD index fits showing sensitivity to the assumed value of observation and process errors, commercial CPUE post-1995, Area 5ABCD."}
i.plot(c(base.model.5abcd, sens.models.6), c(base.model.5abcd.name, sens.models.name.6), ind = 5, leg.loc = "topleft") + ylab("Commercial CPUE (kg/hour)")
```

<!-- FIXME: remove eval=FALSE -->
```{r fig-sens7-biomass-5abcd, fig.cap="Sensitivity of biomass estimates to the assumed value of $\\sigma_{W}$, Area 5ABCD.", eval=FALSE}
b.plot(c(base.model.5abcd, sens.models.7), c(base.model.5abcd.name, sens.models.name.7))
```

<!-- FIXME: remove eval=FALSE -->
```{r fig-sens7-recr-5abcd, fig.cap="Sensitivity of recruitment estimates to the assumed value of $\\sigma_{W}$, Area 5ABCD.", eval=FALSE}
r.plot(c(base.model.5abcd, sens.models.7), c(base.model.5abcd.name, sens.models.name.7))
```

<!-- FIXME: remove eval=FALSE -->
```{r fig-sens7-f-5abcd, fig.cap="Sensitivity of fishing mortality estimates to the assumed value of $\\sigma_{W}$, Area 5ABCD.", eval=FALSE}
f.plot(c(base.model.5abcd, sens.models.7), c(base.model.5abcd.name, sens.models.name.7))
```

```{r fig-sens7-meanweightfit-5abcd, fig.cap="MPD fits to the average annual mean weights showing sensitivity to the assumed value of $\\sigma_{W}$ for (a) $\\sigma_{W}$ = 0.4 and (b) $\\sigma_{W}$ = 0.15, Area 5ABCD."}
plot_grid(
  mw.plot(sens.models.7[[1]], cv = 0.2, every = 5, last.yr = 2015),
  mw.plot(sens.models.7[[2]], cv = 0.2, every = 5, last.yr = 2015),
          nrow = 1,
          ncol = 2,
          labels = c("(a)", "(b)"),
         label_x = c(0.15, 0.13, 0.13, 0.2))
```

```{r fig-sens8-biomass-5abcd, fig.cap="Sensitivity of biomass estimates to inflating the historical catch data, Area 5ABCD"}
b.plot(c(base.model.5abcd, sens.models.108), c(base.model.5abcd.name, sens.models.name.108))
```

\clearpage

## SENSITIVITY ANALYSES: AREA 3CD

```{r fig-sens8-biomass-3cd, fig.cap="Sensitivity of biomass estimates to removing the year/locality interaction term from the commercial CPUE indices and using the annual CVs resulting from the analysis as the annual weighting terms in the objective function for two CV options, to removal of the CPUE indices, and to the removal of the Triennial survey index, Area 3CD."}
b.plot(c(base.model.3cd, sens.models.8), c(base.model.3cd.name, sens.models.name.8))
```

```{r fig-sens8-sub2-biomass-3cd, fig.cap="Sensitivity of biomass estimates to removing the year/locality interaction term from the commercial CPUE indices and using the annual CVs resulting from the analysis as the annual weighting terms in the objective function for two CV options, and to removal of post-1995 CPUE indices, Area 3CD."}
b.plot(c(base.model.3cd, sens.models.8.sub2), c(base.model.3cd.name, sens.models.name.8.sub2))
```

```{r fig-sens8-recr-3cd, fig.cap="Sensitivity of recruitment estimates to removing the year/locality interaction term from the commercial CPUE indices and using the annual CVs resulting from the analysis as the annual weighting terms in the objective function for two CV options, Area 3CD."}
r.plot(c(base.model.3cd, sens.models.8.sub),
       c(base.model.3cd.name, sens.models.name.8.sub))
```

```{r fig-sens8-f-3cd, fig.cap="Sensitivity of fishing mortality estimates to removing the year/locality interaction term from the commercial CPUE indices and using the annual CVs resulting from the analysis as the annual weighting terms in the objective function for two CV options, Area 3CD."}
f.plot(c(base.model.3cd, sens.models.8), c(base.model.3cd.name, sens.models.name.8))
```

```{r fig-sens9-biomass-3cd, fig.cap="Sensitivity of biomass estimates to the SD for the WCVIS survey being set equal to the SD for the QCS and HSS surveys, and to a uniform prior being used for the WCVIS survey, Area 3CD."}
b.plot(c(base.model.3cd, sens.models.9), c(base.model.3cd.name, sens.models.name.9))
```

```{r fig-sens9-biomass-3cd-sub, fig.cap="Sensitivity of biomass estimates to the SD for the WCVIS survey being set equal to the SD for the QCS and HSS surveys, Area 3CD."}
b.plot(c(base.model.3cd, sens.models.9.sub), c(base.model.3cd.name, sens.models.name.9.sub))
```

```{r fig-sens9-recr-3cd, fig.cap="Sensitivity of recruitment estimates to the SD for the WCVIS survey being set equal to the SD for the QCS and HSS surveys, and to a uniform prior being used for the WCVIS survey, Area 3CD."}
r.plot(c(base.model.3cd, sens.models.9), c(base.model.3cd.name, sens.models.name.9))
```

```{r fig-sens9-f-3cd, fig.cap="Sensitivity of fishing mortality estimates to the SD for the WCVIS survey being set equal to the SD for the QCS and HSS surveys, and to a uniform prior being used for the WCVIS survey, Area 3CD."}
f.plot(c(base.model.3cd, sens.models.9), c(base.model.3cd.name, sens.models.name.9))
```

```{r fig-sens10-biomass-3cd, fig.cap="Sensitivity of biomass estimates to the parameters on the normal prior for natural mortality, M, Area 3CD."}
b.plot(c(base.model.3cd, sens.models.10), c(base.model.3cd.name, sens.models.name.10))
```

```{r fig-sens10-recr-3cd, fig.cap="Sensitivity of recruitment estimates to the parameters on the normal prior for natural mortality, M, Area 3CD."}
r.plot(c(base.model.3cd, sens.models.10), c(base.model.3cd.name, sens.models.name.10))
```

```{r fig-sens10-f-3cd, fig.cap="Sensitivity of fishing mortality estimates to the parameters on the normal prior for natural mortality, M, Area 3CD."}
f.plot(c(base.model.3cd, sens.models.10), c(base.model.3cd.name, sens.models.name.10))
```

```{r fig-sens11-biomass-3cd, fig.cap="Sensitivity of biomass estimates to the prior probability distribution for steepness, including using a bounded uniform prior and a beta prior, Area 3CD."}
b.plot(c(base.model.3cd, sens.models.11), c(base.model.3cd.name, sens.models.name.11))
```

```{r fig-sens11-recr-3cd, fig.cap="Sensitivity of recruitment estimates to the prior probability distribution for steepness, including using a bounded uniform prior and a beta prior, Area 3CD."}
r.plot(c(base.model.3cd, sens.models.11), c(base.model.3cd.name, sens.models.name.11))
```

```{r fig-sens11-f-3cd, fig.cap="Sensitivity of fishing mortality estimates to the prior probability distribution for steepness, including using a bounded uniform prior and a beta prior, Area 3CD."}
f.plot(c(base.model.3cd, sens.models.11), c(base.model.3cd.name, sens.models.name.11))
```

```{r fig-sens12-biomass-3cd, fig.cap="Sensitivity of biomass estimates to setting $k_{age} = 3y$ and update the Ford-Walford parameters accordingly, and to using the growth parameters used in the previous stock assessment, Area 3CD."}
b.plot(c(base.model.3cd, sens.models.12), c(base.model.3cd.name, sens.models.name.12))
```

```{r fig-sens12-recr-3cd, fig.cap="Sensitivity of recruitment estimates to setting $k_{age} = 3y$ and update the Ford-Walford parameters accordingly, and to using the growth parameters used in the previous stock assessment, Area 3CD."}
r.plot(c(base.model.3cd, sens.models.12), c(base.model.3cd.name, sens.models.name.12))
```

```{r fig-sens12-f-3cd, fig.cap="Sensitivity of fishing mortality estimates to setting $k_{age} = 3y$ and update the Ford-Walford parameters accordingly, and to using the growth parameters used in the previous stock assessment, Area 3CD."}
f.plot(c(base.model.3cd, sens.models.12), c(base.model.3cd.name, sens.models.name.12))
```

```{r fig-sens12-meanweightfit-3cd, fig.cap="MPD fits to the average annual mean weights for (a) the Sensitivity to setting $k_{age} = 3y$ and update the Ford-Walford parameters accordingly, and (b) to using the growth parameters used in the previous Area 5CD stock assessment. Area 3CD."}
plot_grid(
  mw.plot(sens.models.12[[1]], cv = 0.2, every = 5, last.yr = 2015),
  mw.plot(sens.models.12[[2]], cv = 0.2, every = 5, last.yr = 2015),
          nrow = 1,
          ncol = 2,
          labels = c("(a)", "(b)"),
         label_x = c(0.15, 0.13, 0.13, 0.2))
```


```{r fig-sens13-biomass-3cd, fig.cap="Sensitivity of biomass estimates to the assumed value of observation and process errors, Area 3CD."}
b.plot(c(base.model.3cd, sens.models.13), c(base.model.3cd.name, sens.models.name.13))
```

```{r fig-sens13-recr-3cd, fig.cap="Sensitivity of recruitment estimates to the assumed value of observation and process errors, Area 3CD."}
r.plot(c(base.model.3cd, sens.models.13), c(base.model.3cd.name, sens.models.name.13))
```

```{r fig-sens13-f-3cd, fig.cap="Sensitivity of fishing mortality estimates to the assumed value of observation and process errors, Area 3CD."}
f.plot(c(base.model.3cd, sens.models.13), c(base.model.3cd.name, sens.models.name.13))
```

```{r fig-sens13-index-wcviss-3cd, fig.cap="MPD index fits showing sensitivity to the assumed value of observation and process errors, WCVISS, Area 3CD."}
i.plot(c(base.model.3cd, sens.models.13), c(base.model.3cd.name, sens.models.name.13), ind = 1, leg.loc = "topleft")
```

```{r fig-sens13-index-triennial-3cd, fig.cap="MPD index fits showing sensitivity to the assumed value of observation and process errors, NMFS Triennial survey, Area 3CD."}
i.plot(c(base.model.3cd, sens.models.13), c(base.model.3cd.name, sens.models.name.13), ind = 4)
```

```{r fig-sens13-index-cpue-pre1996-3cd, fig.cap="MPD index fits showing sensitivity to the assumed value of observation and process errows, commercial CPUE pre-1996, Area 3CD."}
i.plot(c(base.model.3cd, sens.models.13), c(base.model.3cd.name, sens.models.name.13), ind = 2, every = 5) +
  ylab("Commercial CPUE (kg/hour)")
```

```{r fig-sens13-index-cpue-post1995-3cd, fig.cap="MPD index fits showing sensitivity to the assumed value of observation and process errors, commercial CPUE post-1995, Area 3CD."}
i.plot(c(base.model.3cd, sens.models.13), c(base.model.3cd.name, sens.models.name.13), ind = 3, leg.loc = "topleft") + ylab("Commercial CPUE (kg/hour)")
```

```{r fig-sens14-biomass-3cd, fig.cap="Sensitivity of biomass estimates to the assumed value of $\\sigma_{W}$, Area 3CD."}
b.plot(c(base.model.3cd, sens.models.14), c(base.model.3cd.name, sens.models.name.14))
```

```{r fig-sens14-recr-3cd, fig.cap="Sensitivity of recruitment estimates to the assumed value of $\\sigma_{W}$, Area 3CD."}
r.plot(c(base.model.3cd, sens.models.14), c(base.model.3cd.name, sens.models.name.14))
```

```{r fig-sens14-f-3cd, fig.cap="Sensitivity of fishing mortality estimates to the assumed value of $\\sigma_{W}$, Area 3CD."}
f.plot(c(base.model.3cd, sens.models.14), c(base.model.3cd.name, sens.models.name.14))
```

```{r fig-sens14-meanweightfit-3cd, fig.cap="MPD fits to the average annual mean weights showing sensitivity to the assumed value of $\\sigma_{W}$ for (a) $\\sigma_{W}$ = 0.4 and (b) $\\sigma_{W}$ = 0.15, Area 3CD."}
plot_grid(
  mw.plot(sens.models.14[[1]], cv = 0.2, every = 5, last.yr = 2015),
  mw.plot(sens.models.14[[2]], cv = 0.2, every = 5, last.yr = 2015),
          nrow = 1,
          ncol = 2,
          labels = c("(a)", "(b)"),
         label_x = c(0.15, 0.13, 0.13, 0.2))
```

```{r fig-sens15-biomass-3cd, fig.cap="Sensitivity of biomass estimates to inflating the historical catch data, Area 3CD"}
b.plot(c(base.model.3cd, sens.models.15), c(base.model.3cd.name, sens.models.name.15))
```


\clearpage

## MODEL-AVERAGED BIOMASS AND PROJECTIONS {#sec:projections}

<!-- ```{r fig-base-biomass-5abcd-proj, fig.cap="Biomass for the Reference Model, Area 5ABCD with projections.  The upper horizontal green dashed line shows the Upper Stock Reference (USR) which is the mean biomass estimate for the years 1956--2004. The lower horizontal red dashed line shows the Limit Reference Point (LRP) which is the lowest estimated biomass agreed to be an undesirable state to avoid, in this case it is the biomass estimate for 2000. The coloured regions to the right of the vertical line represent projections based on various TACs. The line represents the posterior median and the shaded region represents the 95\\% credible interval."} -->
<!-- b.plot(base.model.5abcd, -->
<!--        base.model.5abcd.name, -->
<!--        depl = FALSE, -->
<!--        add.hist.ref = TRUE, -->
<!--        lrp = c(2000, 2000), -->
<!--        usr = c(1956, 2004), -->
<!--        proj_columns = c("B2019", "B2020"), -->
<!--        tac_vector = c(0, 900, 2000, 3000), -->
<!--        year_range = c(2010, 2019), -->
<!--        ylim = c(0, 50000), -->
<!--        x.every = 2) -->
<!-- ``` -->

```{r fig-model-average-biomass-comp-5abcd, fig.cap="Posterior estimates of biomass for the model-averaged set for Area 5ABCD. The green dashed line shows the median Upper Stock Reference (USR) which is the mean biomass estimate for the years 1956--2004. The red dashed line shows the median Limit Reference Point (LRP) which is the lowest estimated biomass agreed to be an undesirable state to avoid, in this case it is the biomass estimate for 2000."}
b.plot(desc.models.5abcd,
       desc.models.5abcd.name,
       depl = FALSE,
       add.hist.ref = TRUE,
       lrp = c(2000, 2000),
       usr = c(1956, 2004))
```


```{r fig-model-average-biomass-5abcd, fig.cap="Combined posterior biomass for the averaged models, Area 5ABCD. The green dashed line shows the median Upper Stock Reference (USR) which is the mean biomass estimate for the years 1956--2004. The red dashed line shows the median Limit Reference Point (LRP) which is the lowest estimated biomass agreed to be an undesirable state to avoid, in this case it is the biomass estimate for 2000."}
b.plot(avg.model.5abcd,
       base.model.5abcd.name,
       depl = FALSE,
       add.hist.ref = TRUE,
       lrp = c(2000, 2000),
       usr = c(1956, 2004))
```


```{r fig-model-average-biomass-5abcd-proj, fig.cap="Combined posterior estimates of biomass for the model-averaged set for Area 5ABCD with projections (to the end of 2019).  The upper horizontal green dashed line shows the median Upper Stock Reference (USR) which is the mean biomass estimate for the years 1956--2004. The lower horizontal red dashed line shows the median Limit Reference Point (LRP) which is the lowest estimated biomass agreed to be an undesirable state to avoid, in this case it is the biomass estimate for 2000. The coloured regions to the right of the vertical line represent projections based on various TACs. The line represents the posterior median and the shaded region represents the 95\\% credible interval. For clarity, years before 2010 are removed."}
b.plot(avg.model.5abcd,
       base.model.5abcd.name,
       depl = FALSE,
       add.hist.ref = TRUE,
       lrp = c(2000, 2000),
       usr = c(1956, 2004),
       proj_columns = c("B2019", "B2020"),
       tac_vector = c(0, 900, 2000, 3000),
       year_range = c(2010, 2019),
       ylim = c(0, 50000),
       x.every = 2)
```


```{r fig-model-average-biomass-comp-3cd, fig.cap="Posterior estimates of biomass for the model-averaged set for Area 3CD. The green dashed line shows the median Upper Stock Reference (USR) which is the mean biomass estimate for the years 1956--2004. The red dashed line shows the median Limit Reference Point (LRP) which is the lowest estimated biomass agreed to be an undesirable state to avoid, in this case it is the biomass estimate for 1986."}
b.plot(desc.models.3cd,
       desc.models.3cd.name,
       depl = FALSE,
       add.hist.ref = TRUE,
       lrp = c(1986, 1986),
       usr = c(1956, 2004))
```


```{r fig-model-average-biomass-3cd, fig.cap="Combined posterior biomass for the model-averaged set for Area 3CD.  The green dashed line shows the median Upper Stock Reference (USR) which is the mean biomass estimate for the years 1956--2004. The red dashed line shows the median Limit Reference Point (LRP) which is the lowest estimated biomass agreed to be an undesirable state to avoid, in this case it is the biomass estimate for 1986."}
b.plot(avg.model.3cd,
       base.model.3cd.name,
       depl = FALSE,
       add.hist.ref = TRUE,
       lrp = c(1986, 1986),
       usr = c(1956, 2004))
```


```{r fig-model-average-biomass-3cd-proj, fig.cap="Combined posterior estimates of biomass for the model-averaged set for Area 3CD with projections (to the end of 2019).  The upper horizontal green dashed line shows the median Upper Stock Reference (USR) which is the mean biomass estimate for the years 1956--2004. The lower horizontal red dashed line shows the median Limit Reference Point (LRP) which is the lowest estimated biomass agreed to be an undesirable state to avoid, in this case it is the biomass estimate for 2000. The coloured regions to the right of the vertical line represent projections based on various TACs. The line represents the posterior median and the shaded region represents the 95\\% credible interval.For clarity, years before 2010 are removed."}
b.plot(avg.model.3cd,
       base.model.3cd.name,
       depl = FALSE,
       add.hist.ref = TRUE,
       lrp = c(1986, 1986),
       usr = c(1956, 2004),
       proj_columns = c("B2019", "B2020"),
       tac_vector = c(0, 500, 1000, 1500),
       year_range = c(2010, 2019),
       ylim = c(0, 50000),
       x.every = 2)
```

<!-- ```{r fig-base-biomass-3cd-proj, fig.cap="Biomass for the Reference Model, Area 3CD with projections.  The upper horizontal green dashed line shows the Upper Stock Reference (USR) which is the mean biomass estimate for the years 1956--2004. The lower horizontal red dashed line shows the Limit Reference Point (LRP) which is the lowest biomass from which the stock has recovered, in this case it is the biomass estimate for 1986. The coloured regions to the right of the vertical line represent projections based on various TACs. The line represents the posterior median and the shaded region represents the 95\\% credible interval."} -->
<!-- b.plot(base.model.3cd, -->
<!--        base.model.3cd.name, -->
<!--        depl = FALSE, -->
<!--        add.hist.ref = TRUE, -->
<!--        lrp = c(1986, 1986), -->
<!--        usr = c(1956, 2004), -->
<!--        proj_columns = c("B2019", "B2020"), -->
<!--        tac_vector = c(0, 500, 1000, 1500), -->
<!--        year_range = c(2010, 2019), -->
<!--        ylim = c(0, 45000), -->
<!--        x.every = 2) -->
<!-- ``` -->


<!-- ```{r fig-model-average-recr-5abcd, fig.cap="Combined posterior recruitment for the model-averaged set for Area 5ABCD.The green dashed line shows the mean of the combined posterior medians, the blue dashed line shows the median of the combined posterior medians. "} -->
<!-- r.plot(avg.model.5abcd, -->
<!--        base.model.5abcd.name, -->
<!--        add.meds = TRUE) -->
<!-- ``` -->

<!-- ```{r fig-model-average-recr-3cd, fig.cap="Combined posterior recruitment for the model-averaged set for Area 3CD. The green dashed line shows the mean of the combined posterior medians, the blue dashed line shows the median of the combined posterior medians."} -->
<!-- r.plot(avg.model.3cd, -->
<!--        base.model.3cd.name, -->
<!--        add.meds = TRUE) -->
<!-- ``` -->

<!--chapter:end:03-figures.Rmd-->

\clearpage

`r if(knitr:::is_latex_output()) '\\Appendices'`

`r if(!knitr:::is_latex_output()) '# (APPENDIX) Appendix {-}'`

# FISHERY-INDEPENDENT INDICES OF ABUNDANCE

## CANADIAN SURVEYS

### HECATE STRAIT ASSEMBLAGE SURVEY

A series of multi-species groundfish bottom trawl surveys was conducted in
Hecate Strait in May-June of 1984, 1987, 1989, 1991, 1993, 1995, 1996, 1998,
2000, 2002, and 2003 @westrheim1984, @fargo1984, @fargo1988, @wilson1991,
@hand1994, @workman1996, @workman1997, @choromanski2002)  (Figure
\@ref(fig:survey-maps-hs-msa). The results up to 2000 were reported in the 2001
assessment [@sinclair2001] and results from 2002 and 2003 were presented in the
2005 assessment [@sinclair2005].

The original design of this survey assigned fishing locations by 10 fm depth
intervals within a 10 nm grid of Hecate Strait. The survey was post-stratified
for the purpose of calculating an abundance index for Pacific Cod
[@sinclair2000]. The post stratification used 10 fm depth intervals for the
entire survey area, thereby treating each depth interval as a single stratum.

The Hecate Strait Assemblage survey was designed as a systematic
fixed-station survey. Despite attempts to apply post-sampling stratification,
this approach had high survey variance [@sinclair2007]. In 2004 the Hecate
Strait Assemblage survey was discontinued in favour of the Hecate Strait
Synoptic survey (described below).

### HECATE STRAIT SYNOPTIC SURVEY

The Hecate Strait synoptic groundfish bottom trawl survey is part of
a coordinated set of long-term surveys that together cover the continental
shelf and upper slope of most of the BC coast (Figure
\@ref(fig:survey-maps-syn-hs). The Hecate Strait synoptic survey has been
conducted during May-June, in odd years since 2005. All the synoptic surveys
follow a random depth stratified design. The survey area is divided into 2 km
by 2 km blocks and each block is assigned to one of four depth strata based on
the average bottom depth in the block. The four depth strata for the Hecate
Strait survey are 10--70m, 70--130m, 130--220m, and 220--500m. Each year blocks
are randomly selected within each depth strata. For this survey and the other
synoptic surveys discussed below, the relative allocation of blocks amongst
depth strata was determined by modeling the expected catches of groundfish and
determining the target number of tows per stratum that would provide sufficiently
precise catch rate data for as many species as possible.

### QUEEN CHARLOTTE SOUND SYNOPTIC SURVEY

The Queen Charlotte Sound (QCS) synoptic groundfish bottom trawl survey has
been conducted in July--August in 2003, 2004, and in odd years since 2005
(Figure \@ref(fig:survey-maps-syn-qcs). The four depth strata for the QCS
survey are 50--125m, 125--200m, 200--330m, and 330--500 m. Each year blocks are
randomly selected within each depth strata. In addition, for the purposes of
allocating blocks, the QCS survey is divided into northern and southern spatial
strata.

### WEST COAST VANCOUVER ISLAND SYNOPTIC SURVEY

The West Coast Vancouver Island synoptic bottom trawl survey was first
conducted in 2004 and is conducted in alternating (even-numbered) years on
a chartered commercial trawler (Figure \@ref(fig:survey-maps-syn-wcvi)). The
survey area is off the west coast of Vancouver Island from approximately 49
$^\circ$  12$^\prime$ to 50 $^\circ$ 36$^\prime$ North latitude and
approximately 124 $^\circ$  48$^\prime$ to 128 $^\circ$  30$^\prime$ West
longitude. The southern boundary is contiguous with the Canada/U.S. boundary.
The survey has a single aerial stratum in Pacific Fishery Management Area
regions 3C and 3D separated into four depth strata: 50--125m; 125--200m;
200--330m; and 330--500m. Approximately 150 to 180 4 km^2^ blocks are selected
randomly among the four depth strata when conducting each survey.

```{r survey-maps-hs-msa, fig.asp=1, fig.cap="Individual survey tows for the Hecate Strait multi-species groundfish bottom trawl survey. Light gray crosses indicate survey sets that did not catch Pacific Cod. Circles have their area and color proportional to the density of Pacific Cod for that survey set. Eastings and Northings are for UTM zone 9."}
plot_multiyear_survey_sets(dat$survey_sets, "HS MSA")
```

```{r survey-maps-syn-hs, fig.asp=1, fig.cap="Individual survey tows for the Hecate Strait (SYN HS) synoptic groundfish bottom trawl survey. Light gray crosses indicate survey sets that did not catch Pacific Cod. Circles have their area and color proportional to the density of Pacific Cod for that survey set. Eastings and Northings are for UTM zone 9."}
plot_multiyear_survey_sets(dat$survey_sets, "SYN HS")
```

```{r survey-maps-syn-qcs, fig.asp=1, fig.cap="Individual survey tows for the Queen Charlotte Sound (SYN QCS) synoptic groundfish bottom trawl survey. Light gray crosses indicate survey sets that did not catch Pacific Cod. Circles have their area and color proportional to the density of Pacific Cod for that survey set. Eastings and Northings are for UTM zone 9."}
plot_multiyear_survey_sets(dat$survey_sets, "SYN QCS")
```

```{r survey-maps-syn-wcvi, fig.asp=1, fig.cap="Individual survey tows for the West Coast Vancouver Island (SYN WCVI) synoptic groundfish bottom trawl survey survey. Light gray crosses indicate survey sets that did not catch Pacific Cod. Circles have their area and color proportional to the density of Pacific Cod for that survey set. Eastings and Northings are for UTM zone 9."}
plot_multiyear_survey_sets(dat$survey_sets, "SYN WCVI")
```

\clearpage

### SWEPT AREA ANALYSIS

For all Canadian surveys, a swept area estimate of biomass in any year $y$ was
obtained by summing the product of the CPUE and the area surveyed across the
surveyed strata $i$:

\begin{equation}
  B_y = \sum_{i=1}^kC_{y_i}A_i=\sum_{i=1}^kB_{y_i}
  (\#eq:sweptareabiomass)
\end{equation}

where
$C_{y_i}$ = mean CPUE density (kg/km^2^) for Pacific Cod in stratum $i$,
$A_i$ = area of stratum $i$ (km^2^),
$B_{y_i}$ = biomass of Pacific Cod in stratum $i$ for year $y$, and
$k$ = number of strata.

CPUE ($C_{y_i}$) for Pacific Cod in stratum $i$ for year $y$ was calculated as
a density in kg/km^2^ by

\begin{equation}
  C_{y_i}=\frac{1}{n_{y_i}} \sum\limits_{j=1}^{n_{y_i}} \frac{W_{y_i,j}}{D_{y_i,j}w_{y_i,j}}
  (\#eq:sweptareacpue)
\end{equation}

where
$W_{y_i,j}$ = catch weight (kg) for Pacific Cod in stratum $i$ for year $y$ and tow $j$,
$D_{y_i,j}$ = distance travelled (km) by tow $j$ in stratum $i$ for year $y$,
$w_{y_i,j}$ = net opening (km) by tow $j$ in stratum $i$ for year $y$, and
$n_{y_i}$ = number of tows in stratum $i$.

The variance of the survey biomass estimate $V_y$ for Pacific Cod in year $y$
was calculated in kg^2^ as follows:

\begin{equation}
  V_y=\sum_{i=1}^k\frac{\sigma_{y_i}^2A_i^2}{n_{y_i}}=\sum_{i=1}^kV_{y_i}
  (\#eq:sweptareavariance)
\end{equation}

where $\sigma_{y_i}^2$ is the variance of the CPUE in $kg^2/km^4$ for year $y$ in
stratum $i$, $V_{y_i}$ is the variance of Pacific Cod in stratum $i$ for year $y$,
and where $\sigma_{y_i}^2$ was obtained from bootstrapped samples (see below).

The CV for Pacific Cod for each year $y$ was calculated as follows:

\begin{equation}
  (CV)_y=\frac{{V_y}^{1/2}}{B_y}
  (\#eq:sweptareacv)
\end{equation}

where $(CV)_y$ is the CV for year $y$.

One thousand bootstrap replicates with replacement were constructed from the
survey data to estimate bias corrected 95% confidence intervals for each survey
year [@efron1982]. The resulting values are shown in Table
\@ref(tab:surv-canadian-table) and Figure \@ref(fig:surv-canadian).

```{r surv-canadian-table, results='asis'}
dplyr::filter(dat$survey_index, survey_abbrev %in%
  c("SYN QCS", "SYN WCVI", "SYN HS", "SYN WCHG", "OTHER HS MSA")) %>%
  dplyr::select(survey_abbrev, year, biomass, re, lowerci, upperci, num_sets, num_pos_sets) %>%
  dplyr::mutate(lowerci = round(lowerci/1000, 1), upperci = round(upperci/1000, 1),
    biomass = round(biomass/1000, 1), re = round(re, 2)) %>%
  dplyr::rename(`Survey abbrev.` = survey_abbrev, Year = year, Biomass = biomass,
    CV = re, `Lower CI` = lowerci, `Upper CI` = upperci, Sets = num_sets, `Positive sets` = num_pos_sets) %>%
  dplyr::arrange(`Survey abbrev.`, Year) %>%
  knitr::kable(caption = "Pacific Cod survey data for Canadian trawl surveys. Relative biomass and associated lower and upper confidence intervals (CI) are shown in metric tons (without accounting for survey catchability). Positive sets refers to the number of trawl sets that caught Pacific Cod.", booktabs = TRUE, linesep = "", 
    format = "pandoc")
```

```{r surv-canadian, fig.cap="Pacific Cod survey data for Canadian trawl surveys. Shown is relative biomass and associated lower and upper confidence intervals. Positive sets refers to the number of trawl sets that caught Pacific Cod."}
gfplot::tidy_survey_index(dat$survey_index,
  survey = c("SYN QCS", "SYN WCVI", "SYN HS", "SYN WCHG", "OTHER HS MSA")) %>%
  plot_survey_index()
```

\clearpage

## NMFS TRIENNIAL SURVEY (IN CANADIAN WATERS)

A relative abundance index was developed for Area 3CD from data from the
National Marine Fisheries Service (NMFS) Triennial survey operated off the
lower half of Vancouver Island.

###  Data selection

Tow-by-tow data from the US National Marine Fisheries Service (NMFS) triennial
survey covering the Vancouver INPFC (International North Pacific Fisheries
Commission) region were provided by Mark Wilkins (NMFS, pers. comm.) for the
seven years that the survey worked in BC waters (Table
\@ref(tab:surv-tri-strata-table), Figure \@ref(fig:tri-tows))). These tows were
assigned to strata by the NMFS, although the size and definition of these
strata have changed over the life of the survey. The NMFS survey database also
identified in which country the tow was located. This information was plotted
and checked against the accepted Canada/USA marine boundary: all tows appeared
to be appropriately located with respect to country, based on the tow start
position Figure \@ref(fig:tri-tows))). The NMFS designations were accepted for
tows located near the marine border.

All usable tows had an associated median net width (with 1--99% quantiles) of
13.4 (11.3-15.7) m and median distance travelled of 2.8 (1.4--3.5) km, allowing
for the calculation of the area swept by each tow. Biomass indices and the
associated analytical CVs for Pacific Cod were calculated for the total
Vancouver INPFC region and for each of the Canadian- and US-Vancouver
sub-regions, using appropriate area estimates for each stratum and year. Strata
that were not surveyed consistently in all seven years of the survey were
dropped from the analysis, allowing the remaining data to provide a comparable
set of data for each year.

```{r surv-tri-strata-table, warning=FALSE}
tri_str <- readr::read_csv(here::here("data/triennial-strata.csv"))
names(tri_str) <- gsub("_1", "", names(tri_str))
tri_to_shade <- which(tri_str$Shade == 1)
tri_str$Shade <- NULL
for (i in seq_along(names(tri_str))) {
  tri_str[,i][is.na(tri_str[,i])] <- ""
}
tri_str$`Stratum No.`[tri_to_shade] <- paste0(tri_str$`Stratum No.`[tri_to_shade], "*")
knitr::kable(tri_str,
    caption = "Number of tows by stratum and by survey year for the NFMS triennial survey. Strata denoted with an asterisk have been excluded from the analysis due to incomplete coverage across the seven survey years or were from locations outside the Vancouver INPFC area.",
    booktabs = TRUE, linesep = "", format = "pandoc") %>%
  kableExtra::kable_styling(font_size = 8)
```

The stratum definitions used in the 1980 and 1983 surveys were different than
those used in subsequent surveys, particularly in Canadian waters. Consequently, these indices were not used in the 3CD stock assessment. The tow density was much higher in US waters
although the overall number of tows was approximately the same for each
country. This occurs because the size of the total area fished in the INPFC
Vancouver area was about twice as large in Canadian waters than in US waters.
Note that the northern extension of the survey has varied from year to year
(Figure \@ref(fig:tri-tows)), but this difference has been compensated for by
using a constant survey area for all years and assuming that catch rates in the
unsampled areas were the same as in the sampled area.


<!--
Table: Stratum definitions by year used in the NMFS triennial survey
to separate the survey results by country and by INPFC area. Stratum
definitions in grey are those strata which have been excluded from the
final analysis due to incomplete coverage across the seven survey years
or because the locations were outside the Vancouver INPFC area.
Van. = Vancouver, Col. = Columbia.

------------ ---------- -------------- ---------------  ---------------  --------- ------- -----------
Year         Stratum    Area           Start            End              Country   INPFC   Depth
             No.        (km^2^)                                                    area    range
------------ ---------- -------------- ---------------  ---------------  --------- ------- -----------
1980         10         3537           47 $^\circ$ 30   US-Can Border    US        Van.    55-183 m
1980         11         6572           US-Can Border    49 $^\circ$ 15   CDN       Van.    55-183 m
1980         30         443            47 $^\circ$ 30   US-Can Border    US        Van.    184-219 m
1980         31         325            US-Can Border    49 $^\circ$ 15   CDN       Van.    184-219 m
1980         50         758            47 $^\circ$ 30   US-Can Border    US        Van.    220-366 m
1980         51         503            US-Can Border    49 $^\circ$ 15   CDN       Van.    220-366 m
1983         10         1307           47 $^\circ$ 30   47 $^\circ$ 55   US        Van.    55-183 m
1983         11         2230           47 $^\circ$ 55   US-Can Border    US        Van.    55-183 m
1983         12         6572           US-Can Border    49 $^\circ$ 15   CDN       Van.    55-183 m
1983         30         66             47 $^\circ$ 30   47 $^\circ$ 55   US        Van.    184-219 m
1983         31         377            47 $^\circ$ 55   US-Can Border    US        Van.    184-219 m
1983         32         325            US-Can Border    49 $^\circ$ 15   CDN       Van.    184-219 m
1983         50         127            47 $^\circ$ 30   47 $^\circ$ 55   US        Van.    220-366 m
1983         51         631            47 $^\circ$ 55   US-Can Border    US        Van.    220-366 m
1983         52         503            US-Can Border    49 $^\circ$ 15   CDN       Van.    220-366 m
1989 $+$     17N        1033           47 $^\circ$ 30   47 $^\circ$ 50   US        Van.    55-183 m
1989 $+$     17S        3378           46 $^\circ$ 30   47 $^\circ$ 30   US        Col.    55-183 m
1989 $+$     18N        159            47 $^\circ$ 50   48 $^\circ$ 20   CDN       Van.    55-183 m
1989 $+$     18S        2123           47 $^\circ$ 50   48 $^\circ$ 20   US        Van.    55-183 m
1989 $+$     19N        8224           48 $^\circ$ 20   49 $^\circ$ 40   CDN       Van.    55-183 m
1989 $+$     19S        363            48 $^\circ$ 20   49 $^\circ$ 40   US        Van.    55-183 m
1989 $+$     27N        125            47 $^\circ$ 30   47 $^\circ$ 50   US        Van.    184-366 m
1989 $+$     27S        412            46 $^\circ$ 30   47 $^\circ$ 30   US        Col.    184-366 m
1989 $+$     28N        88             47 $^\circ$ 50   48 $^\circ$ 20   CDN       Van.    184-366 m
1989 $+$     28S        787            47 $^\circ$ 50   48 $^\circ$ 20   US        Van.    184-366 m
1989 $+$     29N        942            48 $^\circ$ 20   49 $^\circ$ 40   CDN       Van.    184-366 m
1989 $+$     29S        270            48 $^\circ$ 20   49 $^\circ$ 40   US        Van.    184-366 m
1995 $+$     37N        102            47 $^\circ$ 30   47 $^\circ$ 50   US        Van.    367-500 m
1995 $+$     37S        218            46 $^\circ$ 30   47 $^\circ$ 30   US        Col.    367-500 m
1995 $+$     38N        66             47 $^\circ$ 50   48 $^\circ$ 20   CDN       Van.    367-500 m
1995 $+$     38S        175            47 $^\circ$ 50   48 $^\circ$ 20   US        Van.    367-500 m
------------ ---------- -------------- ---------------  ---------------  --------- ------- -----------
-->

<!--(DFO 2015) -->

A reviewer from NOAA for Yellowtail Rockfish in 2014 noted that a number of the
early Triennial survey tows had been deemed "water hauls" (catching no fish or
invertebrates) and should be discarded. The tows used to estimate relative
Pacific Cod biomass exclude these water haul tows.

<!--

Table: Number of usable tows performed and area surveyed in the
INPFC Vancouver region separated by the international border between
Canada and the United States. Strata 18N, 28N, 37, 38 and 39 (Table A.3)
were dropped from this analysis as they were not consistently conducted
over the survey period. All strata occurring in the Columbia INPFC
region (17S and 27S; Table A.3) were also dropped.

---------- --------- --------- --------- --------- --------- ----------
  Survey    Tows CDN  Tows US  Tows total Area CDN  Area US   Area total
  year      waters    waters              waters    waters
---------- --------- --------- --------- --------- --------- ----------
  1980      48        23        71        7,399     4,738     12,137
  1983      39        65        104       7,399     4,738     12,137
  1989      63        54        117       9,166     4,699     13,865
  1992      59        47        106       9,166     4,699     13,865
  1995      62        35        97        9,166     4,699     13,865
  1998      54        42        96        9,166     4,699     13,865
  2001      36        37        73        9,166     4,699     13,865
  Total     361       303       664       --        --        --
---------- --------- --------- --------- --------- --------- ----------

-->

###  TRIENNIAL SURVEY METHODS

When calculating the variance for this survey, it was assumed that the variance
and CPUE within any stratum were equal, even for strata that were split by the
Canada/USA border. The total biomass within a stratum that straddled the border
was split between the two countries by the ratio of the relative area within
each country:

\begin{equation}
B_{y_{i,c}}=B_{y_{i}}\frac{A_{y_{i,c}}}{A_{y_{i}}}
(\#eq:tri1)
\end{equation}

where $A_{y_{i,c}} =$ area (km^2^) within country *c* in year *y* and stratum
*i* and *B* represents biomass.

The variance *V* for that part of stratum *i* within country *c* was
calculated as being in proportion to the ratio of the square of the area
within each country *c* relative to the total area of stratum *i*. This
assumption resulted in the CVs within each country stratum being the
same as the CV in the entire stratum:

\begin{equation}
V_{y_{i,c}}=V_{y_{i}}\frac{A_{y_{i,c}}^{2}}{A_{y_{i}}^{2}}.
(\#eq:tri2)
\end{equation}

The partial variance for country *c* was used in instead of the total
variance in the stratum when calculating the variance for the total biomass in
Canadian or American waters.

The biomass estimates and the associated standard errors were adjusted to
a constant area covered using the ratios of area surveyed. This was required to
adjust the Canadian biomass estimates for 1980 and 1983 to account for the
smaller area surveyed in those years compared to the succeeding surveys. he 1980
and 1983 biomass estimates from Canadian waters were consequently multiplied by
the ratio 1.24 (= 9166 km^2^ / 7399 km^2^) to make them equivalent to the
coverage of the surveys from 1989 onwards.

Biomass estimates were bootstrapped for 1000 random draws with
replacement to obtain bias-corrected [@efron1982] 95% confidence
intervals for each year and for three area categories (total Vancouver
region, Canadian-Vancouver only and US-Vancouver only) based on the
distribution of biomass estimates and using the above equations.

Catch and effort data for strata \(i\) in year \(y\) yield catch per unit
effort (CPUE) values\({U_{yi}}\). Given a set of data \(\left\{
{{C_{yij}},{E_{yij}}} \right\}\) for tows\(j = 1, \ldots ,{n_{yi}}\),

\begin{equation}
{U_{yi}} = \frac{1}{{{n_{yi}}}}\sum\limits_{j = 1}^{{n_{yi}}} {\frac{{{C_{yij}}}}{{{E_{yij}}}}},
\end{equation}

where \({C_{yij}}\) = catch (kg) in tow \(j\), stratum \(i\), year \(y\);
\({E_{yij}}\) = effort (h) in tow \(j\), stratum \(i\), year \(y\); and
\({n_{yi}}\)  = number of tows in stratum \(i\), year \(y\).

CPUE values \({U_{yi}}\) convert to CPUE densities \({\delta _{yi}}\) (kg/km2) using:

\begin{equation}
{\delta _{yi}} = \frac{1}{{vw}}{U_{yi}},
\end{equation}

where \(v\) = average vessel speed (km/h) and
\(w\) = average net width (km).

Alternatively, if vessel information exists for every tow, CPUE density can be
expressed

\begin{equation}
{\delta _{yi}} = \frac{1}{{{n_{yi}}}}\,\,\sum\limits_{j = 1}^{{n_{yi}}} {\,\frac{{{C_{yij}}}}{{{D_{yij}}{w_{yij}}}}},
\end{equation}

where \({C_{yij}}\) = catch weight (kg) for tow \(j\), stratum \(i\), year \(y\);
\({D_{yij}}\) = distance travelled (km) for tow\(j\), stratum\(i\), year\(y\);
\({w_{yij}}\) = net opening (km) for tow\(j\), stratum\(i\), year\(y\); and
\({n_{yi}}\)  = number of tows in stratum\(i\), year\(y\).

The annual biomass estimate is then the sum of the product of CPUE densities and bottom areas across \(m\) strata:

\begin{equation}
{B_y} = \sum\limits_{i = 1}^m {{\delta _{yi}}{A_i}}  = \sum\limits_{i = 1}^m {{B_{yi}}},
\end{equation}

where \({\delta _{yi}}\)  = mean CPUE density (kg/km2) for stratum \(i\), year \(y\);
  \({A_i}\) = area (km2) of stratum\(i\);
  \({B_{yi}}\)  = biomass (kg) for stratum\(i\), year\(y\); and
  \(m\) = number of strata.

The variance of the survey biomass estimate \({V_y}\) (kg^2^) follows:

\begin{equation}
{V_y} = \sum\limits_{i = 1}^m {\frac{{\sigma _{yi}^2A_i^2}}{{{n_{yi}}}}\,}  = \,\,\,\sum\limits_{i = 1}^m {{V_{yi}}},
\end{equation}

where \(\sigma _{yi}^2\)  = variance of CPUE density (kg^2^/km^4^) for
stratum \(i\), year \(y\) and
\({V_{yi}}\)  = variance of the biomass estimate (kg^2^) for
stratum\(i\), year \(y\).

The coefficient of variation (CV) of the annual biomass estimate for year \(y\) is

\begin{equation}
C{V_y} = \frac{{\sqrt {\,{V_y}} }}{{{B_y}}}.
\end{equation}

### TRIENNIAL SURVEY RESULTS

Relative biomass estimates and confidence intervals are shown in Table
\@ref(tab:surv-trien-table) and Figure \@ref(fig:tri-fig9). Pacific Cod are
characterized with most catches taken along the shelf edge and in the deep gully
entering Juan de Fuca Strait (e.g., Figure \@ref(fig:tri-tows)). A more
consistent biomass estimate was obtained by excluding deep strata that were not
covered in the earlier surveys. Figure \@ref(fig:tri-fig8) shows that this
species was mainly found between 57 and 256 m (1 and 99% quantiles of bottom
depth), with infrequent observations at depths up to 326 m which means that the
deeper strata (>367 m) are not needed to monitor Pacific Cod. Note that the deep
strata which were not used in the biomass estimation are included in Figure
\@ref(fig:tri-fig8).


```{r surv-trien-table, results='asis'}
surv_tri <- readr::read_csv(here::here("data/NMFSTriennial_Canada-Vancouver.csv"))
knitr::kable(surv_tri, caption = "Biomass estimates and confidence intervals for
  the Triennial NMFS survey relevant to Canadian waters.", booktabs = TRUE, linesep = "",
  longtable = TRUE, format = "pandoc") %>%
  kableExtra::column_spec(1:7, width = "1.8cm")
```


```{r tri-tows, fig.cap="(Left panels): plot of tow locations in the Vancouver INPFC region for the NMFS triennial survey in US and Canadian waters. Tow locations are colour-coded by depth range: black=55--183m; red=184-366m; grey=367-500m. Dashed line shows approximate position of the Canada/USA marine boundary. Horizontal lines are the stratum boundaries: 47 30, 47 50, 48 20 and 49 50. Tows south of the 47 30 line were not included in the analysis. (Right panels): circle sizes in the density plot are scaled across all years (1980, 1983, 1989, 1992, 1995, 1998, and 2001), with the largest circle = 7,229 kg/km2 in 1989. The red solid lines indicate the boundaries between PMFC areas 3B, 3C and 3D.", cache=FALSE}
knitr::include_graphics(here::here("report", "paul-figs", "paul-surv-small.png"),
  dpi = NA)
```

```{r tri-fig8, fig.cap="Distribution of Pacific Cod catch weights for each survey year summarised into 25 m depth intervals for all tows (Table B.2) in Canadian and US waters of the Vancouver INPFC area. Catches are plotted at the mid-point of the interval.  Note that the deep strata introduced in 1995 (see Table B.2) have been included in this plot but were not used in the biomass estimation."}
insert_paul_figure <- function(n) {
  knitr::include_graphics(here::here("report", "paul-figs", paste0("paul", n, ".png")), dpi = NA)
}
insert_paul_figure(8)
```

```{r tri-fig9, fig.cap="Biomass estimates for three series of Pacific Cod in the INPFC Vancouver region (total region, Canadian waters only, US waters only) with 95\\% error bars estimated from 1000 bootstraps."}
insert_paul_figure(9)
```

<!--
```{r tri-fig10, fig.cap="Proportion of tows with Pacific Cod by year for the Vancouver INPFC region (Canadian and US waters)."}
insert_paul_figure(10)
```
-->

\clearpage

<!--chapter:end:04-survey-indices-app.Rmd-->

<!-- TODO: mention p and phi estimates, sigmas -->
<!-- TODO: show shapes that Tweedie can take -->
\clearpage

# COMMERCIAL CPUE STANDARDIZATION

We sought to generate an index of Pacific Cod abundance from commercial trawl
catch per unit effort data that was standardized for depth, fishing locality
(defined spatial regions; Figures \@ref(fig:cpue-locality-map-5),
\@ref(fig:cpue-locality-map-3)), month, vessel, and latitude, when available.
Before fitting a standardization model, we had to filter and manipulate the
available catch and effort data to generate a dataset appropriate for model
fitting. In the following sections we describe those decisions for the
'historical' (1956--1995) and 'modern' data (1996--2017). We then describe our
index standardization model, explore the contribution of the various
standardization components, and identify the effect of including or ignoring
space-time interactions.

## DEFINING THE 1956--1995 FLEET

Commercial groundfish bottom trawl data prior to 1991 was recorded via dockside
interviews and aggregated to fishing locality and
trip combinations. Data from 1991 to 1995 was recorded via logbooks at the
fishing-event (trawl) level. We therefore aggregated the 1991--1995 data to the
locality-trip level (hereafter referred to as 'trips' in this appendix) to
match the resolution of the earlier data. When aggregating this 1991--1995
data, we removed any trawl events that were longer than five hours, since these
are likely to be data entry errors. During these time periods, the variables
depth, date, and locality are available as model covariates.

## DEFINING THE 1996--2017 FLEET

Commercial groundfish bottom trawl data from 1996 to present have been recorded
to the fishing-event level in the presence of on-board observers or video
monitoring. We have treated this modern dataset separately from the historical
dataset to (1) take advantage of the higher data resolution, (2) include
information on latitude and vessel ID in our standardization model, and (3) to
avoid assuming a constant catchability and relationship between CPUE and the
standardization covariates across major regulatory changes.

Since we have data on individual vessels for this modern fleet, and in keeping
with previous analyses for Pacific groundfish stocks, we defined a 'fleet' for
the modern dataset that includes only vessels that qualify by passing some
criteria of regularly catching Pacific Cod. We follow the approach used in
a number of recent BC groundfish stock assessments by requiring vessels to have
caught the species in at least 100 tows across all years of interest, and to
have passed a threshold of five trips (trips that recorded some of the species)
for at least five years --- all from 1996 to 2017.

## DEFINING THE STANDARDIZATION MODEL PREDICTORS

For depth and latitude, we binned the values into a sequence of bands to allow
for nonlinear relationships between these predictors and CPUE [e.g.
@maunder2004a]. For depth, we binned trawl depth into bands 25m wide.
For latitude, we used bands that were 0.1 degrees wide. To ensure sufficient
data to estimate a coefficient for each factor level, we limited the range of
depth bins to those that fell within the 0.1% to 99.9% cumulative probability
of positive observations and then removed any factor levels (across all
predictors) that contained fewer than 0.1% of the positive observations.

Predictors that are treated as factors in a statistical model need a reference
or base level --- a level from which the other coefficients for that variable
estimate a difference. The base level then becomes the predictor value that is
used in the prediction for the standardized index. We chose the most frequent
factor level as the base level --- a common choice for these types of models
[@maunder2004a]. For example, we set the base month as the most common month
observed in the dataset filtered for only tows where the species was caught.
This choice of base level only affects the intercept or relative magnitude of
our index because of the form of our model (discussed below). This relative
magnitude should not affect the outcomes of the stock assessment model because
we estimated separate catchabilities for each commercial CPUE index.

## A TWEEDIE GLMM INDEX STANDARDIZATION MODEL

Fisheries CPUE data contains both zeros and positive continuous values. A
variety of approaches have been used in the fishery literature to model such
data. One approach has been to fit a delta-GLM (generalized linear model) --- a
model that fits the zero vs. non-zero values with a logistic regression (a
binomial GLM and a logit link) and the positive values with a linear regression
fit to log-transformed data or a Gamma GLM with a log link [e.g. @maunder2004a;
@thorson2013]. The probability of a non-zero CPUE from the first component can
then be multiplied by the expected CPUE from the second component to derive an
unconditional estimate of CPUE. However, this approach suffers from a number of
issues:

1. The delta-GLM approach adds complexity by needing to fit and report on two
   models.
1. In the typical delta-GLM approach, the two models are fit with separate
   links and so the coefficients cannot be combined.
1. The delta-GLM approach assumes independence among the two components [e.g.
   @thorson2017].
1. The delta-GLM approach has been shown to be insufficiently robust to variable
   sampling intensity (e.g. in time or space) [@lecomte2013].
1. Perhaps most importantly for our purpose, a delta-GLM in which the two
   models use different links renders a final index in which the index trend is
   dependent on the specific reference levels that the predictors are set to
   [e.g. @maunder2004a].

The Tweedie distribution [@jorgensen1987] solves the above problems [e.g.
@candy2004; @shono2008; @foster2013; @lecomte2013; @thorson2017] but has not
seen widespread use presumably mostly because of the computational expense of
calculating the Tweedie probability density function. Recently, the Tweedie
density function has been introduced to the software TMB [@kristensen2016] and
can be fit relatively quickly to large datasets and for models with many fixed
and random effect parameters either with custom written TMB models or via the
glmmTMB R package [@brooks2017].

In addition to a mean parameter, the Tweedie distribution has two other
parameters: a power parameter $p$ and a dispersion parameter $\phi$. If
$1 > p > 2$ then the Tweedie distribution represents a compound distribution
between the Poisson ($p = 1$) and the Gamma distribution ($p = 2$)
(Figure \@ref(fig:cpue-tweedie-ex)). In fact,
the Tweedie is alternatively referred to as the compound-Poisson-Gamma
distribution in this bounded case. We note, however, that the
compound-Poisson-Gamma distribution is often used to refer to
a re-parameterization in which the Poisson and Gamma components are fit so
that they are not assumed to have the same predictive coefficients as they are
in the Tweedie distribution [@foster2013; @lecomte2013].

We fit the Tweedie GLMM (generalized linear mixed effect model) as

\begin{align}
   (\#eq:cpue-tweedie)
  y_i &\sim \mathrm{Tweedie}(\mu_i, p, \phi), \quad 1 < p < 2,\\
  \mu_i &= \exp \left(
  \bm{X}_i \bm{\beta}
  + \alpha^\mathrm{locality}_{j[i]}
  + \alpha^\mathrm{locality-year}_{k[i]}
  + \alpha^\mathrm{vessel}_{l[i]}
  \right),\\
\alpha^\mathrm{locality}_j &\sim
  \mathrm{Normal}(0, \sigma^2_{\alpha \; \mathrm{locality}}),\\
 (\#eq:cpue-locality-year)
\alpha^\mathrm{locality-year}_k &\sim
  \mathrm{Normal}(0, \sigma^2_{\alpha \; \mathrm{locality-year}}),\\
 (\#eq:cpue-vessel)
\alpha^\mathrm{vessel}_l &\sim
  \mathrm{Normal}(0, \sigma^2_{\alpha \; \mathrm{vessel}}),
\end{align}

where $i$ represents a single trip (historical data) or tow (modern data),
$y_i$ represents the catch (kg) per unit effort (hours trawled), $\bm{X_i}$
represents a vector of fixed-effect predictors (historical: depth bins, months;
modern: depth bins, months, latitude bins), $\bm{\beta}$ represents a vector of
coefficients, and $\mu_i$ represents the expected CPUE in a trip or tow. The
random effect intercepts ($\alpha$ symbols) are allowed to vary from the
overall intercept by locality $j$ (\(\alpha^\mathrm{locality}_j\)),
locality-year $k$ (\(\alpha^\mathrm{locality-year}_k\)), and vessel $l$
(\(\alpha^\mathrm{vessel}_l\)) (for the modern dataset only) and are
constrained by normal distributions with respective standard deviations denoted
by $\sigma$ parameters.

We can then calculate the standardized estimate of CPUE for year $t$, $\mu_t$,
as

\begin{equation}
  \mu_t = \exp \left(\bm{X}_t \bm{\beta} \right)
\end{equation}

where $\bm{X_t}$ represents a vector of predictors set to the reference ($r$)
levels with the year set to the year of interest. Because each of the $\alpha$
random intercepts is set to zero, the index is predicted for an average
locality, locality-year, and vessel (for modern data).
We estimated the fixed effects with maximum marginal likelihood while
integrating over the random effects with the statistical software TMB via the
R package glmmTMB. We used standard errors ($\mathrm{SE}$) as calculated by TMB
on $\log (\mu_t)$ via the delta method. We then calculated the 95\% Wald
confidence intervals as $\exp (\mu_t \pm 1.96 \mathrm{SE}_t)$.

For comparison, we calculated an unstandardized timeseries using a similar
procedure but without any of the covariates other than a factor predictor for
each year. This is similar to calculating the geometric mean of CPUE each year
but with an assumed Tweedie observation model instead of a lognormal
observation model that does not allow for zeros.

## COMMERCIAL CPUE STANDARDIZATION RESULTS

The raw Pacific Cod catch and total fleet effort show variable trends through
time in both the historical and modern datasets (Figure
\@ref(fig:cpue-catch-effort-ts)). The majority of positive fishing events for
Pacific Cod occurred at depths ranging from approximately 50m to 200m (Figure
\@ref(fig:cpue-depth-hists)). We can see an increase in the total number of
trip-locality combinations since 1991, some changes to the localities typically
fished, and an introduction of trips with deeper average fishing depths towards
the end of the 1956--1995 period (Figure \@ref(fig:cpue-bubble-plots-hist-3CD),
\@ref(fig:cpue-bubble-plots-hist-5ABCD)). For the modern datasets, we see some
changes to the distribution of fished depths, latitudes, and months through
time, along with changes to the vessels participating in the 'fleet' and the
localities fished (Figure \@ref(fig:cpue-bubble-plots-modern-3CD),
\@ref(fig:cpue-bubble-plots-modern-5ABCD)).

The Tweedie GLMM index standardization models fit the data relatively well
(Figure \@ref(fig:cpue-quantile-residuals)). The Tweedie $p$ parameters tended
to be around $1.6$, indicating a distribution roughly midway between the Poisson
and Gamma distributions and the $\phi$ parameters indicated relatively dispersed
observations (Table \@ref(tab:cpue-pars)). There was considerably more
variability across the locality and locality-year random effects than the vessel
random effects (Table \@ref(tab:cpue-pars)).

For the 1956--1995 time period, depth and locality had a moderate effect on the
standardized CPUE index for 3CD, but the standardized and unstandardized series
differed little in 5ABCD (Figure \@ref(fig:cpue-index-ts-hist)). Accounting for
either depth or locality reduced the 3CD CPUE in the 1970s and increased the
CPUE from the mid 1980s to 1995. Accounting for depth also reduced a spike in
CPUE in 3CD in the mid 1960s. For the 1996--2017 time period, depth and
latitude had the largest effect on the standardized index, and again had
a larger effect in 3CD than 5ABCD (Figure \@ref(fig:cpue-index-ts-modern)).
Accounting for depth or latitude somewhat decreased the CPUE index for two to
three years before and after 2010 and this effect carried through to the
standardization model with all covariates.

Accounting for locality-year interactions had little effect on the shape of the
standardized indices with the exception of a slight change in shape 2014--2015
for the modern dataset in 5ABCD (Figure \@ref(fig:cpue-int-test-plot)). The
main effect of including the locality-year random effect interactions was to
increase the width of the confidence intervals in all areas and time periods.
We can examine the contribution of all the fixed and random effect parameters
via coefficient plots (historical: Figures \@ref(fig:cpue-coef-plot1),
\@ref(fig:cpue-coef-plot2), \@ref(fig:cpue-coef-plot3); modern: Figures
\@ref(fig:cpue-coef-plot1-modern), \@ref(fig:cpue-coef-plot2-modern),
\@ref(fig:cpue-coef-plot3-modern)).

## SPACE-TIME (LOCALITY-YEAR) INTERACTIONS

To test the effect of including or not including space-time interactions when
such interactions are or are not present, we performed a simulation test. While
a full simulation test with many stochastic iterations and a range of parameter
values is beyond the scope of this appendix, we think this simple simulation
remains instructive. We parameterized our simulation to approximately match the
parameters estimated from observed data. Our simulation included 20 years of
data; 12 localities with their effects ($\alpha^\mathrm{locality}_{j}$) in log
space drawn from a normal distribution with a standard deviation of 0.3 and
mean 0; optional year-locality random effects
($\alpha^\mathrm{locality-year}_{j}$)  drawn from a distribution with
a standard deviation of 0.5 and mean of 0; 10 observations per year per
locality; a true known CPUE index that, in log space, followed an
auto-regressive process with correlation of 0.3 at lag 1, standard deviation of
1 and a mean of 2; and Tweedie parameters of $p = 1.6$ and $\phi = 5$. We
generated versions of this dataset with and without the locality-year
interactions and then fit standardization models to those datasets that either
allowed for or ignored locality-year interactions.

For the real data, including locality-year random effects allowed for each
locality to have a trend that deviates slightly from the overall trend (Figure
\@ref(fig:cpue-re-int-ts)). Omitting these locality-by-year random effects, on
the other hand, assumed that the CPUE trend is identical in shape and only
deviated in magnitude across localities (Figure \@ref(fig:cpue-re-no-int-ts)).
Ignoring these space-time interactions can result in confidence intervals that
are substantially too narrow if the trends are not in fact identical across
space (Figure \@ref(fig:cpue-sim-test-tweedie-glmm-plot)). Furthermore,
allowing for the interactions has no qualitative effect on model performance or
coverage if the interactions are not present (Figure
\@ref(fig:cpue-sim-test-tweedie-glmm-plot)).

Fitting a proper geostatistical spatiotemporal standardization model would be
an alternative to these locality-year random effects [e.g. @thorson2015b;
@monnahan2018]. For this assessment, we chose to model spatial variation
through the DFO localities to maintain consistency with previous assessments in
this region. However, in the future we may explore a spatiotemporal
standardization model.

\clearpage

```{r cpue-funcs}
source(here::here('R/cpue-functions.R'))
```

```{r cpue-params}
params <- list()
params$species_proper <- "Pacific Cod"
params$april1_year <- TRUE
params$area <- c("5[ABCD]+", "3[CD]+")
params$area_name <- c("5ABCD", "3CD")
params$skip_single_variable_models <- FALSE
```

```{r cpue-run-historic, message=FALSE, warning=FALSE, results='hide'}
params$era <- "historic"
source(here::here("R/cpue.R"))
dfleet_hist <- dfleet
gg_cpue_hist <- gg_cpue
cpue_pred_hist <- predictions
arith_cpue_hist <- arith_cpue
m_historic <- readRDS(here::here("data/generated/cpue-models-pcod-historic.rds"))
```

```{r cpue-run-modern, message=FALSE, warning=FALSE, results='hide'}
params$era <- "modern"
source(here::here("R/cpue.R"))
dfleet_modern <- dfleet
gg_cpue_modern <- gg_cpue
cpue_pred_modern <- predictions
arith_cpue_modern <- arith_cpue
m_modern <- readRDS(here::here("data/generated/cpue-models-pcod-modern.rds"))
```

```{r cpue-save}
readr::write_csv(cpue_pred_modern, here::here("data/generated/cpue-predictions-modern.csv"))
readr::write_csv(cpue_pred_hist, here::here("data/generated/cpue-predictions-historical.csv"))
```

```{r cpue-locality-map-5, fig.cap="DFO localities used in the 5ABCD modern CPUE standardization model.", fig.asp=0.9}
gfplot:::plot_dfo_localities(unique(dfleet_modern[[1]]$locality_code))
```

```{r cpue-locality-map-3, fig.cap="DFO localities used in the 3CD modern CPUE standardization model.", fig.asp=0.9}
gfplot:::plot_dfo_localities(unique(dfleet_modern[[2]]$locality_code))
```

```{r cpue-tweedie-ex, fig.asp=0.7, fig.cap="Example density functions for the Tweedie distribution. The symbol $\\phi$ (written as phi in this figure) represents the dispersion parameter, $p$ represents the power parameter, and $\\mu$ represents the mean. Note that the spike in density that is seen towards the left of the panels is at a value of 0 on the x axis."}
plot_tweedie_ex <- function(df, max = 15) {
  xx <- seq(0, max, length.out = 1000)
  out <- plyr::mdply(df, function(mu, power, phi) {
    data.frame(x = xx,
      y = tweedie::dtweedie(y = xx, mu = mu, power = power, phi = phi))
  }) %>%
    mutate(phi = paste("phi =", phi)) %>%
    mutate(power = paste("p =", power)) %>%
    mutate(mu = paste("μ =", mu))

  ggplot(out, aes(x, y, colour = mu)) +
    geom_line() +
    facet_grid(power~phi, scales = "free") +
    gfplot::theme_pbs() +
    labs(colour = "μ") +
    xlab("Value") + ylab("Density") +
    coord_cartesian(expand = FALSE, xlim = c(-0.2, max(out$x))) +
    scale_colour_brewer(palette = "Dark2") +
    scale_fill_brewer(palette = "Dark2")
}

df <- expand.grid(power = c(1.2, 1.6, 1.8), mu = c(1, 3, 6), phi = c(0.5, 1, 2))
plot_tweedie_ex(df)
```

```{r cpue-catch-effort-ts, fig.cap="Raw time series of Pacific Cod catch and total hours trawled (regardless of species caught). Data prior to 1996 is shown separately from data after 1996.", fig.asp=1.1}
g1 <- make_catch_effort_ts_plot(dfleet_hist)  +
  ggtitle("1956-1995 data")
g2 <- make_catch_effort_ts_plot(dfleet_modern) +
  ggtitle("1996+ data")
cowplot::plot_grid(g1, g2, ncol = 1)
```

```{r, cpue-depth-hists, fig.asp=0.8, fig.cap="The depth distribution for fishing trips (top row) and fishing trawl events (bottom row) that caught Pacific Cod or did not catch Pacific Cod."}
g1 <- gg_cpue_modern$depth + ylab("Fishing event count") + xlab("Depth") +
  labs(fill = "Fishing event\ncaught\nPacific Cod") +
  theme(legend.position = c(0.95, 0.95), legend.background = element_rect(fill = "white"),
    legend.justification = c(1, 1)) +
  ggtitle("1996+ data") +
  scale_colour_brewer(palette = "Dark2") +
  scale_fill_brewer(palette = "Dark2")

g2 <- gg_cpue_hist$depth + ylab("Trip count") + xlab("Depth") +
  labs(fill = "Trip\ncaught\nPacific Cod") +
  theme(legend.position = c(0.95, 0.95), legend.background = element_rect(fill = "white"),
    legend.justification = c(1, 1)) +
  ggtitle("1956-1995 data")  +
  scale_colour_brewer(palette = "Dark2") +
  scale_fill_brewer(palette = "Dark2")

cowplot::plot_grid(g2, g1, ncol = 1)
```

```{r cpue-bubble-plots-hist-3CD, fig.asp=1.35, fig.cap="Distribution of predictors in CPUE standardization models for 1956--1995 3CD dataset. Area of outermost circles represents the number of trip-locality combinations for that predictor value and year combination. Area and shading of innermost circles represents the number of trip-locality combinations for that predictor value and year combination that caught Pacific Cod."}
dfleet_hist %>%
  make_bubble_dat(measure.vars = c("month", "locality", "depth")) %>%
  filter(area == "3CD") %>%
  make_facet_bubble_plot(group = "trips") +
  ggtitle("1956-1995 3CD")
```

(ref:caption-cpue-bubble-plots-hist-5ABCD) Same as Figure \@ref(fig:cpue-bubble-plots-hist-3CD) but for 5ABCD.
(ref:caption-cpue-bubble-plots-modern-3CD) Same as Figure \@ref(fig:cpue-bubble-plots-hist-3CD) but for 1996--2017 3CD.
(ref:caption-cpue-bubble-plots-modern-5ABCD) Same as Figure \@ref(fig:cpue-bubble-plots-hist-3CD) but for 1996--2017 5ABCD.

```{r cpue-bubble-plots-hist-5ABCD, fig.asp=1.35, fig.cap="(ref:caption-cpue-bubble-plots-hist-5ABCD)"}
dfleet_hist %>%
  make_bubble_dat(measure.vars = c("month", "locality", "depth")) %>%
  filter(area == "5ABCD") %>%
  make_facet_bubble_plot(group = "trips") +
  ggtitle("1956-1995 5ABCD")
```

```{r cpue-bubble-plots-modern-3CD, fig.asp=1.4, fig.width=9, fig.cap="(ref:caption-cpue-bubble-plots-modern-3CD)"}
dfleet_modern %>% make_bubble_dat() %>%
  filter(area == "3CD") %>%
  make_facet_bubble_plot() +
  ggtitle("1996+ 3CD")
```

```{r cpue-bubble-plots-modern-5ABCD, fig.asp=1.4, fig.width=9, fig.cap="(ref:caption-cpue-bubble-plots-modern-5ABCD)"}
dfleet_modern %>% make_bubble_dat() %>%
  filter(area == "5ABCD") %>%
  make_facet_bubble_plot() +
  ggtitle("1996+ 5ABCD")
```

(ref:caption-cpue-quantile-residuals) Histograms of randomized quantile residuals [@dunn1996] for the CPUE GLMM standardization models. The histograms illustrate the actual density distribution of 10,000 randomly selected randomized quantile residuals. The dashed lines show the probability density for a normal distribution with the same standard deviation.

```{r cpue-quantile-residuals, fig.asp=0.8, fig.cap="(ref:caption-cpue-quantile-residuals)"}
stopifnot(length(m_historic) == 12L)
stopifnot(length(m_modern) == 16L)
qr1 <- qres_tweedie(m_historic[[6]], "cpue")
gqr1 <- plot_qres_histogram(qr1) + ggtitle(paste("Historical", params$area_name[1]))
qr2 <- qres_tweedie(m_historic[[12]], "cpue")
gqr2 <- plot_qres_histogram(qr2) + ggtitle(paste("Historical", params$area_name[2]))
qr3 <- qres_tweedie(m_modern[[8]], "cpue")
gqr3 <- plot_qres_histogram(qr3) + ggtitle(paste("Modern", params$area_name[1]))
qr4 <- qres_tweedie(m_modern[[16]], "cpue")
gqr4 <- plot_qres_histogram(qr4) + ggtitle(paste("Modern", params$area_name[2]))
cowplot::plot_grid(gqr2, gqr1, gqr4, gqr3, ncol = 2)
```

```{r cpue-pars, results='asis'}
get_cpue_pars <- function(obj, name = "") {
  re <- broom.mixed::tidy(obj, effects = "ran_pars")
  re$group <- gsub("_", "-", re$group)
  re <- tibble(Model = name, Parameter = paste(re$group, "SD"),
    Estimate = round(re$estimate, 2))
  p <- round(stats::plogis(obj$fit$par[["thetaf"]]) + 1, 2)
  phi <- round(exp(obj$fit$par[["betad"]]), 2)
  bind_rows(re,
    tibble(Model = name, Parameter = c("$p$", "$\\phi$"), Estimate = c(p, phi)))
}
pars <- list()
pars[[1]] <- get_cpue_pars(m_historic[[12]], "Historical 3CD")
pars[[2]] <- get_cpue_pars(m_historic[[6]], "Historical 5ABCD")
pars[[3]] <- get_cpue_pars(m_modern[[16]], "Modern 3CD")
pars[[4]] <- get_cpue_pars(m_modern[[8]], "Modern 5ABCD")
bind_rows(pars) %>%
  knitr::kable(caption = "Random effect standard deviation (SD) and Tweedie observation model power ($p$) and dispersion ($\\phi$) parameter estimates.", booktabs = TRUE, linesep = "", escape = FALSE, format = "pandoc")
```


```{r cpue-index-ts-hist, fig.asp=1.15, fig.cap="Commercial trawl CPUE standardization models. Throughout, the black line and shaded region indicate a CPUE index with only a year predictor. The coloured line and shaded ribbons indicate indices that have been standardized by one or more predictors. The first three rows illustrate standardization models that include a single predictor listed on the right. The second last row illustrates a standardization model that includes all the predictors in one model. The last row illustrates a standardization model that includes all the predictors plus locality-by-year (space-time) random effects. Locality and locality-vessel interactions are fit as random effects and all other variables are fit as fixed effects."}
make_cpue_ts_dat(cpue_pred_hist) %>% make_cpue_ts_plot() +
  ggtitle("1956-1995 CPUE") +
  scale_colour_brewer(palette = "Dark2") +
  scale_fill_brewer(palette = "Dark2")
```

(ref:caption-cpue-index-ts-modern) Same as Figure \@ref(fig:cpue-index-ts-hist) but for the 1996 to 2017 data. Locality, vessel, and locality-vessel interactions are fit as random effects and all other variables are fit as fixed effects.

```{r cpue-index-ts-modern, fig.asp=1.55, fig.cap="(ref:caption-cpue-index-ts-modern)", out.width="5.2in", fig.width=6.5}
make_cpue_ts_dat(cpue_pred_modern) %>% make_cpue_ts_plot() +
  ggtitle("1996+ CPUE") +
  scale_colour_brewer(palette = "Dark2") +
  scale_fill_brewer(palette = "Dark2")
```

```{r cpue-int-test-plot, fig.asp=0.85, fig.cap="A comparison of CPUE timeseries standardized with a model that does not include locality-year (space-time) random effects (black/grey) and a model that does include the locality-year random effects (coloured)."}
g1 <- make_cpue_ts_dat_noint(cpue_pred_hist) %>% make_cpue_ts_plot_noint() +
  ggtitle("1956-1995 CPUE")
g2 <- make_cpue_ts_dat_noint(cpue_pred_modern) %>% make_cpue_ts_plot_noint() +
  ggtitle("1996+ CPUE")
cowplot::plot_grid(g1, g2, ncol = 1)
```

```{r cpue-coef-plot1, fig.asp=1.3, echo=FALSE, fig.cap="Fixed effect coefficients for historical commercial CPUE standardization model. Dots and thick and thin line segments represent means and 50\\% and 95\\% Wald confidence intervals."}
toplot <- c(6, 12)
p <- list()
for (i in seq_along(params$area_name)) {
  p[[i]] <- make_fe_plots(m_historic[[toplot[i]]]) + ggtitle(params$area_name[i])
}
cowplot::plot_grid(p[[2]], p[[1]], ncol = 1)
```

```{r cpue-coef-plot2, fig.asp=1, echo=FALSE, fig.cap="Locality random effects for the historical commercial CPUE standardization model."}
p <- list()
for (i in seq_along(params$area_name)) {
   p[[i]] <- make_re_plots(m_historic[[toplot[i]]], re_names = "locality") +
    ggtitle(params$area_name[i]) + xlab("Random intercept value\n(log space)")
}
cowplot::plot_grid(p[[2]], p[[1]], ncol = 2)
```

```{r cpue-coef-plot3, fig.asp=1.35, echo=FALSE, fig.cap="Locality-by-year (space-time) random effects for the historical commercial CPUE standardization model.", fig.width=10.5}
p <- list()
for (i in seq_along(params$area_name)) {
  p[[i]] <- make_year_locality_plots(m_historic[[toplot[i]]]) + ggtitle(params$area_name[i])
}
cowplot::plot_grid(p[[2]], p[[1]], ncol = 1)
```

```{r cpue-coef-plot1-modern, fig.asp=1.2, echo=FALSE, fig.cap="Fixed effect coefficients for modern commercial CPUE standardization model. Dots and thick and thin line segments represent means and 50\\% and 95\\% Wald confidence intervals."}
toplot <- c(8, 16)
p <- list()
for (i in seq_along(params$area_name)) {
  p[[i]] <- make_fe_plots(m_modern[[toplot[i]]]) + ggtitle(params$area_name[i])
}
cowplot::plot_grid(p[[2]], p[[1]], ncol = 2)
```

```{r cpue-coef-plot2-modern, fig.asp=0.8, echo=FALSE, fig.cap="Locality and vessel random effects for the modern commercial CPUE standardization model."}
p <- list()
for (i in seq_along(params$area_name)) {
   p[[i]] <- make_re_plots(m_modern[[c(8, 16)[i]]], re_names = c("locality", "vessel")) +
    ggtitle(params$area_name[i])
}
cowplot::plot_grid(p[[2]], p[[1]], ncol = 2)
```

```{r cpue-coef-plot3-modern, fig.asp=1.35, echo=FALSE, fig.cap="Locality-by-year (space-time) random effects for the modern commercial CPUE standardization model."}
p <- list()
for (i in seq_along(params$area_name)) {
  p[[i]] <- make_year_locality_plots(m_modern[[toplot[i]]]) + ggtitle(params$area_name[i])
}
cowplot::plot_grid(p[[2]], p[[1]], ncol = 1)
```

```{r cpue-re-int-ts, fig.cap="Locality-specific CPUE index trends for a standardization model that allows for locality-year (space-time) interactions. The coloured lines indicate the locality-specific estimates with all other predictors set to their base levels. The black line and shaded ribbon indicate the overall average annual CPUE.", fig.asp=0.8}
if (!file.exists(here::here("data/generated/cpue-re-preds.rda"))) {
  stopifnot(length(m_modern) == 16L)
  g1 <- plot_cpue_int_res(m_modern[[8]], fleet = dfleet_modern[[1]],
    index_data = cpue_pred_modern,
    era = "modern") + ggtitle("1996+ 5ABCD")

  g2 <- plot_cpue_int_res(m_modern[[16]], fleet = dfleet_modern[[2]],
    index_data = cpue_pred_modern,
    era = "modern") + ggtitle("1996+ 3CD")

  stopifnot(length(m_historic) == 12L)
  g3 <- plot_cpue_int_res(m_historic[[6]], fleet = dfleet_hist[[1]],
    index_data = cpue_pred_hist,
    era = "historical")+ ggtitle("1956-1995 5ABCD")

  g4 <- plot_cpue_int_res(m_historic[[12]], fleet = dfleet_hist[[2]],
    index_data = cpue_pred_hist,
    era = "historical")+ ggtitle("1956-1995 3CD")

  save(g1, g2, g3, g4, file = here::here("data/generated/cpue-re-preds.rda"))
} else {
  load(here::here("data/generated/cpue-re-preds.rda"))
}
cowplot::plot_grid(g4, g3, g2, g1, ncol = 2)
```


```{r cpue-re-no-int-ts, fig.cap="Locality-specific CPUE index trends for a standardization model that does not allow for locality-year (space-time) interactions. The coloured lines indicate the locality-specific estimates with all other predictors set to their base levels. The black line and shaded ribbon indicate the overall average annual CPUE.", fig.asp=0.8}
if (!file.exists(here::here("data/generated/cpue-re-preds-noint.rda"))) {
  g1 <- plot_cpue_int_res(m_modern[[7]], fleet = dfleet_modern[[1]],
    index_data = cpue_pred_modern,
    the_formula_version = "Full standardization minus interactions",
    era = "modern") + ggtitle("1996+ 5ABCD")

  g2 <- plot_cpue_int_res(m_modern[[15]], fleet = dfleet_modern[[2]],
    index_data = cpue_pred_modern,
    the_formula_version = "Full standardization minus interactions",
    era = "modern") + ggtitle("1996+ 3CD")

  g3 <- plot_cpue_int_res(m_historic[[5]], fleet = dfleet_hist[[1]],
    index_data = cpue_pred_hist,
    the_formula_version = "Full standardization minus interactions",
    era = "historical")+ ggtitle("1956-1995 5ABCD")

  g4 <- plot_cpue_int_res(m_historic[[11]], fleet = dfleet_hist[[2]],
    index_data = cpue_pred_hist,
    the_formula_version = "Full standardization minus interactions",
    era = "historical")+ ggtitle("1956-1995 3CD")
  save(g1, g2, g3, g4, file = here::here("data/generated/cpue-re-preds-noint.rda"))
} else {
  load(here::here("data/generated/cpue-re-preds-noint.rda"))
}
cowplot::plot_grid(g4, g3, g2, g1, ncol = 2)
```

```{r cpue-sim-test-tweedie-glmm, message=FALSE, warning=FALSE, results='hide'}
set.seed(99)
N <- 12
nyrs <- 20
locs <- LETTERS[seq_len(N)]
loc_effects <- rnorm(N, 0, 0.3)
yr_effects <- as.numeric(arima.sim(n = nyrs, list(ar = 0.3), sd = 1, mean = 2))
obs_per_yr_loc <- 10
tweedie_p <- 1.6
tweedie_phi <- 5

x <- data.frame(loc = rep(locs, each = nyrs * obs_per_yr_loc),
  loc_ef = rep(loc_effects, each = nyrs * obs_per_yr_loc))
x <- mutate(x, yr = rep(seq_len(nyrs), N * obs_per_yr_loc),
  yr_ef = rep(yr_effects, N * obs_per_yr_loc))
x <- mutate(x, mu = yr_ef + loc_ef)
x <- mutate(x, yr_x_loc = paste(yr, loc))
x <- mutate(x, y = tweedie::rtweedie(length(mu),
  mu = exp(mu), power = tweedie_p, phi = tweedie_phi))
# ggplot(x, aes(yr, y)) + geom_point() + geom_line(aes(x = yr, y = exp(yr_ef)))

yr_loc_int <- expand.grid(yr = unique(x$yr), loc = unique(x$loc))
yr_loc_int <- mutate(yr_loc_int, yr_x_loc = paste(yr, loc))
yr_loc_int <- mutate(yr_loc_int, yr_x_loc_ef = rnorm(nrow(yr_loc_int), 0, 0.5))

x <- left_join(x, yr_loc_int, by = c("loc", "yr", "yr_x_loc"))

x <- mutate(x, mu_w_int = yr_ef + loc_ef + yr_x_loc_ef)
x <- mutate(x, y_w_int =
    tweedie::rtweedie(length(mu_w_int),
      mu = exp(mu_w_int), power = tweedie_p, phi = tweedie_phi))
# ggplot(x, aes(yr, y_w_int)) + geom_point() + geom_line(aes(x = yr, y = exp(yr_ef)))

d1 <- x %>% sample_frac(1) %>%
  reshape2::melt(id.vars = c("loc", "yr", "yr_ef"), measure.vars = c("y", "y_w_int"))
# d1 %>% ggplot(aes(yr, value)) + geom_point(alpha = 0.7, pch = 21) +
#   geom_line(aes(x = yr, y = exp(yr_ef))) +
#   facet_wrap(~variable)

d1 <- mutate(d1, year_factor = as.factor(yr), cpue = value)
d1 <- mutate(d1, yr_x_loc = paste(yr, loc))

invisible(capture.output({
  m_int <- plyr::dlply(d1, "variable", function(xx)
    gfplot::fit_cpue_index_glmmtmb(xx, formula = cpue ~ 0 + year_factor + (1|loc) + (1|yr_x_loc)))
  m_no_int <- plyr::dlply(d1, "variable", function(xx)
    gfplot::fit_cpue_index_glmmtmb(xx, formula = cpue ~ 0 + year_factor + (1|loc)))
}))

x1 <- plyr::ldply(m_int, function(xx) gfplot::predict_cpue_index_tweedie(xx)) %>%
  mutate(model = "Space-time interactions")
x2 <- plyr::ldply(m_no_int, function(xx) gfplot::predict_cpue_index_tweedie(xx)) %>%
  mutate(model = "No space-time interactions")
pp <- bind_rows(x1, x2)

orig_dat <- select(x, yr, yr_ef) %>% unique() %>%
  mutate(yr_ef = yr_ef - mean(yr_ef)) %>%
  rename(year = yr)
```

```{r cpue-sim-test-tweedie-glmm-plot, fig.cap="An example simulation illustrating the effect of modelling or not modelling space-time interactions as random effects in a CPUE index standardization model. Left panel shows a scenario where the data were generated with the same trend for all localities in space. Right panel shows a scenario where the data were generated with space-time interactions. The green and orange lines and shaded regions represent estimated CPUE indices from models that allow for space-time interactions or do not allow for space-time interactions along with 95\\% confidence intervals. The dashed black line indicates the true mean CPUE for each year. All model and data combinations have correct 95\\% coverage except for the no-space-time-interactions model fitted to data that does have space-time interactions, which has 55\\% coverage. Note that the confidence intervals in the left panel are completely overlapping.", fig.asp=0.45}
pp <- left_join(pp, orig_dat, by = "year") %>%
  mutate(est_link = est_link - mean(est_link)) %>%
  ungroup() %>%
  mutate(variable = gsub("^y$", "Data have no space-time interactions", variable)) %>%
  mutate(variable = gsub("^y_w_int$", "Data have space-time interactions", variable)) %>%
  mutate(model = forcats::fct_rev(model))

gg <- pp %>% group_by(model, variable) %>%
  ungroup() %>%
  ggplot() +
  geom_ribbon(aes(x = year, ymin = exp(est_link - 1.96 * se_link),
    ymax = exp(est_link + 1.96 * se_link), fill = model), alpha = 0.4) +
  geom_line(aes(x = year, y = exp(est_link), colour = model), lwd = 0.8) +
  facet_grid(~variable) +
  geom_line(data = orig_dat, aes(x = year, y = exp(yr_ef)), lwd = 0.9, col = "grey20", lty = 2) +
  labs(fill = "Model", colour = "Model", x = "Year", y = "CPUE") +
  gfplot::theme_pbs() +
  theme(legend.position = c(0.02, 0.97), legend.justification = c(0, 1))  +
  scale_colour_brewer(palette = "Dark2") +
  scale_fill_brewer(palette = "Dark2")
print(gg)
```

```{r cpue-sim-save}
ggplot2::ggsave(here::here("presentations/figures/cpue-sim.svg"), plot = gg, 
  width = 8, height = 4)
```

```{r cpue-sim-test-tweedie-glmm-table, results='asis'}
# group_by(pp, variable, model) %>%
#   rename(data = variable) %>%
#   summarise(coverage =
#     sum(yr_ef < est_link + 1.96 * se_link & yr_ef > est_link - 1.96 * se_link) / n()) %>%
#   knitr::kable(caption = "TODO", booktabs = TRUE, linesep = "")
```

\clearpage

<!--chapter:end:05-cpue-app.Rmd-->

\clearpage

# REFERENCES {-}
<!--
This manually sets the header for this unnumbered chapter.
-->
\markboth{References}{References}

<!--chapter:end:99-references.Rmd-->

